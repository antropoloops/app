{"version":3,"sources":["browser/localStorage.js","session/actions.js","session/events.js","session/reducer/audioset.js","session/reducer/audio.js","session/reducer/tracks.js","session/reducer/index.js","session/index.js","session/createStore.js","audioset/cache.js","audioset/resources.js","audio/context.js","audio/nextBeat.js","audio/Sampler.js","audio/index.js","visuals/dimensions.js","visuals/drawCircle.js","audioset/index.js","visuals/getAlbumInfo.js","visuals/display.js","visuals/drawAlbum.js","visuals/drawRefLine.js","visuals/drawWave.js","visuals/imprint.js","visuals/lastSampleInfo.js","visuals/index.js","ui/shared/Icon.jsx","ui/shared/index.jsx","ui/Desktop/Toolbar.jsx","ui/Welcome/Welcome.jsx","ui/Welcome/index.jsx","ui/Desktop/Visuals.jsx","ui/Pads/Pad.jsx","ui/Pads/Pads.jsx","ui/Pads/index.js","ui/shared/Trigger.jsx","ui/Tracks/Tracks.jsx","ui/Tracks/index.js","audioset/inputs.js","ui/Keyboard/Keyboard.jsx","ui/Keyboard/index.js","browser/fullscreen.js","ui/Desktop/Desktop.jsx","ui/Desktop/index.js","ui/App.jsx","index.js"],"names":["STORAGE_KEY","saveState","state","serializedState","JSON","stringify","localStorage","setItem","e","console","log","undefined","window","resetLocalStorage","SET_AUDIOSET","setAudioset","audioset","type","PRESS_PAD","pressPad","clipId","RELEASE_PAD","releasePad","SET_AUDIO_CLIP_STATUS","SET_AUDIO_STATUS","setAudioStatus","isPlaying","time","status","AUDIO_STOP_ALL","stopAudio","CHANGE_TRACK_VOLUME","events","nanobus","START_VISUALS","STOP_VISUALS","on","event","middleware","store","next","action","emit","initialState","playing","volumes","valueByTrack","value","tracks","reduce","obj","t","id","combineReducers","arguments","length","audio","Object","objectSpread","defineProperty","trackId","dir","src_session","init","Error","dispatch","createStore","reducer","compose","applyMiddleware","thunk","__REDUX_DEVTOOLS_EXTENSION__","f","getAudioset","getState","CACHE","save","key","startsWith","get","has","memo","create","ns","concat","cachedFetch","url","decode","Promise","resolve","fetch","then","data","ENV","process","resourceUrl","source","resources","assign","default","getSources","name","replace","getCachedResources","cached","clipIds","keys","clips","all","loadResources","map","promise","i","resource","getResourceUrls","names","toUrl","urls","identity","x","DECODERS","response","ctx","context","arrayBuffer","buffer","decodeAudioData","decoder","BEATS","nextBeat","now","startedAt","bpm","beats","factor","absolute","nextBeatOffset","Sampler","classCallCheck","this","buffers","sources","output","gain","createGain","connect","destination","createMasterOutput","currentTime","warn","stopTrack","createBufferSource","loop","start","started","stop","stopped","_this","clip","find","track","forEach","_this2","startAudioClip","stopAudioClip","samplers","getSampler","currentSampler","Resources","src_audio","session","restoreState","play","playSample","stopSample","stopAll","albumsCount","DOT_RADIUS","getVerticalPadding","screenWidth","getInfoHeight","getCoverSize","getAlbumHeight","verticalPadding","infoHeight","getDotOffsetX","trackNumber","getDisplaySize","ratio","el","getFixedSize","offsetWidth","offsetHeight","width","height","realAspectRatio","screenHeight","RATIOS","sixteenNinths","sixteenTenths","circleNumSlices","degreesFromSlice","d3","range","domain","drawCircle","parent","cx","cy","params","duration","trackVolume","trackColor","circlesGroup","append","attr","circle","arc","outerArcs","d","startAngle","deg2rad","endAngle","innerRadius","outerRadius","createOuterArcs","selectAll","enter","style","innerArcs","createInnerArcs","turnTimer","elapsed","elapsedSeconds","turnScale","empty","degrees","Math","PI","BASE_URL","json","fetchAudioset","audiosetId","baseUrl","getAlbumInfo","imageUrl","getClipCoverImageUrl","meta","lnglat","year","country","title","artist","album","trackNum","loopend","display","color","CONFIG","geoMapUrl","imprint","focus","lambda","verticalShift","scaleFactor","Display","set","config","visuals","element","circles","albums","refLines","infos","fixedAspectRatio","geodata","countries","topojson","objects","features","render","info","_getDisplaySize","_this$projection","projection","_this$projection2","slicedToArray","circlesContainer","coverSize","horizontalPadding","getHorizontalPadding","dotOffsetX","textElement","textId","textLength","document","getElementById","getBBox","text","slice","wrap","drawAlbum","albumsContainer","refLine","windowWidth","x1","x2","y2","h","sqrt","pow","a","alfa","acos","curveCoords","y","cos","sin","line","curve","datum","drawRefLine","refLinesContainer","firstRadius","floor","radius","wave","r","strokeWidth","transition","delay","nodes","lastRadius","remove","drawWave","wavesContainer","point","lastSampleInfo","_ref","select","rectSize","dy","createLastSampleInfo","lastSampleInfoContainer","each","polygon","base","chroma","brighten","size","focusedScale","albumsHeight","clear","svg","mapContainer","scale","d3geo","translate","rotate","createProjection","path","resize","addEventListener","setGeodata","createDisplay","removeEventListener","show","hide","ICONS","fly","mute","cinema","controls","stop2","fullscreen","keyboard","volumeUp","volumeDown","volumeOff","Icon","icon","onClick","react_default","createElement","fill","viewBox","xmlns","Button","cxs","background","font","padding","borderRadius",":hover","textDecoration","Link","border","Transport","Connection","marginTop","flexGrow","textAlign","className","onCloseAudioset","onStopAll","onToggleTracks","onTogglePads","onFullscreen","shared_Icon","description","flexDirection","backgroundColor","margin","lineHeight","fontSize","& h1, & h2","fontWeight","Welcome","audiosetIndex","onChangeAudioset","Fragment","onClose","_useState","useState","_useState2","setIsLoading","_useState3","_useState4","index","setIndex","useEffect","mounted","fetchIndex","ui_Welcome_Welcome","useRef","current","ref","Pad","props","possibleConstructorReturn","getPrototypeOf","call","touched","isTouch","pressed","_this$props","touch","image","borderColor","onTouchStart","handlePress","onMouseDown","src","alt","React","Component","TrackPads","onPadPressed","onPadReleased","ui_Pads_Pad","onPress","onRelease","_ref2","Pads_TrackPads","minWidth","minHeight","pad","Pads","Trigger","children","onMouseUp","marginRight","&:hover","propTypes","PropTypes","string","Track","component","borderTop","active","> h2","marginBottom","Tracks","onVolumeChanged","shared_Trigger","min","max","onChange","target","volume","getKeyboardMap","defaults","keyMap","toUpperCase","buildKeymap","inputs","onkeydown","onkeyup","Key","Keyboard","changeFullscreen","isFullscreen","screen","callback","setWelcomeVisible","isVisible","welcomeVisible","padsVisible","tracksVisible","ModalStyles","overlay","content","position","maxHeight","top","left","transform","Main","Content","overflow","Center","App","_useReducer","useReducer","_useReducer2","disp","hideWelcome","Fullscreen","setFullscreen","notFull","Desktop_Toolbar","ui_Pads","Desktop_Visuals","ui_Tracks","ui_Keyboard","react_modal_lib_default","isOpen","shouldCloseOnOverlayClick","onRequestClose","ui_Welcome","Desktop","ui_Desktop","Session","getItem","parse","loadState","ms","subscribe","throttle","autosave","Inputs","Audio","Visuals","Modal","setAppElement","ReactDOM","es","ui_App"],"mappings":"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","file":"static/js/main.4b9e90c9.chunk.js","sourcesContent":["import { throttle } from \"lodash\";\n\nconst STORAGE_KEY = \"atpls/session\";\n\nexport function loadState() {\n  try {\n    const serializedState = localStorage.getItem(STORAGE_KEY);\n    if (serializedState === null) return undefined;\n    return JSON.parse(serializedState);\n  } catch (e) {\n    return undefined;\n  }\n}\n\n/**\n * Save the store state into local storage\n *\n * @param {*} store\n * @param {*} ms - time in milliseconds\n */\nexport function autosave(store, ms = 1000) {\n  store.subscribe(\n    throttle(() => {\n      saveState(store.getState());\n    }, ms)\n  );\n}\n\nexport function saveState(state) {\n  try {\n    const serializedState = JSON.stringify(state);\n    localStorage.setItem(STORAGE_KEY, serializedState);\n  } catch (e) {\n    console.log(\"Error saving state\", e);\n  }\n}\n\nif (typeof window !== undefined) {\n  // to clear the storage manually\n  window.resetLocalStorage = () => saveState({});\n}\n","// Audioset\nexport const SET_AUDIOSET = \"[session] SET_AUDIOSET\";\nexport const setAudioset = audioset => ({\n  type: SET_AUDIOSET,\n  audioset\n});\n\n// Pads\nexport const PRESS_PAD = \"[session] PRESS_PAD\";\nexport const pressPad = clipId => ({ type: PRESS_PAD, clipId });\nexport const RELEASE_PAD = \"[session] RELEASE_PAD\";\nexport const releasePad = clipId => ({ type: RELEASE_PAD, clipId });\n\n// Audio\nexport const SET_AUDIO_CLIP_STATUS = \"[session] SET_AUDIO_CLIP_STATUS\";\nexport const startAudioClip = (clipId, trackId, time) => ({\n  type: SET_AUDIO_CLIP_STATUS,\n  clipId,\n  trackId,\n  status: { isPlaying: true, time }\n});\nexport const stopAudioClip = (clipId, trackId, time) => ({\n  type: SET_AUDIO_CLIP_STATUS,\n  clipId,\n  trackId,\n  status: { isPlaying: false, time }\n});\n\nexport const SET_AUDIO_STATUS = \"[session] SET_AUDIO_STATUS\";\nexport const setAudioStatus = (isPlaying, time) => ({\n  type: SET_AUDIO_STATUS,\n  status: { isPlaying, time }\n});\n\nexport const AUDIO_STOP_ALL = \"[session] AUDIO_STOP_ALL\";\nexport const stopAudio = () => ({\n  type: AUDIO_STOP_ALL\n});\n\n// Tracks\nexport const CHANGE_TRACK_VOLUME = \"[session] CHANGE_TRACK_VOLUME\";\nexport const changeTrackVolume = (trackId, volume) => ({\n  type: CHANGE_TRACK_VOLUME,\n  trackId,\n  volume\n});\n","import nanobus from \"nanobus\";\n\nexport const events = nanobus();\n\nexport const START_VISUALS = \"START_VISUALS\";\nexport const startVisuals = (audioset, el) => ({\n  type: START_VISUALS,\n  audioset,\n  el\n});\nexport const STOP_VISUALS = \"STOP_VISUALS\";\nexport const stopVisuals = () => ({ type: STOP_VISUALS });\n\n/**\n * A unified event model\n * @param {*} event\n */\nexport function emit(event) {\n  events.emit(event.type, event);\n}\n\nevents.on(\"*\", (type, event) => {\n  if (type !== \"action\") console.log(\"event\", type, event);\n});\n\nconst middleware = store => next => action => {\n  next(action);\n  events.emit(\"action\", action);\n};\n\nexport default middleware;\n","import { SET_AUDIOSET } from \"../actions\";\n\n/**\n * Audioset session state\n */\nconst initialState = null;\n\nexport default function reduce(state = initialState, action) {\n  if (action.type === SET_AUDIOSET) return action.audioset;\n  return state;\n}\n","import {\n  SET_AUDIO_STATUS,\n  SET_AUDIO_CLIP_STATUS,\n  AUDIO_STOP_ALL\n} from \"../actions\";\n\n/**\n * Audioset session state\n */\nconst initialState = {\n  isPlaying: false,\n  status: {}\n};\n\nexport default function reduce(state = initialState, action) {\n  switch (action.type) {\n    case SET_AUDIO_STATUS:\n      return {\n        ...state,\n        isPlaying: action.status.isPlaying,\n        time: action.status.time\n      };\n    case SET_AUDIO_CLIP_STATUS:\n      return {\n        ...state,\n        status: { ...state.status, [action.clipId]: action.status }\n      };\n    case AUDIO_STOP_ALL:\n      return { ...state, status: {} };\n    default:\n      return state;\n  }\n}\n","import {\n  SET_AUDIOSET,\n  CHANGE_TRACK_VOLUME,\n  SET_AUDIO_CLIP_STATUS\n} from \"../actions\";\n\nconst initialState = {\n  playing: {},\n  volumes: {}\n};\n\nconst valueByTrack = (audioset, value) =>\n  audioset\n    ? audioset.tracks.reduce((obj, t) => {\n        obj[t.id] = value;\n        return obj;\n      }, {})\n    : {};\n\nexport default function reduce(state = initialState, action) {\n  switch (action.type) {\n    case SET_AUDIOSET:\n      return {\n        playing: valueByTrack(action.audioset, 0),\n        volumes: valueByTrack(action.audioset, 75)\n      };\n    case SET_AUDIO_CLIP_STATUS:\n      const { trackId } = action;\n      const dir = action.status.isPlaying ? 1 : -1;\n      return {\n        ...state,\n        playing: {\n          ...state.playing,\n          [trackId]: state.playing[trackId] + dir\n        }\n      };\n    case CHANGE_TRACK_VOLUME:\n      return {\n        ...state,\n        volumes: { ...state.volumes, [action.trackId]: action.value }\n      };\n    default:\n      return state;\n  }\n}\n","import { combineReducers } from \"redux\";\nimport audioset from \"./audioset\";\nimport audio from \"./audio\";\nimport tracks from \"./tracks\";\n\n/**\n * The session stores all state that can be shared between instances connected\n */\nexport default combineReducers({\n  audioset,\n  audio,\n  tracks\n});\n","import { events } from \"./events\";\nimport createStore from \"./createStore\";\n\nlet store = null;\n\nexport function init(initialState) {\n  if (store) throw Error(\"Session only can be initialized once\");\n  store = createStore(initialState);\n\n  const dispatch = store.dispatch;\n  const getAudioset = () => store.getState().audioset;\n  return { events, store, getAudioset, dispatch };\n}\n\nexport default { init, events };\n","import { createStore, compose, applyMiddleware } from \"redux\";\nimport thunk from \"redux-thunk\";\nimport events from \"./events\";\nimport reducer from \"./reducer\";\n\n/**\n * The session stores all state that can be shared between instances connected\n *\n * The session is a redux store!\n */\nexport default function createSession(initialState = {}) {\n  const store = createStore(\n    reducer,\n    initialState,\n    compose(\n      applyMiddleware(events, thunk),\n      window.__REDUX_DEVTOOLS_EXTENSION__\n        ? window.__REDUX_DEVTOOLS_EXTENSION__()\n        : f => f\n    )\n  );\n  return store;\n}\n","const CACHE = [];\n\nfunction save(key, value) {\n  if (key.startsWith(\"audioset://\")) console.log(\"save\", key, value);\n  CACHE[key] = value;\n  return value;\n}\nfunction get(key) {\n  return CACHE[key];\n}\nfunction has(key) {\n  return CACHE[key] !== undefined;\n}\n\n/**\n * Memoize for audiosets\n * @param {*} key\n * @param {*} create\n */\nexport function memo(audioset, key, create) {\n  const ns = `audioset://${audioset.id}/${key}`;\n  return has(ns) ? get(ns) : save(ns, create());\n}\n\nexport function cachedFetch(url, decode) {\n  if (has(url)) return Promise.resolve(get(url));\n  console.log(\"Fetch\", url);\n  return fetch(url)\n    .then(decode)\n    .then(data => save(url, data));\n}\n","import { cachedFetch, memo } from \"./cache\";\nimport context from \"audio-context\";\n\nconst ENV = process.env.NODE_ENV;\n\nfunction getSources(audioset) {\n  const resources = audioset.resources || {};\n  return Object.assign({}, resources.default, resources[ENV]);\n}\nconst url = source => name => source && source.replace(\"{{filename}}\", name);\nconst resourceUrl = (audioset, type) => url(getSources(audioset)[type] || \"\");\n\nexport default { getCachedResources, loadResources, getResourceUrls };\n\nexport function getResourceUrls(audioset, type) {\n  const names = Object.keys(audioset.clips);\n  const toUrl = resourceUrl(audioset, type);\n  return names.reduce((urls, name) => {\n    urls[name] = toUrl(name);\n    return urls;\n  }, {});\n}\n\nconst identity = x => x;\nconst DECODERS = {\n  audio: decodeAudio\n};\n\nexport function loadResources(audioset, type, clipIds) {\n  clipIds = clipIds || Object.keys(audioset.clips);\n  const toUrl = resourceUrl(audioset, type);\n  const decoder = DECODERS[type] || identity;\n  return clipIds.map(clipId => cachedFetch(toUrl(clipId), decoder));\n}\n\nexport function getCachedResources(audioset, type) {\n  return memo(audioset, type, () => {\n    const cached = {};\n    const clipIds = Object.keys(audioset.clips);\n    Promise.all(\n      loadResources(audioset, type, clipIds).map((promise, i) =>\n        promise.then(resource => {\n          cached[clipIds[i]] = resource;\n          return resource;\n        })\n      )\n    );\n    return cached;\n  });\n}\n\nfunction decodeAudio(response) {\n  const ctx = context();\n  return response.arrayBuffer().then(buffer => ctx.decodeAudioData(buffer));\n}\n","import context from \"audio-context\";\n\nconst ctx = context();\n\nexport default ctx;\n","const BEATS = 1;\n\nexport default function nextBeat(now, startedAt, bpm) {\n  return now + nextBeatOffset(now, startedAt, bpm);\n}\n\n/**\n * Calculate the time remaining until the next beat\n *\n * @param {*} now\n * @param {*} startedAt\n * @param {*} bpm\n * @param {*} beats\n */\nexport function nextBeatOffset(now, startedAt, bpm, beats = BEATS) {\n  if (!startedAt) return 0;\n  const factor = bpm / (60 * beats);\n  const absolute = now - startedAt;\n  if (absolute === 0) return 0;\n  const inBeats = absolute * factor;\n  const mod = inBeats % 1;\n  const offsetTime = (1 - mod) / factor;\n  return offsetTime;\n}\n","import ctx from \"./context\";\nimport {\n  stopAudioClip,\n  startAudioClip,\n  setAudioStatus\n} from \"../session/actions\";\nimport nextBeat from \"./nextBeat\";\n\nexport default class Sampler {\n  constructor(audioset, dispatch) {\n    this.bpm = audioset.audio.bpm || 120;\n    this.playing = 0;\n    this.startedAt = null;\n    this.audioset = audioset;\n    this.buffers = {};\n    this.sources = {};\n    this.dispatch = dispatch;\n    this.output = createMasterOutput(0.2);\n  }\n\n  play(clipId, time) {\n    time = time || nextBeat(ctx.currentTime, this.startedAt, this.bpm);\n    const buffer = this.buffers[clipId];\n    if (!buffer) console.warn(\"No buffer\", clipId);\n\n    this.stopTrack(clipId, time);\n    const source = (this.sources[clipId] = ctx.createBufferSource());\n    source.buffer = buffer;\n    source.loop = true;\n    source.connect(this.output);\n    source.start(time);\n    this.started(clipId, time);\n  }\n  stop(clipId, time) {\n    const source = this.sources[clipId];\n    if (!source) return;\n    time = time || ctx.currentTime;\n    source.stop(time);\n    this.sources[clipId] = null;\n    this.stopped(clipId, time);\n  }\n\n  // stops the clips in the same track\n  stopTrack(clipId, time) {\n    const clip = this.audioset.clips[clipId];\n    const track = this.audioset.tracks.find(track => track.id === clip.trackId);\n    track.clipIds.forEach(clipId => this.stop(clipId, time));\n  }\n\n  stopAll() {\n    const now = ctx.currentTime;\n    Object.keys(this.sources).forEach(clipId => this.stop(clipId, now));\n  }\n\n  started(clipId, time) {\n    if (this.playing === 0) {\n      this.startedAt = time;\n      this.dispatch(setAudioStatus(true, time));\n    }\n    this.playing++;\n    const { trackId } = this.audioset.clips[clipId];\n    this.dispatch(startAudioClip(clipId, trackId, ctx.currentTime));\n  }\n\n  stopped(clipId, time) {\n    const { trackId } = this.audioset.clips[clipId];\n    this.dispatch(stopAudioClip(clipId, trackId, ctx.currentTime));\n    this.playing--;\n    if (this.playing === 0) {\n      this.startedAt = null;\n      this.dispatch(setAudioStatus(false, time));\n    }\n  }\n}\n\nfunction createMasterOutput(gain) {\n  const output = ctx.createGain();\n  output.gain.value = gain;\n  output.connect(ctx.destination);\n  return output;\n}\n","import {\n  SET_AUDIOSET,\n  PRESS_PAD,\n  RELEASE_PAD,\n  AUDIO_STOP_ALL,\n  stopAudio\n} from \"../session/actions\";\nimport Resources from \"../audioset/resources\";\nimport Sampler from \"./Sampler\";\n\nconst samplers = {};\nconst getSampler = (audioset, dispatch) => {\n  const { id } = audioset;\n  if (samplers[id]) return samplers[id];\n  samplers[id] = new Sampler(audioset, dispatch);\n  return samplers[id];\n};\nlet currentSampler = null;\n\n// Eventually, we have to do it better\nfunction restoreState(state, events, store) {\n  store.dispatch(stopAudio());\n}\n\nexport function connect(session) {\n  const { events, store } = session;\n  const state = store.getState();\n  if (state.audioset) setAudioset(state.audioset, store.dispatch);\n\n  restoreState(state, events, store);\n\n  events.on(\"action\", action => {\n    const { type } = action;\n    if (type === SET_AUDIOSET) setAudioset(action.audioset, store.dispatch);\n    else if (type === PRESS_PAD) playSample(action.clipId);\n    else if (type === RELEASE_PAD) stopSample(action.clipId);\n    else if (type === AUDIO_STOP_ALL) currentSampler.stopAll();\n  });\n}\n\nfunction setAudioset(audioset, dispatch) {\n  if (!audioset) return;\n  currentSampler = getSampler(audioset, dispatch);\n  currentSampler.buffers = Resources.getCachedResources(audioset, \"audio\");\n}\n\nfunction playSample(id, events) {\n  if (!currentSampler) return console.warn(\"NO sampler!\");\n  currentSampler.play(id);\n}\nfunction stopSample(id, events) {\n  if (!currentSampler) return console.warn(\"NO sampler!\");\n  currentSampler.stop(id);\n}\n\nexport default { connect };\n","import * as d3geo from \"d3-geo-projection\";\n\nconst albumsCount = 8;\nexport const DOT_RADIUS = 2;\n\nexport function getHorizontalPadding(screenWidth) {\n  return screenWidth / 300;\n}\n\nexport function getVerticalPadding(screenWidth) {\n  return screenWidth / 450;\n}\n\nexport function getInfoHeight(screenWidth) {\n  return screenWidth / 50;\n}\n\nexport function getCoverSize(screenWidth) {\n  return screenWidth / albumsCount;\n}\n\nexport function getAlbumHeight(screenWidth) {\n  const verticalPadding = getVerticalPadding(screenWidth);\n  const infoHeight = getInfoHeight(screenWidth);\n  return getCoverSize(screenWidth) + verticalPadding + infoHeight * 2;\n}\n\nexport function getDotOffsetX(screenWidth, trackNumber) {\n  return trackNumber * getCoverSize(screenWidth) + DOT_RADIUS;\n}\n\nexport function getWindowSize(ratio) {\n  return getFixedSize(window.innerWidth, window.innerHeight, ratio);\n}\n\nexport function getDisplaySize(ratio, el) {\n  const width = el.offsetWidth;\n  const height = el.offsetHeight;\n  return getFixedSize(width, height, ratio);\n}\n\nfunction getFixedSize(width, height, ratio) {\n  const realAspectRatio = width / height;\n\n  const screenWidth = realAspectRatio < ratio ? width : height * ratio;\n  const screenHeight = realAspectRatio < ratio ? width / ratio : height;\n\n  return { screenWidth, screenHeight };\n}\n\nexport const RATIOS = {\n  sixteenNinths: 16 / 9,\n  sixteenTenths: 16 / 10\n};\n\nexport function createProjection(width, height, scale, verticalShift, lambda) {\n  return d3geo\n    .geoRobinson()\n    .scale(scale)\n    .translate([width / 2, height / 2 + height / verticalShift])\n    .rotate([lambda, 0, 0]);\n}\n","import * as d3 from \"d3\";\n\n// Number of slices in a circle\nconst circleNumSlices = 36;\n\n// Scale. Get the degrees for a specific slice\nconst degreesFromSlice = d3\n  .scaleLinear()\n  .range([0, 360]) // working in degrees\n  .domain([0, circleNumSlices]);\n\nexport default function drawCircle(parent, screenWidth, cx, cy, params) {\n  const { duration, trackVolume, trackColor } = params;\n  const circlesGroup = parent\n    .append(\"g\")\n    .attr(\"class\", \"circleGroup\")\n    .attr(\"transform\", `translate(${cx}, ${cy})`);\n\n  // We need to group again, so that the circle turns in its location\n  const circle = circlesGroup.append(\"g\").attr(\"class\", \"circle\");\n\n  // Arc generator\n  const arc = d3.arc();\n\n  // Create outerArcs data\n  const outerArcs = createOuterArcs(circleNumSlices, screenWidth, trackVolume);\n\n  // Draw outerArcs\n  circle\n    .selectAll(\".outerArcs\")\n    .data(outerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"outerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return (0.3 / circleNumSlices) * i;\n    });\n\n  // Create innerArcs data\n  const innerArcs = createInnerArcs(circleNumSlices, screenWidth, trackVolume);\n\n  // Draw innerArcs\n  circle\n    .selectAll(\".innerArcs\")\n    .data(innerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"innerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return (1 / circleNumSlices) * i;\n    });\n\n  circle\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", 0)\n    .attr(\"x2\", 0)\n    .attr(\"y2\", -((screenWidth / 30) * trackVolume + screenWidth / 350))\n    .style(\"stroke\", trackColor)\n    .style(\"stroke-width\", 1.5);\n\n  // Add animation to make the circle turn\n  const turnTimer = d3.timer(turn);\n  function turn(elapsed) {\n    const elapsedSeconds = (elapsed / 1000) % duration;\n    const turnScale = d3\n      .scaleLinear()\n      .range([1, 0])\n      .domain([0, duration]);\n    circle.style(\"transform\", `rotate(${-turnScale(elapsedSeconds)}turn)`);\n    if (d3.select(\".circle\").empty()) {\n      turnTimer.stop();\n    }\n  }\n\n  return circlesGroup;\n}\n\nfunction createInnerArcs(circleNumSlices, screenWidth, trackVolume) {\n  return d3.range(circleNumSlices).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle:\n        i === circleNumSlices - 1\n          ? deg2rad(degreesFromSlice(d + 1))\n          : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: (screenWidth / 30) * trackVolume\n    };\n  });\n}\n\nfunction createOuterArcs(circleNumSlices, screenWidth, trackVolume) {\n  return d3.range(circleNumSlices).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle:\n        i === circleNumSlices - 1\n          ? deg2rad(degreesFromSlice(d + 1))\n          : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: (screenWidth / 30) * trackVolume * 2\n    };\n  });\n}\n\n// Transform degrees into radians\nfunction deg2rad(degrees) {\n  return degrees * (Math.PI / 180);\n}\n","import { memo, cachedFetch } from \"./cache\";\nimport { getResourceUrls } from \"./resources\";\n\nconst BASE_URL = (process.env.PUBLIC_URL || \"\") + \"/audiosets\";\nconst json = response => response.json();\n\nexport function getClipCoverImageUrl(audioset, clipId) {\n  const coverUrls = memo(audioset, \"coverUrls\", () =>\n    getResourceUrls(audioset, \"covers\")\n  );\n  return coverUrls[clipId];\n}\n\nexport function fetchIndex(baseUrl = BASE_URL) {\n  const url = `${baseUrl}/audioset.index.json`;\n  return cachedFetch(url, json);\n}\n\nexport function fetchAudioset(audiosetId, baseUrl = BASE_URL) {\n  const url = `${baseUrl}/${audiosetId}.audioset.json`;\n  return cachedFetch(url, json);\n}\n","import { getClipCoverImageUrl } from \"../audioset\";\n\n/**\n * Get URL of a resource, given it's name and source\n * @param {*} name\n * @param {*} source\n */\nexport function resourceUrl(name, source) {\n  if (!source || !source.length) return name;\n  const url = source[source.length - 1].replace(\"{{filename}}\", name);\n  return url;\n}\n\nexport default function getAlbumInfo(audioset, name) {\n  const clip = audioset.clips[name];\n  if (!clip) return;\n\n  const imageUrl = getClipCoverImageUrl(audioset, clip.name);\n  const bpm = audioset.meta.bpm || 120;\n\n  return {\n    lnglat: clip.lnglat,\n    year: clip.year,\n    country: clip.country,\n    title: clip.title,\n    artist: clip.artist,\n    album: clip.album,\n    trackNumber: clip.trackNum,\n    loopend: 1,\n    trackVolume: clip.audio.trackVolume || 0.7,\n    duration: (60 * clip.audio.beats) / bpm, // clip duration in seconds\n    imageUrl,\n    trackColor: clip.display.color\n  };\n}\n","import * as d3 from \"d3\";\nimport * as topojson from \"topojson\";\n\nimport {\n  RATIOS,\n  getDisplaySize,\n  createProjection,\n  getAlbumHeight\n} from \"./dimensions\";\n\nimport drawCircle from \"./drawCircle\";\nimport drawAlbum from \"./drawAlbum\";\nimport drawRefLine from \"./drawRefLine\";\nimport drawWave from \"./drawWave\";\nimport { createLastSampleInfo } from \"./lastSampleInfo\";\nimport { createImprint } from \"./imprint\";\nimport getAlbumInfo from \"./getAlbumInfo\";\n\nconst getDisplayScale = (fixedAspectRatio, width) =>\n  fixedAspectRatio === RATIOS.sixteenTenths ? width / 5.9 : width / 6.5;\n\nconst CONFIG = {\n  geoMapUrl: \"https://unpkg.com/world-atlas@1.1.4/world/110m.json\",\n  imprint: false,\n  focus: {\n    lambda: -10,\n    verticalShift: 15,\n    scaleFactor: 1\n  }\n};\n\n/**\n * It stores the state required to render visualizations\n */\nexport default class Display {\n  constructor(set, el) {\n    this.config = Object.assign({}, CONFIG, set.visuals);\n    this.set = set;\n    this.element = el;\n    this.el = d3.select(el);\n    this.circles = {};\n    this.albums = {};\n    this.refLines = {};\n    this.infos = {};\n    this.fixedAspectRatio = RATIOS.sixteenTenths;\n  }\n\n  setGeodata(geodata) {\n    this.geodata = geodata;\n    this.countries = topojson.feature(\n      geodata,\n      geodata.objects.countries\n    ).features;\n    this.render();\n  }\n\n  show(name) {\n    const info = getAlbumInfo(this.set, name);\n    if (!info) return;\n\n    const { screenWidth, screenHeight } = getDisplaySize(\n      this.fixedAspectRatio,\n      this.element\n    );\n    let [cx, cy] = this.projection(info.lnglat);\n\n    const circle = drawCircle(this.circlesContainer, screenWidth, cx, cy, info);\n    this.circles[name] = circle;\n\n    const album = drawAlbum(this.albumsContainer, screenWidth, info);\n    this.albums[name] = album;\n\n    const refLine = drawRefLine(\n      this.refLinesContainer,\n      screenWidth,\n      cx,\n      cy,\n      info.trackNumber,\n      info.trackColor\n    );\n    this.refLines[name] = refLine;\n\n    drawWave(\n      this.wavesContainer,\n      screenWidth,\n      cx,\n      cy,\n      info.trackColor,\n      info.trackVolume\n    );\n\n    const lastSampleInfo = createLastSampleInfo(\n      this.lastSampleInfoContainer,\n      screenWidth,\n      screenHeight,\n      info\n    );\n    this.infos[name] = lastSampleInfo;\n\n    if (this.config.imprint) createImprint(info.lnglat, info.trackColor);\n  }\n\n  hide(name) {\n    const circle = this.circles[name];\n    if (circle) {\n      circle.remove();\n      this.circles[name] = null;\n    }\n\n    const album = this.albums[name];\n    if (album) {\n      album.remove();\n      this.albums[name] = null;\n    }\n\n    const refLine = this.refLines[name];\n    if (refLine) {\n      refLine.remove();\n      this.refLines[name] = null;\n    }\n\n    const lastSampleInfo = this.infos[name];\n    if (lastSampleInfo) {\n      lastSampleInfo.remove();\n      this.infos[name] = null;\n    }\n  }\n\n  clear() {\n    this.el.selectAll(\"*\").remove();\n  }\n\n  render() {\n    const size = getDisplaySize(this.fixedAspectRatio, this.element);\n    const { screenWidth, screenHeight } = size;\n    const scale = getDisplayScale(this.fixedAspectRatio, screenWidth);\n    const focusedScale = scale * this.config.focus.scaleFactor;\n    const lambda = this.config.focus.lambda;\n    const verticalShift = this.config.focus.verticalShift;\n    const albumsHeight = getAlbumHeight(screenWidth);\n\n    this.clear();\n\n    const svg = this.el\n      .append(\"svg\")\n      .attr(\"id\", \"svgMap\")\n      .attr(\"width\", screenWidth)\n      .attr(\"height\", screenHeight);\n\n    this.mapContainer = svg\n      .append(\"g\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`)\n      .append(\"g\")\n      .attr(\"id\", \"map\");\n\n    this.albumsContainer = svg.append(\"g\").attr(\"id\", \"albums\");\n    this.refLinesContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"refLines\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n    this.circlesContainer = svg\n      .append(\"g\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`)\n      .append(\"g\")\n      .attr(\"id\", \"circles\");\n    this.wavesContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"waves\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n    this.lastSampleInfoContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"lastSampleInfo\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n\n    // Draw map\n    if (this.geodata) {\n      this.projection = createProjection(\n        screenWidth,\n        screenHeight - albumsHeight,\n        focusedScale,\n        verticalShift,\n        lambda\n      );\n      const path = d3.geoPath().projection(this.projection);\n      this.mapContainer\n        .selectAll(\".countries\")\n        .data(this.countries)\n        .enter()\n        .append(\"path\")\n        .attr(\"id\", d => `country${d.id}`)\n        .attr(\"class\", \"countries\")\n        .attr(\"d\", path)\n        .style(\"stroke\", \"#2c2c2c\")\n        .style(\"stroke-width\", 0.5)\n        .style(\"fill\", d => (d.id === \"010\" ? \"none\" : \"#888888\")); // 010 Antartica\n    }\n  }\n}\n","import {\n  getCoverSize,\n  getHorizontalPadding,\n  getVerticalPadding,\n  getInfoHeight,\n  getDotOffsetX,\n  DOT_RADIUS\n} from \"./dimensions\";\n\nexport default function createAlbum(parent, screenWidth, params) {\n  const { trackNumber, imageUrl, year, country, trackColor } = params;\n  const album = parent.append(\"g\");\n  const coverSize = getCoverSize(screenWidth);\n  const horizontalPadding = getHorizontalPadding(screenWidth);\n  const verticalPadding = getVerticalPadding(screenWidth);\n  const dotOffsetX = getDotOffsetX(screenWidth, trackNumber);\n  const infoHeight = getInfoHeight(screenWidth);\n  const fontSize = \"1.1vw\";\n\n  album\n    .append(\"svg:image\")\n    .attr(\"width\", coverSize)\n    .attr(\"height\", coverSize)\n    .attr(\"x\", trackNumber * coverSize)\n    .attr(\"y\", 0)\n    .style(\"stroke\", \"white\")\n    .attr(\"xlink:href\", imageUrl);\n\n  // Draw country rectangle\n  album\n    .append(\"rect\")\n    .attr(\"width\", coverSize)\n    .attr(\"height\", infoHeight)\n    .attr(\"x\", trackNumber * coverSize)\n    .attr(\"y\", coverSize + verticalPadding)\n    .style(\"fill\", trackColor);\n\n  // Draw country text\n  const countryText = album\n    .append(\"text\")\n    .attr(\"id\", \"countryText\" + trackNumber)\n    .attr(\"x\", trackNumber * coverSize + horizontalPadding)\n    .attr(\"y\", coverSize + verticalPadding + infoHeight / 2)\n    .attr(\"dy\", \"0.35em\")\n    .style(\"font-size\", fontSize)\n    .text(country);\n\n  // Trucate text larger than coverSize\n  const countryTextId = \"countryText\" + trackNumber;\n  function wrap(textElement, textId) {\n    let textLength = document.getElementById(textId).getBBox().width;\n    let text = textElement.text();\n\n    while (textLength > coverSize - horizontalPadding * 2 && text.length > 0) {\n      text = text.slice(0, -1);\n      textElement.text(text + \"...\");\n      textLength = document.getElementById(textId).getBBox().width;\n    }\n  }\n  wrap(countryText, countryTextId);\n\n  // Draw date point\n  album\n    .append(\"circle\")\n    .attr(\"cx\", dotOffsetX)\n    .attr(\"cy\", coverSize + verticalPadding + infoHeight * 2)\n    .attr(\"r\", DOT_RADIUS)\n    .style(\"fill\", trackColor);\n\n  // Draw date text\n  album\n    .append(\"text\")\n    .attr(\"x\", trackNumber * coverSize + horizontalPadding)\n    .attr(\"y\", coverSize + verticalPadding + infoHeight * 1.5)\n    .attr(\"dy\", \"0.35em\")\n    .style(\"font-size\", fontSize)\n    .style(\"fill\", trackColor)\n    .text(year);\n\n  return album;\n}\n","import * as d3 from \"d3\";\nimport { getDotOffsetX } from \"./dimensions\";\n\nexport default function createRefLine(\n  parent,\n  windowWidth,\n  cx,\n  cy,\n  trackNumber,\n  trackColor\n) {\n  const x1 = getDotOffsetX(windowWidth, trackNumber);\n  const y1 = 0;\n  const x2 = cx;\n  const y2 = cy;\n  const h = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n  const a = h / 10;\n  const alfa = Math.acos((y2 - y1) / h);\n  const curveCoords = [\n    {\n      x: x1,\n      y: y1\n    },\n    {\n      x: x1 + (x2 - x1) / 2 + a * Math.cos(Math.PI - alfa),\n      y: y1 + (y2 - y1) / 2 + a * Math.sin(Math.PI - alfa)\n    },\n    { x: x2, y: y2 }\n  ];\n\n  const line = d3\n    .line()\n    .x(d => d.x)\n    .y(d => d.y)\n    .curve(d3.curveBasis);\n\n  const refLine = parent\n    .append(\"path\")\n    .datum(curveCoords)\n    .attr(\"d\", line)\n    .style(\"stroke\", trackColor)\n    .style(\"stroke-dasharray\", \"2, 3\")\n    .style(\"fill\", \"none\")\n    .style(\"stroke-width\", 2);\n\n  return refLine;\n}\n","import * as d3 from \"d3\";\n\nexport default function createWave(\n  parent,\n  screenWidth,\n  cx,\n  cy,\n  trackColor,\n  trackVolume\n) {\n  const firstRadius = Math.floor((screenWidth / 30) * trackVolume);\n  const lastRadius = 150;\n  const radius = d3.range(firstRadius, lastRadius);\n  const duration = 20;\n\n  const wave = parent\n    .append(\"circle\")\n    .attr(\"cx\", cx)\n    .attr(\"cy\", cy)\n    .attr(\"r\", 0)\n    .style(\"fill\", \"none\")\n    .style(\"stroke\", trackColor);\n\n  radius.forEach((r, i) => {\n    const initialWidth = 2;\n    const strokeWidth = initialWidth - (initialWidth * r) / lastRadius;\n    wave\n      .transition()\n      .duration(duration)\n      .delay(i * duration)\n      .attr(\"r\", r)\n      .style(\"stroke-width\", strokeWidth)\n      .on(\"end\", (d, i, nodes) => {\n        if (r === lastRadius - 1) nodes[i].remove();\n      });\n  });\n\n  return wave;\n}\n","import * as d3 from \"d3\";\nimport * as chroma from \"chroma-js\";\n\nexport function createImprint(point, color) {\n  d3.selectAll(\".countries\").each(polygon => {\n    const inside = d3.geoContains(polygon, point);\n    if (inside) {\n      const base = d3.select(`#country${polygon.id}`).style(\"fill\");\n      d3.select(`#country${polygon.id}`)\n        // .style(\"fill\", chroma.blend(base, color, \"lighten\").hex()); // applies trackColor\n        .style(\"fill\", chroma(base).brighten(0.2)); // gray to white. Step: 0.2\n    }\n  });\n}\n","import { getAlbumHeight } from \"./dimensions\";\n\nexport function createLastSampleInfo(\n  parent,\n  screenWidth,\n  screenHeight,\n  { title, artist, album, trackColor }\n) {\n  // Clear\n  parent.select(\"#lastSampleInfoGroup\").remove();\n  const lastSampleInfo = parent.append(\"g\").attr(\"id\", \"lastSampleInfoGroup\");\n  const rectSize = screenWidth / 20;\n  const albumsHeight = getAlbumHeight(screenWidth);\n  const horizontalPadding = screenWidth / 190;\n  const verticalPadding = rectSize / 3;\n  const x = screenWidth - rectSize;\n  const y = screenHeight - albumsHeight - rectSize;\n  const dy = \"-0.35em\";\n  const fontSize = \"1.1vw\";\n\n  lastSampleInfo\n    .append(\"rect\")\n    .attr(\"width\", rectSize)\n    .attr(\"height\", rectSize)\n    .attr(\"x\", x)\n    .attr(\"y\", y)\n    .style(\"fill\", trackColor);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 1)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"title\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 1)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(title);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 2)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"artist\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 2)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(artist);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 3)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"album\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 3)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(album);\n\n  return lastSampleInfo;\n}\n","import Display from \"./display\";\nimport { START_VISUALS, STOP_VISUALS } from \"../session/events\";\nimport { SET_AUDIO_CLIP_STATUS } from \"../session/actions\";\nimport Resources from \"../audioset/resources\";\nexport default { connect };\n\nexport function connect(session) {\n  const { events } = session;\n  let display;\n\n  events.on(START_VISUALS, ({ audioset, el }) => {\n    display = createDisplay(audioset, el);\n    Resources.loadResources(audioset, \"covers\");\n  });\n\n  events.on(STOP_VISUALS, () => {\n    if (display && display.resize) {\n      window.removeEventListener(\"resize\", display.resize);\n    }\n  });\n\n  events.on(\"action\", action => {\n    if (action.type === SET_AUDIO_CLIP_STATUS) {\n      if (action.status.isPlaying) display.show(action.clipId);\n      else display.hide(action.clipId);\n    }\n  });\n}\n\nexport function init(set, events, el) {}\n\nfunction createDisplay(audioset, el) {\n  const display = new Display(audioset, el);\n  display.resize = () => display.render();\n  window.addEventListener(\"resize\", display.resize);\n  display.render();\n  fetch(audioset.visuals.geoMapUrl)\n    .then(response => response.json())\n    .then(data => display.setGeodata(data));\n\n  return display;\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\n\n// http://svgicons.sparkk.fr/\nconst ICONS = {\n  stop: \"M6 6h12v12H6z\",\n  fly:\n    \"M17.218,2.268L2.477,8.388C2.13,8.535,2.164,9.05,2.542,9.134L9.33,10.67l1.535,6.787c0.083,0.377,0.602,0.415,0.745,0.065l6.123-14.74C17.866,2.46,17.539,2.134,17.218,2.268 M3.92,8.641l11.772-4.89L9.535,9.909L3.92,8.641z M11.358,16.078l-1.268-5.613l6.157-6.157L11.358,16.078z\",\n  mute:\n    \"M18.084,11.639c0.168,0.169,0.168,0.442,0,0.611c-0.084,0.084-0.195,0.127-0.306,0.127c-0.111,0-0.221-0.043-0.306-0.127l-1.639-1.639l-1.639,1.639c-0.084,0.084-0.195,0.127-0.306,0.127c-0.111,0-0.222-0.043-0.307-0.127c-0.168-0.169-0.168-0.442,0-0.611L15.223,10l-1.64-1.639c-0.168-0.168-0.168-0.442,0-0.61c0.17-0.169,0.442-0.169,0.612,0l1.639,1.639l1.639-1.639c0.169-0.169,0.442-0.169,0.611,0c0.168,0.168,0.168,0.442,0,0.61L16.445,10L18.084,11.639z M12.161,2.654v14.691c0,0.175-0.105,0.333-0.267,0.4c-0.054,0.021-0.109,0.032-0.166,0.032c-0.111,0-0.223-0.043-0.305-0.127l-3.979-3.979H2.222c-0.237,0-0.432-0.194-0.432-0.432V6.759c0-0.237,0.195-0.432,0.432-0.432h5.222l3.979-3.978c0.123-0.125,0.309-0.163,0.471-0.095C12.056,2.322,12.161,2.479,12.161,2.654 M7.192,7.192H2.654v5.617h4.538V7.192z M11.296,3.698l-3.24,3.241v6.123l3.24,3.24V3.698z\",\n  cinema:\n    \"M18.175,4.142H1.951C1.703,4.142,1.5,4.344,1.5,4.592v10.816c0,0.247,0.203,0.45,0.451,0.45h16.224c0.247,0,0.45-0.203,0.45-0.45V4.592C18.625,4.344,18.422,4.142,18.175,4.142 M4.655,14.957H2.401v-1.803h2.253V14.957zM4.655,12.254H2.401v-1.803h2.253V12.254z M4.655,9.549H2.401V7.747h2.253V9.549z M4.655,6.846H2.401V5.043h2.253V6.846zM14.569,14.957H5.556V5.043h9.013V14.957z M17.724,14.957h-2.253v-1.803h2.253V14.957z M17.724,12.254h-2.253v-1.803h2.253V12.254zM17.724,9.549h-2.253V7.747h2.253V9.549z M17.724,6.846h-2.253V5.043h2.253V6.846z\",\n  controls:\n    \"M6.176,7.241V6.78c0-0.221-0.181-0.402-0.402-0.402c-0.221,0-0.403,0.181-0.403,0.402v0.461C4.79,7.416,4.365,7.955,4.365,8.591c0,0.636,0.424,1.175,1.006,1.35v3.278c0,0.222,0.182,0.402,0.403,0.402c0.222,0,0.402-0.181,0.402-0.402V9.941c0.582-0.175,1.006-0.714,1.006-1.35C7.183,7.955,6.758,7.416,6.176,7.241 M5.774,9.195c-0.332,0-0.604-0.272-0.604-0.604c0-0.332,0.272-0.604,0.604-0.604c0.332,0,0.604,0.272,0.604,0.604C6.377,8.923,6.105,9.195,5.774,9.195 M10.402,10.058V6.78c0-0.221-0.181-0.402-0.402-0.402c-0.222,0-0.402,0.181-0.402,0.402v3.278c-0.582,0.175-1.006,0.714-1.006,1.35c0,0.637,0.424,1.175,1.006,1.351v0.461c0,0.222,0.181,0.402,0.402,0.402c0.221,0,0.402-0.181,0.402-0.402v-0.461c0.582-0.176,1.006-0.714,1.006-1.351C11.408,10.772,10.984,10.233,10.402,10.058M10,12.013c-0.333,0-0.604-0.272-0.604-0.604S9.667,10.805,10,10.805c0.332,0,0.604,0.271,0.604,0.604S10.332,12.013,10,12.013M14.629,8.448V6.78c0-0.221-0.182-0.402-0.403-0.402c-0.221,0-0.402,0.181-0.402,0.402v1.668c-0.581,0.175-1.006,0.714-1.006,1.35c0,0.636,0.425,1.176,1.006,1.351v2.07c0,0.222,0.182,0.402,0.402,0.402c0.222,0,0.403-0.181,0.403-0.402v-2.07c0.581-0.175,1.006-0.715,1.006-1.351C15.635,9.163,15.21,8.624,14.629,8.448 M14.226,10.402c-0.331,0-0.604-0.272-0.604-0.604c0-0.332,0.272-0.604,0.604-0.604c0.332,0,0.604,0.272,0.604,0.604C14.83,10.13,14.558,10.402,14.226,10.402 M17.647,3.962H2.353c-0.221,0-0.402,0.181-0.402,0.402v11.27c0,0.222,0.181,0.402,0.402,0.402h15.295c0.222,0,0.402-0.181,0.402-0.402V4.365C18.05,4.144,17.869,3.962,17.647,3.962 M17.245,15.232H2.755V4.768h14.49V15.232z\",\n  stop2:\n    \"M10 0c-5.523 0-10 4.477-10 10s4.477 10 10 10 10-4.477 10-10-4.477-10-10-10zM10 18.125c-4.487 0-8.125-3.638-8.125-8.125s3.638-8.125 8.125-8.125 8.125 3.638 8.125 8.125-3.638 8.125-8.125 8.125zM6.25 6.25h7.5v7.5h-7.5z\",\n  fullscreen:\n    \"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z\",\n  keyboard:\n    \"M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z\",\n  volumeUp:\n    \"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z\",\n  volumeDown:\n    \"M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z\",\n  volumeOff:\n    \"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z\"\n};\n\nconst Icon = ({ icon, color, onClick }) => (\n  <svg\n    fill={color || \"#CCC\"}\n    onClick={onClick}\n    height=\"20\"\n    viewBox=\"0 0 20 20\"\n    width=\"20\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path d={ICONS[icon] || icon} />\n  </svg>\n);\n\nIcon.propTypes = {\n  icon: PropTypes.string,\n  color: PropTypes.string,\n  onClick: PropTypes.func\n};\n\nexport default Icon;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport cxs from \"cxs/component\";\nexport { default as Icon } from \"./Icon\";\n\nexport const Json = ({ obj }) => <pre>{JSON.stringify(obj)}</pre>;\nJson.propTypes = {\n  obj: PropTypes.object\n};\n\nexport const Button = cxs(\"button\")({\n  color: \"black\",\n  display: \"block\",\n  background: \"white\",\n  font: \"inherit\",\n  padding: \"0 1em\",\n  borderRadius: \"1em\",\n  \":hover\": {\n    textDecoration: \"underline\"\n  }\n});\n\nexport const Link = cxs(\"button\")({\n  color: \"white\",\n  display: \"block\",\n  background: \"none\",\n  font: \"inherit\",\n  border: 0\n});\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport { Icon } from \"../shared\";\n\nconst Toolbar = ({\n  className,\n  audioset,\n  audio,\n  onCloseAudioset,\n  onStopAll,\n  onTogglePads,\n  onToggleTracks,\n  onFullscreen\n}) => (\n  <header className={className}>\n    <div>\n      <Icon icon=\"fly\" onClick={onCloseAudioset} />\n    </div>\n    <Connection>\n      {audioset.meta.title}: {audioset.meta.description}\n    </Connection>\n    <Transport>\n      {audio.isPlaying ? <Icon icon=\"stop\" onClick={onStopAll} /> : \"\"}\n      <Icon icon=\"mute\" />\n    </Transport>\n    <Icon icon=\"controls\" onClick={onToggleTracks} />\n    <Icon icon=\"cinema\" onClick={onFullscreen} />\n  </header>\n);\nToolbar.propTypes = {\n  audioset: PropTypes.object\n};\n\nconst Transport = cxs(\"div\")({});\nconst Connection = cxs(\"div\")({\n  marginTop: \"3px\",\n  flexGrow: 1,\n  textAlign: \"center\"\n});\n\nexport default cxs(Toolbar)({\n  display: \"flex\",\n  flexDirection: \"row\",\n  backgroundColor: \"black\",\n  padding: \"2px 10px\"\n});\n","import React from \"react\";\nimport cxs from \"cxs\";\nimport PropTypes from \"prop-types\";\nimport { Link, Button } from \"../shared\";\n\nconst className = cxs({\n  margin: \"0 auto\",\n  lineHeight: \"2em\",\n  fontSize: \"14px\",\n  backgroundColor: \"black\",\n  \"& h1, & h2\": {\n    fontWeight: 400,\n    margin: \"1em 0\"\n  }\n});\n\nconst Welcome = ({\n  audioset,\n  audiosetIndex,\n  onChangeAudioset,\n  onCloseAudioset\n}) => (\n  <div className={className}>\n    {audiosetIndex && !audioset && (\n      <>\n        <h2>Empieza una nueva remezcla</h2>\n        {audiosetIndex.map(set => (\n          <Link key={set.id} onClick={() => onChangeAudioset(set)}>\n            {set.meta.title}: {set.meta.description}\n          </Link>\n        ))}\n      </>\n    )}\n\n    {audioset && (\n      <>\n        <h1>{audioset.meta.title}</h1>\n        <p>{audioset.meta.description}</p>\n        <Button onClick={onCloseAudioset}>Cerrar audioset</Button>\n      </>\n    )}\n  </div>\n);\nWelcome.propTypes = {\n  onChangeAudioset: PropTypes.func\n};\n\nexport default Welcome;\n","import React, { useState, useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport Welcome from \"./Welcome\";\nimport { fetchIndex, fetchAudioset } from \"../../audioset\";\nimport { setAudioset } from \"../../session/actions\";\n\nconst WelcomeState = ({ audioset, onClose, onChangeAudioset }) => {\n  const [isLoading, setIsLoading] = useState(true);\n  const [index, setIndex] = useState(null);\n  useEffect(\n    () => {\n      let mounted = true;\n      fetchIndex().then(index => mounted && setIndex(index));\n      return () => (mounted = false);\n    },\n    [audioset]\n  );\n\n  const changeAudioset = audioset => {\n    setIsLoading(true);\n    fetchAudioset(audioset.id)\n      .then(onChangeAudioset)\n      .then(onClose);\n  };\n\n  const closeAudioset = () => onChangeAudioset(null);\n\n  return (\n    <Welcome\n      audioset={audioset}\n      audiosetIndex={index}\n      onChangeAudioset={changeAudioset}\n      onCloseAudioset={closeAudioset}\n    />\n  );\n};\n\nconst mapStateToProps = state => state;\nconst mapDispatchToProps = dispatch => ({\n  onChangeAudioset: audioset => dispatch(setAudioset(audioset))\n});\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(WelcomeState);\n","import React, { useRef, useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport cxs from \"cxs/component\";\nimport { START_VISUALS, STOP_VISUALS } from \"../../session/events\";\n\nconst Visuals = ({ className, audioset, events }) => {\n  const el = useRef(null);\n  useEffect(\n    () => {\n      events.emit(START_VISUALS, { audioset, el: el.current });\n      return () => events.emit(STOP_VISUALS);\n    },\n    [audioset]\n  );\n  return <div className={className} ref={el} />;\n};\n\nVisuals.propTypes = {\n  audioset: PropTypes.object,\n  events: PropTypes.object\n};\n\nexport default cxs(Visuals)({\n  backgroundColor: \"gray\",\n  height: \"100%\"\n});\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"./Pad.css\";\n\nclass Pad extends React.Component {\n  constructor(props) {\n    super(props);\n    this.touched = false;\n  }\n\n  handlePress(isTouch) {\n    // prevent double click on mobile (https://github.com/facebook/react/issues/9809)\n    if (isTouch) {\n      this.touched = true;\n    } else if (this.touched === true) {\n      this.touched = false;\n      return;\n    }\n    const pressed = !this.props.pressed;\n    this.props[pressed ? \"onPress\" : \"onRelease\"](this.props.name);\n  }\n\n  render() {\n    const { color, pressed, touch, image, name } = this.props;\n    return (\n      <button\n        className={`Pad ${pressed ? \"pressed\" : \"\"}`}\n        style={{\n          borderColor: color\n        }}\n        onTouchStart={touch ? () => this.handlePress(true) : undefined}\n        onMouseDown={() => this.handlePress(false)}\n      >\n        {image ? <img src={image} alt={name} /> : \"\"}\n      </button>\n    );\n  }\n}\n\nPad.propTypes = {\n  name: PropTypes.string,\n  color: PropTypes.string,\n  prtessed: PropTypes.bool,\n  touch: PropTypes.bool,\n  image: PropTypes.string\n};\n\nexport const EmptyPad = ({ name }) => (\n  <button className=\"Pad\" style={{ borderColor: \"transparent\" }}>\n    {name}\n  </button>\n);\n\nexport default Pad;\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport Pad from \"./Pad\";\n\nconst TrackPads = ({ track, status, onPadPressed, onPadReleased }) => (\n  <div>\n    {track.clipIds.map(name => (\n      <Pad\n        key={name}\n        name={name}\n        pressed={status[name] && status[name].isPlaying}\n        color={track.color}\n        onPress={onPadPressed}\n        onRelease={onPadReleased}\n      />\n    ))}\n  </div>\n);\n\nconst Pads = ({ audioset, status, className, onPadPressed, onPadReleased }) => {\n  return (\n    <div className={className}>\n      {audioset.tracks.map(track => (\n        <TrackPads\n          key={track.name}\n          track={track}\n          status={status}\n          onPadPressed={onPadPressed}\n          onPadReleased={onPadReleased}\n        />\n      ))}\n    </div>\n  );\n};\nPads.propTypes = {\n  onPadPressed: PropTypes.func\n};\nexport default cxs(Pads)({\n  backgroundColor: \"black\",\n  minWidth: \"30em\",\n  minHeight: \"100%\"\n});\n","import { connect } from \"react-redux\";\nimport Pads from \"./Pads\";\nimport { pressPad, releasePad } from \"../../session/actions\";\n\nconst mapStateToProps = session => ({\n  audioset: session.audioset,\n  status: session.audio.status\n});\n\nconst mapDispatchToProps = dispatch => ({\n  onPadPressed: pad => dispatch(pressPad(pad)),\n  onPadReleased: pad => dispatch(releasePad(pad))\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Pads);\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\n\nconst Base = ({ onPress, onRelease, className, children }) => (\n  <button className={className} onMouseDown={onPress} onMouseUp={onRelease}>\n    {children}\n  </button>\n);\nBase.propTypes = {\n  pressed: PropTypes.bool,\n  onPress: PropTypes.func,\n  onRelease: PropTypes.func\n};\n\nconst Trigger = cxs(Base)(props => ({\n  border: `2px solid ${props.color}`,\n  color: props.color,\n  backgroundColor: props.pressed ? props.color : \"black\",\n  marginRight: \"0.5em\",\n  padding: \"1px 3px\",\n  \"&:hover\": {\n    backgroundColor: props.color,\n    color: \"black\"\n  }\n}));\n\nTrigger.propTypes = {\n  color: PropTypes.string\n};\n\nexport default Trigger;\n","import React from \"react\";\nimport cxs from \"cxs\";\nimport component from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport Trigger from \"../shared/Trigger\";\n\nconst Track = component(\"div\")(props => ({\n  color: props.color,\n  borderTop: `2px solid ${props.active ? props.color : \"black\"}`,\n  \"> h2\": {\n    marginTop: \"5px\"\n  },\n  marginBottom: \"1em\"\n}));\n\nconst className = cxs({ padding: \"1em\" });\n\nconst Tracks = ({\n  audioset,\n  volumes,\n  playing,\n  status,\n  onVolumeChanged,\n  onPress,\n  onRelease\n}) => (\n  <div className={className}>\n    <h2>Tracks</h2>\n    {audioset.tracks.map(track => (\n      <Track key={track.id} active={playing[track.id]} color={track.color}>\n        <h2>{track.id}</h2>\n        <div>\n          {track.clipIds.map(clipId => (\n            <Trigger\n              key={clipId}\n              pressed={status[clipId] && status[clipId].isPlaying}\n              onPress={() => onPress(clipId)}\n              onRelease={() => onRelease(clipId)}\n              color={audioset.clips[clipId].display.color}\n            >\n              {clipId}\n            </Trigger>\n          ))}\n        </div>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          value={volumes[track.id]}\n          onChange={e => onVolumeChanged(track.id, e.target.value)}\n        />\n      </Track>\n    ))}\n  </div>\n);\n\nTracks.propTypes = {\n  audio: PropTypes.object\n};\n\nexport default Tracks;\n","import { connect } from \"react-redux\";\nimport Tracks from \"./Tracks\";\nimport { changeTrackVolume, pressPad, releasePad } from \"../../session/actions\";\n\nconst mapStateToProps = session => ({\n  audioset: session.audioset,\n  status: session.audio.status,\n  volumes: session.tracks.volumes,\n  playing: session.tracks.playing\n});\n\nconst mapDispatchToProps = dispatch => ({\n  onVolumeChanged: (track, value) => dispatch(changeTrackVolume(track, value)),\n  onPress: pad => dispatch(pressPad(pad)),\n  onRelease: pad => dispatch(releasePad(pad))\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Tracks);\n","import { memo } from \"./cache\";\nimport { pressPad, releasePad } from \"../session/actions\";\n\nexport function connect(session) {\n  const pressed = {};\n  window.onkeydown = function(e) {\n    const key = e.key;\n    if (pressed[key]) return;\n    pressed[key] = true;\n    const keyMap = getKeyboardMap(session.getAudioset());\n    const clip = keyMap[key];\n    if (clip) session.dispatch(pressPad(clip.clipId));\n  };\n\n  window.onkeyup = function(e) {\n    const key = e.key;\n    pressed[key] = false;\n    const keyMap = getKeyboardMap(session.getAudioset());\n    const clip = keyMap[key];\n    if (clip) session.dispatch(releasePad(clip.clipId));\n  };\n\n  //\n}\n\nexport function getKeyboardMap(audioset) {\n  return memo(audioset, \"keyboardMap\", () => buildKeymap(audioset.keyboard));\n}\n\nfunction buildKeymap(keyboard) {\n  if (!keyboard) return {};\n  const { defaults, keyMap } = keyboard;\n  return Object.keys(keyMap).reduce((map, key) => {\n    const value = { ...defaults, ...keyMap[key] };\n    value.key = key;\n    map[key] = value;\n    map[key.toUpperCase()] = value;\n    map[value.clipId] = value;\n    return map;\n  }, {});\n}\n\nexport default { connect };\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport { getKeyboardMap } from \"../../audioset/inputs\";\nimport Trigger from \"../shared/Trigger\";\n\nconst Key = cxs(Trigger)(props => ({\n  marginRight: \"0.5em\",\n  padding: \"1px 3px\"\n}));\n\nconst Keyboard = ({ audioset, status, className, onPress, onRelease }) => {\n  const keyMap = getKeyboardMap(audioset);\n  return (\n    <div className={className}>\n      {audioset.tracks.map(track =>\n        track.clipIds.map(name => (\n          <Key\n            key={name}\n            pressed={status[name] && status[name].isPlaying}\n            color={track.color}\n            onPress={() => onPress(name)}\n            onRelease={() => onRelease(name)}\n          >\n            {keyMap[name] ? keyMap[name].key.toUpperCase() : \"-\"}\n          </Key>\n        ))\n      )}\n    </div>\n  );\n};\nKeyboard.propTypes = {\n  onKeyPressed: PropTypes.func\n};\nexport default cxs(Keyboard)({\n  backgroundColor: \"black\",\n  textAlign: \"center\",\n  padding: \"2px 10px 4px 10px\"\n});\n","import { connect } from \"react-redux\";\nimport Keyboard from \"./Keyboard\";\nimport { pressPad, releasePad } from \"../../session/actions\";\n\nconst mapStateToProps = session => ({\n  audioset: session.audioset,\n  status: session.audio.status\n});\n\nconst mapDispatchToProps = dispatch => ({\n  onPress: pad => dispatch(pressPad(pad)),\n  onRelease: pad => dispatch(releasePad(pad))\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Keyboard);\n","import * as screen from \"screenfull\";\n\nexport default { changeFullscreen, onChange };\n\nexport function changeFullscreen(isFullscreen) {\n  if (screen.enabled) {\n    if (isFullscreen) screen.request();\n    else screen.exit();\n  }\n}\n\nexport function onChange(callback) {\n  if (screen.enabled) {\n    screen.on(\"change\", () => callback(screen.isFullscreen));\n  }\n}\n","import React, { useReducer, useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport cxs from \"cxs/component\";\nimport Toolbar from \"./Toolbar\";\nimport Welcome from \"../Welcome\";\nimport Visuals from \"./Visuals\";\nimport Pads from \"../Pads\";\nimport Tracks from \"../Tracks\";\nimport Keyboard from \"../Keyboard\";\nimport Modal from \"react-modal\";\nimport Fullscreen from \"../../browser/fullscreen\";\n\nconst initialState = audioset => ({\n  isFullscreen: false,\n  welcomeVisible: !audioset,\n  padsVisible: false,\n  tracksVisible: true\n});\n\n// Actions\nconst setWelcomeVisible = isVisible => ({ type: \"welcome\", isVisible });\nconst setPadsVisible = isVisible => ({ type: \"pads\", isVisible });\nconst setTracksVisible = isVisible => ({ type: \"tracks\", isVisible });\nconst setFullscreen = isFullscreen => ({ type: \"fullscreen\", isFullscreen });\n\nfunction reducer(state, action) {\n  console.log(\"joder\", state, action);\n  switch (action.type) {\n    case \"welcome\":\n      return { ...state, welcomeVisible: action.isVisible };\n    case \"fullscreen\":\n      return { ...state, isFullscreen: action.isFullscreen };\n    case \"pads\":\n      return { ...state, padsVisible: action.isVisible };\n    case \"tracks\":\n      return { ...state, tracksVisible: action.isVisible };\n    default:\n      return state;\n  }\n}\n\nconst App = ({ audioset, events, dispatch }) => {\n  const [state, disp] = useReducer(reducer, initialState(audioset));\n\n  // Handlers\n  const togglePads = () => disp(setPadsVisible(!state.padsVisible));\n  const toggleTracks = () => disp(setTracksVisible(!state.tracksVisible));\n  const showFullscreen = () => Fullscreen.changeFullscreen(!state.isFullscreen);\n  const hideWelcome = () => disp(setWelcomeVisible(false));\n  const showWelcome = () => disp(setWelcomeVisible(true));\n\n  useEffect(\n    () =>\n      Fullscreen.onChange(isFullscreen => disp(setFullscreen(isFullscreen))),\n    [dispatch]\n  );\n\n  const notFull = !state.isFullscreen;\n\n  return (\n    <>\n      {audioset && (\n        <Main className=\"App\">\n          {notFull && (\n            <Toolbar\n              audioset={audioset}\n              audio={{}}\n              onCloseAudioset={showWelcome}\n              onTogglePads={togglePads}\n              onToggleTracks={toggleTracks}\n              onFullscreen={showFullscreen}\n            />\n          )}\n          <Content>\n            {notFull && state.padsVisible && <Pads />}\n            <Center>\n              <Visuals audioset={audioset} events={events} />\n            </Center>\n            {notFull && state.tracksVisible && <Tracks />}\n          </Content>\n          {notFull && <Keyboard />}\n        </Main>\n      )}\n      <Modal\n        isOpen={!audioset || state.welcomeVisible}\n        shouldCloseOnOverlayClick={true}\n        onRequestClose={hideWelcome}\n        style={ModalStyles}\n      >\n        <Welcome onClose={hideWelcome} />\n      </Modal>\n    </>\n  );\n};\n\nApp.propTypes = {\n  audioset: PropTypes.object,\n  events: PropTypes.object\n};\n\nconst ModalStyles = {\n  overlay: {\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\"\n  },\n  content: {\n    // http://lynn.io/2014/02/22/modalin/\n    position: \"fixed\",\n    maxHeight: \"calc(100% - 100px)\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n\n    // position: \"absolute\",\n    // top: \"40px\",\n    // left: \"0px\",\n    // right: \"auto\",\n    // bottom: \"40px\",\n    border: \"\",\n    background: \"black\",\n    borderRadius: 0\n  }\n};\n\nconst Main = cxs(\"div\")({\n  display: \"flex\",\n  flexDirection: \"column\",\n  minHeight: \"100vh\"\n});\n\nconst Content = cxs(\"div\")({\n  display: \"flex\",\n  flexGrow: 1,\n  flexDirection: \"row\",\n  height: \"100%\",\n  minHeight: \"100%\",\n  maxHeight: \"100%\",\n  overflow: \"hidden\"\n});\n\nconst Center = cxs(\"div\")({\n  flexGrow: 1\n});\n\nexport default App;\n","import { connect } from \"react-redux\";\nimport Desktop from \"./Desktop\";\n\nconst mapStateToProps = session => ({\n  audioset: session.audioset\n});\n\nexport default connect(mapStateToProps)(Desktop);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport Desktop from \"./Desktop\";\n\nconst App = ({ events }) => {\n  return <Desktop events={events} />;\n};\nApp.propTypes = {};\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { loadState, autosave } from \"./browser/localStorage\";\nimport { setAudioset } from \"./session/actions\";\nimport Session from \"./session\";\nimport Rooms from \"./rooms\";\nimport Audio from \"./audio\";\nimport Visuals from \"./visuals\";\nimport App from \"./ui/App\";\nimport Modal from \"react-modal\";\nimport Inputs from \"./audioset/inputs\";\nimport { fetchAudioset } from \"./audioset\";\n\nconst ENV = process.env.NODE_ENV;\nconst WEBSOCKETS_URL = \"http://localhost:4000\";\n\nconst session = Session.init(loadState());\nautosave(session.store);\n\nInputs.connect(session);\n\n// This two pieces will be moved eventually to code-spliting\nAudio.connect(session);\nVisuals.connect(session);\n\nconst audioset = session.getAudioset();\nif (audioset) {\n  // reload the audioset on development\n  if (ENV === \"development\")\n    fetchAudioset(audioset.id).then(audioset =>\n      session.dispatch(setAudioset(audioset))\n    );\n  else if (ENV !== \"development\") session.dispatch(setAudioset(audioset));\n}\n\nconst element = document.getElementById(\"app\");\nModal.setAppElement(element);\nReactDOM.render(\n  <Provider store={session.store}>\n    <App events={session.events} />\n  </Provider>,\n  element\n);\n"],"sourceRoot":""}
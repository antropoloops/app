(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{43:function(t,e,n){t.exports=n(64)},64:function(t,e,n){"use strict";n.r(e);var r=n(2),a=n.n(r),o=n(9),i=n.n(o),s=n(14),c="[playback] ",u=function(t){return c+t},l=u("SYNC_PLAYBACK"),d=function(t){return{type:l,playback:t}},p=function(t){return{type:l,playback:{audioset:t}}},f=u("PRESS_PAD"),h=function(t){return{type:f,clipId:t}},y=u("RELEASE_PAD"),m=function(t){return{type:y,clipId:t}},v=u("START_AUDIO_CLIP"),b=u("STOP_AUDIO_CLIP"),g=u("SET_AUDIO_STARTED"),k=u("SET_AUDIO_STOPPED"),S=u("AUDIO_STOP_ALL"),O=u("CHANGE_TRACK_VOLUME"),E=n(7),w=n.n(E),x=w()("div")({display:"flex",flexDirection:"column"}),C=w()(x)({backgroundColor:"black",padding:"1em"});C.Layout=x,C.Section=C.Header=C.Footer=w()("div")({backgroundColor:"black"}),C.Content=C.Main=w()("div")({flexGrow:1});var I=C,j=function(){return a.a.createElement(I,{className:"Control"},a.a.createElement(I.Header,null,"Top"),a.a.createElement(I.Content,null,"Center"),a.a.createElement(I.Header,null,"Connected"))},A=n(22),T=n.n(A),R={overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:900},content:{position:"fixed",maxHeight:"calc(100% - 100px)",top:"50%",left:"50%",transform:"translate(-50%, -50%)",border:"",background:"black",borderRadius:0,zIndex:1e3}},_=function(t){var e=t.isOpen,n=t.onRequestClose,r=t.children;return a.a.createElement(T.a,{isOpen:e,shouldCloseOnOverlayClick:!0,onRequestClose:n,style:R},r)},N=n(10),L=n(5),P=n(17),D=null;var M={isPlaying:!1,status:"STOP",startedAt:null};var U=function(t,e){return t.tracks.reduce(function(t,n){return t[n.id]=e,t},{})};function z(t){return t?{playing:U(t,0),volumes:U(t,75)}:{playing:{},volumes:{}}}var G=Object(N.c)({audioset:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case l:return e.playback.audioset;default:return t}},audio:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case g:return Object(L.a)({},t,{status:"PLAYING",startedAt:e.time});case k:return Object(L.a)({},t,{status:"STOP",startedAt:null});case v:case b:return Object(L.a)({},t,{status:Object(L.a)({},t.status,Object(P.a)({},e.clipId,e.status))});case S:return Object(L.a)({},t,{status:{}});default:return t}},tracks:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z(),e=arguments.length>1?arguments[1]:void 0;switch(e.type){case l:return z(e.playback.audioset);case v:case b:return function(t,e,n){var r=n.isPlaying?1:-1;return Object(L.a)({},t,{playing:Object(L.a)({},t.playing,Object(P.a)({},e,t.playing[e]+r))})}(t,e.trackId,e.status);case O:return function(t,e,n){return Object(L.a)({},t,{volumes:Object(L.a)({},t.volumes,Object(P.a)({},e,n))})}(t,e.trackId,e.value);default:return t}}}),H="INIT_SIDE_EFFECTS",B=function(t){return"/session/"+t},V=B("SET_AUDIOSET_INDEX"),F=B("LOAD_AUDIOSET"),q=B("TOGGLE_IS_CONTROL"),J=function(t){return{type:V,index:t}},W={audiosetIndex:null,isControl:!1};var K={user:null,room:null,roomList:[]},X=function(t){return"/sync/"+t},Y=X("SET_LOGGED_IN"),Q=X("CREATE_ROOM_REQUEST"),Z=X("SET_CURRENT_ROOM"),$=X("SET_ROOM_LIST"),tt=X("REQUEST_ROOM"),et=function(t){return{type:Y,user:t}},nt=function(t){return{type:Z,room:t}},rt=function(t){return{type:$,roomList:t}};var at={session:!0,pads:!1,tracks:!1,help:!1,fullscreen:!1},ot=function(t){return"/display/"+t},it=ot("SHOW_SESSION"),st=ot("TOGGLE_TRACKS"),ct=ot("TOGGLE_PADS"),ut=ot("SHOW_HELP"),lt=ot("HIDE_HELP"),dt=ot("SHOW_FULLSCREEN"),pt=ot("SET_FULLSCREEN"),ft=ot("SET_WINDOW_SIZE"),ht=function(t,e){return{type:ft,size:{width:t,height:e}}},yt=function(t){return{type:pt,isFullscreen:t}};var mt=Object(N.c)({playback:G,session:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case V:return Object(L.a)({},t,{audiosetIndex:e.index});case q:return Object(L.a)({},t,{isControl:!t.isControl});default:return t}},display:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case ft:return Object(L.a)({},t,{type:e.size.width<700?"mobile":"desktop"});case l:case it:return Object(L.a)({},t,{session:!t.session});case ut:return Object(L.a)({},t,{help:!0});case lt:return Object(L.a)({},t,{help:!1});case ct:return Object(L.a)({},t,{pads:!t.pads});case st:return Object(L.a)({},t,{tracks:!t.tracks});case pt:return Object(L.a)({},t,{fullscreen:e.isFullscreen});default:return t}},sync:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case Y:return Object(L.a)({},t,{user:e.user,room:t.room&&t.room.id===e.user.roomId?t.room:null});case Z:return Object(L.a)({},t,{room:e.room});case $:return Object(L.a)({},t,{roomList:e.roomList});default:return t}}}),vt=n(42),bt=[{target:"#Connection",content:"Has creado una sesi\xf3n. Puedes cambiarla o conectar con otros dispositivos aqu\xed",placement:"bottom",disableBeacon:!0},{target:"#Keyboard",content:"Usa el teclado para lanzar los sonidos. Tambi\xe9n puedes usar MIDI o un MakeyMakey!",placement:"top",disableBeacon:!0},{target:"#Transport",content:"Ponlo en pantalla completa o abre los controles",disableBeacon:!0}],gt={back:"Anterior",close:"Cerrar",last:"Ok, lo he pillado",next:"Siguiente",skip:"Salir"},kt={options:{arrowColor:"#111",backgroundColor:"#111",beaconSize:70,overlayColor:"rgba(255, 255, 255, 0.5)",primaryColor:"#000",spotlightShadow:"0 0 15px rgba(0, 0, 0, 0.5)",textColor:"white",width:void 0,zIndex:100},tooltip:{fontSize:14,fontFamily:"system"},buttonSkip:{fontSize:12}},St=function(t){var e=t.run,n=t.onStop;return a.a.createElement(vt.a,{callback:function(t){return"reset"===t.action&&n()},run:e,locale:gt,styles:kt,showProgress:!1,showSkipButton:!0,continuous:!0,steps:bt})},Ot=[];function Et(t,e){return t.startsWith("audioset://")&&console.log("save",t,e),Ot[t]=e,e}function wt(t){return Ot[t]}function xt(t){return void 0!==Ot[t]}function Ct(t,e,n){var r="audioset://".concat(t.id,"/").concat(e);return xt(r)?wt(r):Et(r,n())}function It(t,e){return xt(t)?Promise.resolve(wt(t)):fetch(t).then(e).then(function(e){return Et(t,e)})}function jt(t){return Ct(t,"keyboardMap",function(){return function(t){if(!t)return{};var e=t.defaults,n=t.keyMap;return Object.keys(n).reduce(function(t,r){var a=Object(L.a)({},e,n[r]);return a.key=r,t[r]=a,t[r.toUpperCase()]=a,t[a.clipId]=a,t},{})}(t.keyboard)})}var At=n(0),Tt=n.n(At),Rt=w()(function(t){var e=t.onPress,n=t.onRelease,r=t.className,o=t.children;return a.a.createElement("button",{className:r,onMouseDown:e,onMouseUp:n},o)})(function(t){return{border:"2px solid ".concat(t.color),color:t.color,backgroundColor:t.pressed?t.color:"black",marginRight:"0.5em",padding:"1px 3px","&:hover":{backgroundColor:t.color,color:"black"}}});Rt.propTypes={color:Tt.a.string};var _t=Rt,Nt=w()(_t)(function(t){return{marginRight:"0.5em",padding:"1px 3px"}}),Lt=w()(function(t){var e=t.audioset,n=t.status,r=t.className,o=t.onPress,i=t.onRelease,s=jt(e);return a.a.createElement("div",{className:r,id:"Keyboard"},e.tracks.map(function(t){return t.clipIds.map(function(e){return a.a.createElement(Nt,{key:e,pressed:n[e]&&n[e].isPlaying,color:t.color,onPress:function(){return o(e)},onRelease:function(){return i(e)}},s[e]?s[e].key.toUpperCase():"-")})}))})({backgroundColor:"black",textAlign:"center",padding:"2px 10px 4px 10px"}),Pt=Object(s.b)(function(t){return{audioset:t.playback.audioset,status:t.playback.audio.status}},function(t){return{onPress:function(e){return t(h(e))},onRelease:function(e){return t(m(e))}}})(Lt),Dt=w()("button")({color:"black",display:"block",background:"white",font:"inherit",padding:"0 1em",":hover":{textDecoration:"underline"}}),Mt=w()("button")({color:"white",cursor:"pointer",display:"block",background:"none",font:"inherit",border:0,":hover":{textDecoration:"underline"}}),Ut=function(t){var e=t.audiosetIndex,n=t.rooms,r=t.onOpenAudioset,o=t.onJoinRoom;return a.a.createElement("div",null,a.a.createElement("h2",null,"Empieza una nueva remezcla"),e.map(function(t){return a.a.createElement(Mt,{key:t.id,onClick:function(){return r(t.id)}},t.meta.title,": ",t.meta.description)}),a.a.createElement("h2",null,"Con\xe9ctate a una en marcha"),n.length?n.map(function(t){return a.a.createElement(Mt,{key:t.id,onClick:function(){return o(t)}},t.name)}):"No hay otras sesiones activas en este momento.")},zt=function(t){var e=t.audioset,n=t.onCloseAudioset,r=t.room,o=t.onRequestRoom;return a.a.createElement("div",{className:"Session"},a.a.createElement("h1",null,e.meta.title),a.a.createElement("p",null,e.meta.description),r?a.a.createElement("h2",null,"Room: ",r.name):a.a.createElement(Dt,{onClick:o},"Request room"),a.a.createElement(Dt,{onClick:n},"Cerrar audioset"))},Gt=Object(s.b)(function(t){return{audioset:t.playback.audioset,audiosetIndex:t.session.audiosetIndex,room:t.sync.room,rooms:t.sync.roomList}},function(t){return{openAudioset:function(e){return t({type:F,id:e})},closeAudioset:function(){return t(p(null))},requestRoom:function(){return t({type:Q})},joinRoom:function(e){return t(function(t){return{type:tt,room:t}}(e))}}})(function(t){var e=t.audioset,n=t.audiosetIndex,r=t.openAudioset,o=t.closeAudioset,i=t.room,s=t.rooms,c=t.requestRoom,u=t.joinRoom;return a.a.createElement(I,{id:"Session"},a.a.createElement(I.Header,null,a.a.createElement("h1",null,"Bienvenidx a Antropoloops")),a.a.createElement(I.Content,null,n&&!e&&a.a.createElement(Ut,{audiosetIndex:n,onOpenAudioset:r,rooms:s,onJoinRoom:u}),e&&a.a.createElement(zt,{audioset:e,room:i,onRequestRoom:c,onCloseAudioset:o})))}),Ht=w()(I.Layout)({height:"100vh"}),Bt={toggleSession:function(){return{type:it}},hideHelp:function(){return{type:lt}}},Vt=Object(s.b)(function(t){return{audioset:t.playback.audioset,display:t.display}},function(t){return Object(N.b)(Bt,t)})(function(t){var e=t.audioset,n=t.display,r=t.toggleSession,o=t.hideHelp,i=!n.fullscreen;return a.a.createElement(a.a.Fragment,null,e&&a.a.createElement(Ht,{className:"App"},i&&a.a.createElement(I.Section,null,e.id),a.a.createElement(I.Content,null),i&&a.a.createElement(Pt,null)),a.a.createElement(St,{run:n.help,onStop:o}),a.a.createElement(_,{isOpen:!e||n.session,onRequestClose:r},a.a.createElement(Gt,null)))}),Ft=function(t){return t.isMobile?a.a.createElement(j,null):a.a.createElement(Vt,null)},qt=n(23),Jt="atpls/session";var Wt=function(t){try{var e=JSON.stringify(t);localStorage.setItem(Jt,e)}catch(n){console.log("Error saving state",n)}};void 0!==typeof window&&(window.resetLocalStorage=function(){return Wt({})});var Kt=n(12),Xt=n(13),Yt=n(24),Qt=n.n(Yt),Zt="production";var $t=function(t,e){return n=function(t){var e=t.resources||{};return Object.assign({},e.default,e[Zt])}(t)[e]||"",function(t){return n&&n.replace("{{filename}}",t)};var n},te={getCachedResources:function(t,e){return Ct(t,e,function(){var n={},r=Object.keys(t.clips);return Promise.all(ae(t,e,r).map(function(t,e){return t.then(function(t){return n[r[e]]=t,t})})),n})},loadResources:ae,getResourceUrls:ee};function ee(t,e){var n=Object.keys(t.clips),r=$t(t,e);return n.reduce(function(t,e){return t[e]=r(e),t},{})}var ne=function(t){return t},re={audio:function(t){var e=Qt()();return t.arrayBuffer().then(function(t){return e.decodeAudioData(t)})}};function ae(t,e,n){n=n||Object.keys(t.clips);var r=$t(t,e),a=re[e]||ne;return n.map(function(t){return It(r(t),a)})}var oe=Qt()(),ie=1;function se(t,e,n){return t+function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ie;if(!e)return 0;var a=n/(60*r),o=t-e;return 0===o?0:(1-o*a%1)/a}(t,e,n)}var ce=function(){function t(e,n){Object(Kt.a)(this,t),this.bpm=e.audio.bpm||120,this.playing=0,this.startedAt=null,this.audioset=e,this.buffers={},this.sources={},this.events=n,this.output=function(t){var e=oe.createGain();return e.gain.value=t,e.connect(oe.destination),e}(.2)}return Object(Xt.a)(t,[{key:"play",value:function(t,e){e=e||se(oe.currentTime,this.startedAt,this.bpm);var n=this.buffers[t];n||console.warn("No buffer",t),this.stopTrack(t,e);var r=this.sources[t]=oe.createBufferSource();r.buffer=n,r.loop=!0,r.connect(this.output),r.start(e),this.started(t,e)}},{key:"stop",value:function(t,e){var n=this.sources[t];n&&(e=e||oe.currentTime,n.stop(e),this.sources[t]=null,this.stopped(t,e))}},{key:"stopTrack",value:function(t,e){var n=this,r=this.audioset.clips[t];this.audioset.tracks.find(function(t){return t.id===r.trackId}).clipIds.forEach(function(t){return n.stop(t,e)})}},{key:"stopAll",value:function(){var t=this,e=oe.currentTime;Object.keys(this.sources).forEach(function(n){return t.stop(n,e)})}},{key:"started",value:function(t,e){0===this.playing&&(this.startedAt=e,this.events.audioStarted(e)),this.playing++;var n=this.audioset.clips[t].trackId;this.events.audioClipStarted(t,n,oe.currentTime)}},{key:"stopped",value:function(t,e){var n=this.audioset.clips[t].trackId;this.events.audioClipStopeed(t,n,oe.currentTime),this.playing--,0===this.playing&&(this.startedAt=null,this.events.audioStopped(!1,e))}}]),t}();var ue=function(t){return{audioStarted:function(e){return t(function(t){return{type:g,time:t}}(e))},audioStopped:function(e){return t(function(t){return{type:k,time:t}}(!1))},audioClipStarted:function(e,n,r){return t(function(t,e,n){return{type:v,clipId:t,trackId:e,status:{isPlaying:!0,time:n}}}(e,n,r))},audioClipStopeed:function(e,n,r){return t(function(t,e,n){return{type:b,clipId:t,trackId:e,status:{isPlaying:!1,time:n}}}(e,n,r))}}},le=function(){function t(e){Object(Kt.a)(this,t),this.events=ue(e),this.currentSampler=null,this.samplers={}}return Object(Xt.a)(t,[{key:"restoreState",value:function(t){var e=t.audioset;e&&(!function(t,e){if(e){var n=function(t,e){var n=e.id;return t.samplers[n]?t.samplers[n]:(t.samplers[n]=new ce(e,t.events),t.samplers[n])}(t,e);n.buffers=te.getCachedResources(e,"audio"),t.currentSampler=n}else t.currentSampler=null}(this,e),this.currentSampler.stopAll())}},{key:"playSample",value:function(t){if(!this.currentSampler)return console.warn("NO sampler!");this.currentSampler.play(t)}},{key:"stopSample",value:function(t,e){if(!this.currentSampler)return console.warn("NO sampler!");this.currentSampler.stop(t)}},{key:"stopAll",value:function(){this.currentSampler&&this.currentSampler.stopAll()}}]),t}();var de=null;var pe="/app/audiosets",fe=function(t){return t.json()};var he=n(20);var ye=function(t,e){return t.send(JSON.stringify(e))};var me=n(41),ve=n(6),be=n(40),ge=n(39),ke=8,Se=2;function Oe(t){return t/450}function Ee(t){return t/50}function we(t){return t/ke}function xe(t){var e=Oe(t),n=Ee(t);return we(t)+e+2*n}function Ce(t,e){return e*we(t)+Se}var Ie={sixteenNinths:16/9,sixteenTenths:1.6};var je=36,Ae=ve.g().range([0,360]).domain([0,je]);function Te(t,e,n,r,a){var o=a.duration,i=a.trackVolume,s=a.trackColor,c=t.append("g").attr("class","circleGroup").attr("transform","translate(".concat(n,", ").concat(r,")")),u=c.append("g").attr("class","circle"),l=ve.a(),d=function(t,e,n){return ve.f(t).map(function(r,a){return{startAngle:Re(Ae(r)),endAngle:Re(Ae(a===t-1?r+1:r+2)),innerRadius:0,outerRadius:e/30*n*2}})}(je,e,i);u.selectAll(".outerArcs").data(d).enter().append("path").attr("class","outerArcs").attr("d",l).style("fill",s).style("opacity",function(t,e){return.3/je*e});var p=function(t,e,n){return ve.f(t).map(function(r,a){return{startAngle:Re(Ae(r)),endAngle:Re(Ae(a===t-1?r+1:r+2)),innerRadius:0,outerRadius:e/30*n}})}(je,e,i);u.selectAll(".innerArcs").data(p).enter().append("path").attr("class","innerArcs").attr("d",l).style("fill",s).style("opacity",function(t,e){return 1/je*e}),u.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",-(e/30*i+e/350)).style("stroke",s).style("stroke-width",1.5);var f=ve.j(function(t){var e=t/1e3%o,n=ve.g().range([1,0]).domain([0,o]);u.style("transform","rotate(".concat(-n(e),"turn)")),ve.h(".circle").empty()&&f.stop()});return c}function Re(t){return t*(Math.PI/180)}var _e=n(38);function Ne(t,e){var n=t.clips[e];if(n){var r=function(t,e){return Ct(t,"coverUrls",function(){return ee(t,"covers")})[e]}(t,n.name),a=t.meta.bpm||120;return{lnglat:n.lnglat,year:n.year,country:n.country,title:n.title,artist:n.artist,album:n.album,trackNumber:n.trackNum,loopend:1,trackVolume:n.audio.trackVolume||.7,duration:60*n.audio.beats/a,imageUrl:r,trackColor:n.display.color}}}var Le={geoMapUrl:"https://unpkg.com/world-atlas@1.1.4/world/110m.json",imprint:!1,focus:{lambda:-10,verticalShift:15,scaleFactor:1}},Pe=function(t,e){var n=e[t];n&&(n.remove(),e[t]=null)},De=function(){function t(e,n){Object(Kt.a)(this,t),this.config=Object.assign({},Le,e.visuals),this.set=e,this.display=n,this.circles={},this.albums={},this.refLines={},this.infos={},this.fixedAspectRatio=Ie.sixteenTenths,this.render=this.render.bind(this)}return Object(Xt.a)(t,[{key:"setGeodata",value:function(t){this.geodata=t,this.countries=be.a(t,t.objects.countries).features,this.render()}},{key:"show",value:function(t){var e=Ne(this.set,t);if(e){var n=this.display.dimensions,r=n.width,a=n.height,o=this.projection(e.lnglat),i=Object(me.a)(o,2),s=i[0],c=i[1],u=Te(this.circlesContainer,r,s,c,e);this.circles[t]=u;var l=function(t,e,n){var r=n.trackNumber,a=n.imageUrl,o=n.year,i=n.country,s=n.trackColor,c=t.append("g"),u=we(e),l=e/300,d=Oe(e),p=Ce(e,r),f=Ee(e);return c.append("svg:image").attr("width",u).attr("height",u).attr("x",r*u).attr("y",0).style("stroke","white").attr("xlink:href",a),c.append("rect").attr("width",u).attr("height",f).attr("x",r*u).attr("y",u+d).style("fill",s),function(t,e){for(var n=document.getElementById(e).getBBox().width,r=t.text();n>u-2*l&&r.length>0;)r=r.slice(0,-1),t.text(r+"..."),n=document.getElementById(e).getBBox().width}(c.append("text").attr("id","countryText"+r).attr("x",r*u+l).attr("y",u+d+f/2).attr("dy","0.35em").style("font-size","1.1vw").text(i),"countryText"+r),c.append("circle").attr("cx",p).attr("cy",u+d+2*f).attr("r",Se).style("fill",s),c.append("text").attr("x",r*u+l).attr("y",u+d+1.5*f).attr("dy","0.35em").style("font-size","1.1vw").style("fill",s).text(o),c}(this.albumsContainer,r,e);this.albums[t]=l;var d=function(t,e,n,r,a,o){var i=Ce(e,a),s=n,c=r,u=Math.sqrt(Math.pow(s-i,2)+Math.pow(c-0,2)),l=u/10,d=Math.acos((c-0)/u),p=[{x:i,y:0},{x:i+(s-i)/2+l*Math.cos(Math.PI-d),y:0+(c-0)/2+l*Math.sin(Math.PI-d)},{x:s,y:c}],f=ve.e().x(function(t){return t.x}).y(function(t){return t.y}).curve(ve.b);return t.append("path").datum(p).attr("d",f).style("stroke",o).style("stroke-dasharray","2, 3").style("fill","none").style("stroke-width",2)}(this.refLinesContainer,r,s,c,e.trackNumber,e.trackColor);this.refLines[t]=d,function(t,e,n,r,a,o){var i=Math.floor(e/30*o),s=ve.f(i,150),c=t.append("circle").attr("cx",n).attr("cy",r).attr("r",0).style("fill","none").style("stroke",a);s.forEach(function(t,e){var n=2-2*t/150;c.transition().duration(20).delay(20*e).attr("r",t).style("stroke-width",n).on("end",function(e,n,r){149===t&&r[n].remove()})})}(this.wavesContainer,r,s,c,e.trackColor,e.trackVolume);var p,f=function(t,e,n,r){var a=r.title,o=r.artist,i=r.album,s=r.trackColor;t.select("#lastSampleInfoGroup").remove();var c=t.append("g").attr("id","lastSampleInfoGroup"),u=e/20,l=e/190,d=u/3,p=e-u,f=n-xe(e)-u,h="-0.35em";return c.append("rect").attr("width",u).attr("height",u).attr("x",p).attr("y",f).style("fill",s),c.append("text").attr("x",p+l).attr("y",f+1*d).attr("dy",h).attr("font-size","1.1vw").text("title"),c.append("text").attr("x",p-l).attr("y",f+1*d).attr("dy",h).attr("font-size","1.1vw").style("text-anchor","end").style("fill","#e6e6e6").text(a),c.append("text").attr("x",p+l).attr("y",f+2*d).attr("dy",h).attr("font-size","1.1vw").text("artist"),c.append("text").attr("x",p-l).attr("y",f+2*d).attr("dy",h).attr("font-size","1.1vw").style("text-anchor","end").style("fill","#e6e6e6").text(o),c.append("text").attr("x",p+l).attr("y",f+3*d).attr("dy",h).attr("font-size","1.1vw").text("album"),c.append("text").attr("x",p-l).attr("y",f+3*d).attr("dy",h).attr("font-size","1.1vw").style("text-anchor","end").style("fill","#e6e6e6").text(i),c}(this.lastSampleInfoContainer,r,a,e);this.infos[t]=f,this.config.imprint&&(p=e.lnglat,e.trackColor,ve.i(".countries").each(function(t){if(ve.c(t,p)){var e=ve.h("#country".concat(t.id)).style("fill");ve.h("#country".concat(t.id)).style("fill",_e(e).brighten(.2))}}))}}},{key:"hide",value:function(t){Pe(t,this.circles),Pe(t,this.albums),Pe(t,this.refLines),Pe(t,this.infos)}},{key:"render",value:function(){this.display.clear();var t=this.display.dimensions,e=t.width,n=t.height,r=t.scale*this.config.focus.scaleFactor,a=this.config.focus.lambda,o=this.config.focus.verticalShift,i=xe(e),s=this.display.svg;if(this.mapContainer=s.append("g").attr("transform","translate(0, ".concat(i,")")).append("g").attr("id","map"),this.albumsContainer=s.append("g").attr("id","albums"),this.refLinesContainer=s.append("g").attr("id","refLines").attr("transform","translate(0, ".concat(i,")")),this.circlesContainer=s.append("g").attr("transform","translate(0, ".concat(i,")")).append("g").attr("id","circles"),this.wavesContainer=s.append("g").attr("id","waves").attr("transform","translate(0, ".concat(i,")")),this.lastSampleInfoContainer=s.append("g").attr("id","lastSampleInfo").attr("transform","translate(0, ".concat(i,")")),this.geodata){this.projection=function(t,e,n,r,a){return ge.a().scale(n).translate([t/2,e/2+e/r]).rotate([a,0,0])}(e,n-i,r,o,a);var c=ve.d().projection(this.projection);this.mapContainer.selectAll(".countries").data(this.countries).enter().append("path").attr("id",function(t){return"country".concat(t.id)}).attr("class","countries").attr("d",c).style("stroke","#2c2c2c").style("stroke-width",.5).style("fill",function(t){return"010"===t.id?"none":"#888888"})}}}]),t}(),Me={sixteenNinths:16/9,sixteenTenths:1.6},Ue=Me.sixteenTenths,ze=function(){function t(e){Object(Kt.a)(this,t),this.el=e,this.clear()}return Object(Xt.a)(t,[{key:"setVisible",value:function(t){this.el.style.display=t?"block":"none"}},{key:"clear",value:function(){var t=Object(ve.h)(this.el);return t.selectAll("*").remove(),this.dimensions=function(t){var e=t.offsetWidth,n=t.offsetHeight,r=e/n,a=r<Ue?e:n*Ue,o=r<Ue?e/Ue:n,i=Ue===Me.sixteenTenths?a/5.9:a/6.5;return{width:a,height:o,scale:i}}(this.el),this.svg=t.append("svg").attr("width",this.dimensions.width).attr("height",this.dimensions.height),this.svg}}]),t}();var Ge,He={init:function(t){t||(t=function(){var t=document.createElement("div");return t.setAttribute("class","visuals"),document.body.appendChild(t),t}());var e,n=new ze(t);return n.setVisible(!1),{setAudioset:function(t){e=t?function(t,e){te.loadResources(t,"covers");var n=new De(t,e);return n.render(),fetch(t.visuals.geoMapUrl).then(function(t){return t.json()}).then(function(t){return n.setGeodata(t)}),n}(t,n):function(t,e){return e.setVisible(!1),e.clear(),null}(0,n)},startClip:function(t){e.show(t)},stopClip:function(t){e.hide(t)},setVisible:function(t){n.setVisible(t),t&&e&&e.render()}}}};var Be=function(t){return"desktop"===t.display.type};var Ve=[function(t){var e,n=!1;return function(t,r){switch(n&&function(t,e,n){var r=!e.clientId,a=e.type.startsWith(c),o=t.readyState===WebSocket.OPEN;r&&a&&o&&ye(t,{action:"broadcastAction",payload:e})}(e,t),t.type){case H:e=function(t){var e=t.dispatch,n=t.getState,r=new WebSocket("ws://localhost:8080");return r.onopen=function(){var t=n().sync.user;ye(r,{action:"login",payload:t&&t.id})},r.onmessage=function(t){var a=JSON.parse(t.data);switch(console.log("RECEIVED",a),a.event){case"@sync/loggedIn":return e(et(a.payload));case"@sync/roomList":return e(rt(a.payload));case"@sync/requestJoin":ye(r,{action:"acceptJoin",payload:a.payload.id});var o=d(n().playback);return void ye(r,{action:"broadcastAction",payload:o});case"@sync/joined":return e(nt(a.payload));case"@sync/action":return e(Object.assign(a.payload,{clientId:a.from}));default:return}},r}(r);break;case Q:e.send(JSON.stringify({action:"createRoom"}));break;case tt:e.send(JSON.stringify({action:"requestJoin",payload:t.room.id}));break;case Z:n=!0}}},function(t,e){var n=e.getState,r=e.dispatch,a=n(),o=!a.session.isControl;switch(t.type){case H:de=new le(r,o),o&&de.restoreState(a.playback);break;case q:de.setEnabled(o);break;case l:o&&de.restoreState(t.playback);break;case f:return o&&de.playSample(t.clipId);case y:return o&&de.stopSample(t.clipId);case S:return o&&de.stopAll()}},function(t,e){var n=e.getState;switch(t.type){case H:Ge=He.init();break;case ft:Ge.setVisible(Be(n()));break;case l:Ge.setAudioset(t.playback.audioset),Ge.setVisible(Be(n()));break;case v:Ge.startClip(t.clipId);break;case b:Ge.stopClip(t.clipId)}},function(t,e){var n=e.dispatch;switch(t.type){case H:(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pe;return It("".concat(t,"/audioset.index.json"),fe)})().then(function(t){return n(J(t))});break;case F:(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pe;return It("".concat(e,"/").concat(t,".audioset.json"),fe)})(t.id).then(function(t){return n(p(t))})}},function(t,e){var n=e.dispatch;switch(t.type){case dt:he.enabled&&he.request();break;case H:!function(t){he.enabled&&he.on("change",function(){return t(yt(he.isFullscreen))});var e=Object(qt.throttle)(function(){return t(ht(window.innerWidth,window.innerHeight))},1e3);window.addEventListener("resize",e),e()}(n)}},function(t,e){var n=e.dispatch,r=e.getState;switch(t.type){case"INIT_SIDE_EFFECTS":!function(t,e){var n={};window.onkeydown=function(r){var a=r.key;if(!n[a]){n[a]=!0;var o=e().playback.audioset;if(o){var i=jt(o)[a];i&&t(h(i.clipId))}}},window.onkeyup=function(r){var a=r.key;n[a]=!1;var o=e().playback.audioset;if(o){var i=jt(o)[a];i&&t(m(i.clipId))}}}(n,r);break;default:return}}];var Fe=function(){var t=function(){try{var t=localStorage.getItem(Jt);if(null===t)return;return JSON.parse(t)}catch(e){return}}(),e=Ve.length,n=window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__():function(t){return t},r=Object(N.d)(Object(N.a)(function(t){return function(n){return function(r){n(r);for(var a=0;a<e;a++)Ve[a](r,t)}}}),n),a=Object(N.e)(mt,t,r);return a.dispatch({type:H}),a.subscribe(Object(qt.throttle)(function(){return Wt(function(t){var e=t.playback,n=t.sync;return{playback:e,sync:n}}(a.getState()))},1e3)),a}(),qe=Fe.getState(),Je=qe.playback.audioset;qe.playback.audioset&&Fe.dispatch(p(Je));var We=document.getElementById("app");T.a.setAppElement(We),i.a.render(a.a.createElement(s.a,{store:Fe},a.a.createElement(Ft,null)),We)}},[[43,2,1]]]);
//# sourceMappingURL=main.28f5e8b4.chunk.js.map
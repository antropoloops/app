{"version":3,"sources":["playback/actions.js","ui/shared/Panel.jsx","ui/Control/index.jsx","ui/Player/Modal.jsx","playback/index.js","store/model.js","ui/Player/Help.jsx","audioset/cache.js","audioset/inputs.js","ui/shared/Trigger.jsx","ui/Keyboard/Keyboard.jsx","ui/Keyboard/index.js","ui/shared/index.jsx","ui/Session/NoSession.jsx","ui/Session/HasSession.jsx","ui/Session/index.jsx","ui/Player/index.jsx","ui/App.jsx","browser/localStorage.js","audioset/resources.js","audio/context.js","audio/nextBeat.js","audio/Sampler.js","audio/index.js","store/effects/audio.effects.js","audioset/index.js","store/effects/fullscreen.effects.js","store/effects/room.effects.js","visuals/dimensions.js","visuals/drawCircle.js","visuals/getAlbumInfo.js","visuals/visuals.js","visuals/drawAlbum.js","visuals/drawRefLine.js","visuals/drawWave.js","visuals/imprint.js","visuals/lastSampleInfo.js","visuals/display.js","visuals/index.js","store/effects/visuals.effects.js","store/effects/index.js","store/effects/audioset.effects.js","store/effects/keyboard.effects.js","index.js","store/createStore.js"],"names":["PLAYBACK_PREFIX","name","SYNC_PLAYBACK","syncPlayback","playback","type","setAudioset","audioset","PRESS_PAD","pressPad","clipId","RELEASE_PAD","releasePad","START_AUDIO_CLIP","STOP_AUDIO_CLIP","SET_AUDIO_STARTED","SET_AUDIO_STOPPED","AUDIO_STOP_ALL","CHANGE_TRACK_VOLUME","Layout","cxs","display","flexDirection","Panel","backgroundColor","padding","Section","Header","Footer","Content","Main","flexGrow","Control","react_default","a","createElement","shared_Panel","className","ModalStyles","overlay","zIndex","content","position","maxHeight","top","left","transform","border","background","borderRadius","Modal","_ref","isOpen","onRequestClose","children","lib_default","shouldCloseOnOverlayClick","style","initialAudiosetState","initialAudioState","isPlaying","status","startedAt","valueByTrack","value","tracks","reduce","obj","track","id","initTracksState","playing","volumes","combineReducers","state","arguments","length","undefined","action","audio","Object","objectSpread","time","defineProperty","trackId","dir","changeTrackStatus","changeVolume","INIT_SIDE_EFFECTS","sa","SET_AUDIOSET_INDEX","LOAD_AUDIOSET","TOGGLE_IS_CONTROL","setAudiosetIndex","index","initialSessionState","audiosetIndex","isControl","initialRoomState","user","room","roomList","ra","SET_LOGGED_IN","CREATE_ROOM_REQUEST","SET_CURRENT_ROOM","SET_ROOM_LIST","REQUEST_ROOM","setLoggedIn","setRoom","setRoomList","initialDesktopState","session","pads","help","fullscreen","da","TOGGLE_SESSION","TOGGLE_TRACKS","TOGGLE_PADS","SHOW_HELP","HIDE_HELP","SHOW_FULLSCREEN","SET_FULLSCREEN","SET_WINDOW_SIZE","setSize","width","height","size","setFullscreen","isFullscreen","sync","roomId","steps","target","placement","disableBeacon","locale","back","close","last","next","skip","styles","options","arrowColor","beaconSize","overlayColor","primaryColor","spotlightShadow","textColor","tooltip","fontSize","fontFamily","buttonSkip","Help","run","onStop","react_joyride_es","callback","showProgress","showSkipButton","continuous","CACHE","save","key","startsWith","console","log","get","has","memo","create","ns","concat","cachedFetch","url","decode","Promise","resolve","fetch","then","data","getKeyboardMap","keyboard","defaults","keyMap","keys","map","toUpperCase","buildKeymap","Trigger","onPress","onRelease","onMouseDown","onMouseUp","props","color","pressed","marginRight","&:hover","propTypes","PropTypes","string","Key","clipIds","textAlign","connect","dispatch","pad","Keyboard","Button","font",":hover","textDecoration","Link","cursor","NoSession","rooms","onOpenAudioset","onJoinRoom","set","onClick","meta","title","description","HasSession","onCloseAudioset","onRequestRoom","openAudioset","audiosetId","closeAudioset","requestRoom","joinRoom","Session_NoSession","Session_HasSession","App","actions","toggleSession","hideHelp","bindActionCreators","notFull","Fragment","Player_App","ui_Keyboard","Player_Modal","ui_Session","isMobile","ui_Control","ui_Player","STORAGE_KEY","saveState","serializedState","JSON","stringify","localStorage","setItem","e","window","resetLocalStorage","ENV","process","resourceUrl","source","resources","assign","default","getSources","replace","getCachedResources","cached","clips","all","loadResources","promise","i","resource","getResourceUrls","names","toUrl","urls","identity","x","DECODERS","response","ctx","context","arrayBuffer","buffer","decodeAudioData","decoder","BEATS","nextBeat","now","bpm","beats","factor","absolute","nextBeatOffset","Sampler","events","classCallCheck","this","buffers","sources","output","gain","createGain","destination","createMasterOutput","currentTime","warn","stopTrack","createBufferSource","loop","start","started","stop","stopped","_this","clip","find","forEach","_this2","audioStarted","audioClipStarted","audioClipStopeed","audioStopped","mapDispatchToEvents","setAudioStarted","setAudioStopped","startAudioClip","stopAudioClip","AudioEngine","currentSampler","samplers","engine","sampler","getSampler","Resources","changeSampler","stopAll","play","BASE_URL","json","send","ws","msg","albumsCount","DOT_RADIUS","getVerticalPadding","screenWidth","getInfoHeight","getCoverSize","getAlbumHeight","verticalPadding","infoHeight","getDotOffsetX","trackNumber","RATIOS","sixteenNinths","sixteenTenths","circleNumSlices","degreesFromSlice","d3","range","domain","drawCircle","parent","cx","cy","params","duration","trackVolume","trackColor","circlesGroup","append","attr","circle","arc","outerArcs","d","startAngle","deg2rad","endAngle","innerRadius","outerRadius","createOuterArcs","selectAll","enter","innerArcs","createInnerArcs","turnTimer","elapsed","elapsedSeconds","turnScale","empty","degrees","Math","PI","getAlbumInfo","imageUrl","getClipCoverImageUrl","lnglat","year","country","artist","album","trackNum","loopend","CONFIG","geoMapUrl","imprint","focus","lambda","verticalShift","scaleFactor","remove","group","Display","config","visuals","circles","albums","refLines","infos","fixedAspectRatio","render","bind","geodata","countries","topojson","objects","features","info","_this$display$dimensi","dimensions","_this$projection","projection","_this$projection2","slicedToArray","circlesContainer","el","coverSize","horizontalPadding","dotOffsetX","textElement","textId","textLength","document","getElementById","getBBox","text","slice","wrap","drawAlbum","albumsContainer","refLine","windowWidth","x1","x2","y2","h","sqrt","pow","alfa","acos","curveCoords","y","cos","sin","line","curve","datum","drawRefLine","refLinesContainer","firstRadius","floor","radius","wave","r","strokeWidth","transition","delay","on","nodes","lastRadius","drawWave","wavesContainer","point","lastSampleInfo","screenHeight","select","rectSize","dy","createLastSampleInfo","lastSampleInfoContainer","each","polygon","base","chroma","brighten","clear","_this$display$dimensi2","focusedScale","scale","albumsHeight","svg","mapContainer","d3geo","translate","rotate","createProjection","path","RATIO","isVisible","w","offsetWidth","offsetHeight","realAspectRatio","calculateDimensions","src_visuals","init","setAttribute","body","appendChild","current","setVisible","Visuals","setGeodata","createVisuals","removeVisuals","startClip","show","stopClip","hide","store_effects","isRoom","store","isInternalAction","clientId","isPlayback","isWebSocketOpen","readyState","WebSocket","OPEN","payload","broadcastAction","getState","onopen","onmessage","event","parse","from","enabled","Audio","restoreState","setEnabled","playSample","stopSample","baseUrl","fetchIndex","fetchAudioset","screen","resize","throttle","innerWidth","innerHeight","addEventListener","onkeydown","onkeyup","initialState","getItem","loadState","fxLen","effects","devTools","__REDUX_DEVTOOLS_EXTENSION__","f","enhancer","compose","applyMiddleware","createStore","reducer","subscribe","getStateToSave","element","setAppElement","ReactDOM","es","ui_App"],"mappings":"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","file":"static/js/main.28f5e8b4.chunk.js","sourcesContent":["export const PLAYBACK_PREFIX = \"[playback] \";\nconst name = name => PLAYBACK_PREFIX + name;\n\n// Audioset\n\nexport const SYNC_PLAYBACK = name(\"SYNC_PLAYBACK\");\nexport const syncPlayback = playback => ({ type: SYNC_PLAYBACK, playback });\nexport const setAudioset = audioset => ({\n  type: SYNC_PLAYBACK,\n  playback: { audioset }\n});\n\n// Pads\nexport const PRESS_PAD = name(\"PRESS_PAD\");\nexport const pressPad = clipId => ({ type: PRESS_PAD, clipId });\nexport const RELEASE_PAD = name(\"RELEASE_PAD\");\nexport const releasePad = clipId => ({ type: RELEASE_PAD, clipId });\n\n// Audio\nexport const START_AUDIO_CLIP = name(\"START_AUDIO_CLIP\");\nexport const startAudioClip = (clipId, trackId, time) => ({\n  type: START_AUDIO_CLIP,\n  clipId,\n  trackId,\n  status: { isPlaying: true, time }\n});\nexport const STOP_AUDIO_CLIP = name(\"STOP_AUDIO_CLIP\");\nexport const stopAudioClip = (clipId, trackId, time) => ({\n  type: STOP_AUDIO_CLIP,\n  clipId,\n  trackId,\n  status: { isPlaying: false, time }\n});\n\nexport const SET_AUDIO_STARTED = name(\"SET_AUDIO_STARTED\");\nexport const setAudioStarted = time => ({\n  type: SET_AUDIO_STARTED,\n  time\n});\nexport const SET_AUDIO_STOPPED = name(\"SET_AUDIO_STOPPED\");\nexport const setAudioStopped = time => ({\n  type: SET_AUDIO_STOPPED,\n  time\n});\n\nexport const AUDIO_STOP_ALL = name(\"AUDIO_STOP_ALL\");\nexport const stopAudio = () => ({\n  type: AUDIO_STOP_ALL\n});\n\n// Tracks\nexport const CHANGE_TRACK_VOLUME = name(\"CHANGE_TRACK_VOLUME\");\nexport const changeTrackVolume = (trackId, volume) => ({\n  type: CHANGE_TRACK_VOLUME,\n  trackId,\n  volume\n});\n","import cxs from \"cxs/component\";\n\nconst Layout = cxs(\"div\")({\n  display: \"flex\",\n  flexDirection: \"column\"\n});\n\nconst Panel = cxs(Layout)({\n  backgroundColor: \"black\",\n  padding: \"1em\"\n});\n\nPanel.Layout = Layout;\n\nPanel.Section = Panel.Header = Panel.Footer = cxs(\"div\")({\n  backgroundColor: \"black\"\n});\n\nPanel.Content = Panel.Main = cxs(\"div\")({\n  flexGrow: 1\n});\n\nexport default Panel;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport Panel from \"../shared/Panel\";\n\nconst Control = () => (\n  <Panel className=\"Control\">\n    <Panel.Header>Top</Panel.Header>\n    <Panel.Content>Center</Panel.Content>\n    <Panel.Header>Connected</Panel.Header>\n  </Panel>\n);\nControl.propTypes = {\n  className: PropTypes.string\n};\nexport default Control;\n","import React from \"react\";\nimport ReactModal from \"react-modal\";\n\nconst Modal = ({ isOpen, onRequestClose, children }) => (\n  <ReactModal\n    isOpen={isOpen}\n    shouldCloseOnOverlayClick={true}\n    onRequestClose={onRequestClose}\n    style={ModalStyles}\n  >\n    {children}\n  </ReactModal>\n);\n\nconst ModalStyles = {\n  overlay: {\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    zIndex: 900\n  },\n  content: {\n    // http://lynn.io/2014/02/22/modalin/\n    position: \"fixed\",\n    maxHeight: \"calc(100% - 100px)\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n\n    // position: \"absolute\",\n    // top: \"40px\",\n    // left: \"0px\",\n    // right: \"auto\",\n    // bottom: \"40px\",\n    border: \"\",\n    background: \"black\",\n    borderRadius: 0,\n    zIndex: 1000\n  }\n};\n\nexport default Modal;\n","import { combineReducers } from \"redux\";\n\nimport {\n  SET_AUDIO_STARTED,\n  START_AUDIO_CLIP,\n  STOP_AUDIO_CLIP,\n  AUDIO_STOP_ALL,\n  SYNC_PLAYBACK,\n  CHANGE_TRACK_VOLUME,\n  SET_AUDIO_STOPPED\n} from \"./actions\";\n\n/**\n * Audioset session state\n */\nconst initialAudiosetState = null;\n\nexport function audioset(state = initialAudiosetState, action) {\n  switch (action.type) {\n    case SYNC_PLAYBACK:\n      return action.playback.audioset;\n    default:\n      return state;\n  }\n}\n\n/**\n * Audioset session state\n */\nconst initialAudioState = {\n  isPlaying: false,\n  status: \"STOP\",\n  startedAt: null\n};\n\nexport function audio(state = initialAudioState, action) {\n  switch (action.type) {\n    case SET_AUDIO_STARTED:\n      return { ...state, status: \"PLAYING\", startedAt: action.time };\n    case SET_AUDIO_STOPPED:\n      return { ...state, status: \"STOP\", startedAt: null };\n    case START_AUDIO_CLIP:\n    case STOP_AUDIO_CLIP:\n      return {\n        ...state,\n        status: { ...state.status, [action.clipId]: action.status }\n      };\n    case AUDIO_STOP_ALL:\n      return { ...state, status: {} };\n    default:\n      return state;\n  }\n}\n\nexport function tracks(state = initTracksState(), action) {\n  switch (action.type) {\n    case SYNC_PLAYBACK:\n      return initTracksState(action.playback.audioset);\n    case START_AUDIO_CLIP:\n    case STOP_AUDIO_CLIP:\n      return changeTrackStatus(state, action.trackId, action.status);\n    case CHANGE_TRACK_VOLUME:\n      return changeVolume(state, action.trackId, action.value);\n    default:\n      return state;\n  }\n}\n\nconst valueByTrack = (audioset, value) =>\n  audioset.tracks.reduce((obj, track) => {\n    obj[track.id] = value;\n    return obj;\n  }, {});\n\nfunction initTracksState(audioset) {\n  return audioset\n    ? {\n        playing: valueByTrack(audioset, 0),\n        volumes: valueByTrack(audioset, 75)\n      }\n    : { playing: {}, volumes: {} };\n}\n\nfunction changeTrackStatus(state, trackId, status) {\n  const dir = status.isPlaying ? 1 : -1;\n  return {\n    ...state,\n    playing: {\n      ...state.playing,\n      [trackId]: state.playing[trackId] + dir\n    }\n  };\n}\n\nfunction changeVolume(state, trackId, value) {\n  return {\n    ...state,\n    volumes: { ...state.volumes, [trackId]: value }\n  };\n}\n\nexport default combineReducers({\n  audioset,\n  audio,\n  tracks\n});\n","import { combineReducers } from \"redux\";\nimport playback from \"../playback\";\nimport { SYNC_PLAYBACK } from \"../playback/actions\";\n\nexport const INIT_SIDE_EFFECTS = \"INIT_SIDE_EFFECTS\";\n\nconst sa = name => \"/session/\" + name;\nexport const SET_AUDIOSET_INDEX = sa(\"SET_AUDIOSET_INDEX\");\nexport const LOAD_AUDIOSET = sa(\"LOAD_AUDIOSET\");\nexport const TOGGLE_IS_CONTROL = sa(\"TOGGLE_IS_CONTROL\");\n\nexport const setAudiosetIndex = index => ({ type: SET_AUDIOSET_INDEX, index });\nexport const toggleIsControl = () => ({ type: TOGGLE_IS_CONTROL });\n// side effects\nexport const loadAudioset = id => ({ type: LOAD_AUDIOSET, id });\n\nconst initialSessionState = {\n  audiosetIndex: null,\n  isControl: false\n};\n\nfunction session(state = initialSessionState, action) {\n  switch (action.type) {\n    case SET_AUDIOSET_INDEX:\n      return { ...state, audiosetIndex: action.index };\n    case TOGGLE_IS_CONTROL:\n      return { ...state, isControl: !state.isControl };\n    default:\n      return state;\n  }\n}\n\nconst initialRoomState = {\n  user: null,\n  room: null,\n  roomList: []\n};\n\nconst ra = name => \"/sync/\" + name;\nexport const SET_LOGGED_IN = ra(\"SET_LOGGED_IN\");\nexport const CREATE_ROOM_REQUEST = ra(\"CREATE_ROOM_REQUEST\");\nexport const SET_CURRENT_ROOM = ra(\"SET_CURRENT_ROOM\");\nexport const SET_ROOM_LIST = ra(\"SET_ROOM_LIST\");\nexport const REQUEST_ROOM = ra(\"REQUEST_ROOM\");\n\nexport const setLoggedIn = user => ({ type: SET_LOGGED_IN, user });\nexport const createRoom = () => ({ type: CREATE_ROOM_REQUEST });\nexport const setRoom = room => ({ type: SET_CURRENT_ROOM, room });\nexport const setRoomList = roomList => ({ type: SET_ROOM_LIST, roomList });\nexport const joinRoom = room => ({ type: REQUEST_ROOM, room });\n\nfunction sync(state = initialRoomState, action) {\n  switch (action.type) {\n    case SET_LOGGED_IN:\n      return {\n        ...state,\n        user: action.user,\n        room:\n          state.room && state.room.id === action.user.roomId ? state.room : null\n      };\n    case SET_CURRENT_ROOM:\n      return { ...state, room: action.room };\n    case SET_ROOM_LIST:\n      return {\n        ...state,\n        roomList: action.roomList\n      };\n    default:\n      return state;\n  }\n}\n\nconst initialDesktopState = {\n  session: true,\n  pads: false,\n  tracks: false,\n  help: false,\n  fullscreen: false\n};\nconst da = name => \"/display/\" + name;\nexport const TOGGLE_SESSION = da(\"SHOW_SESSION\");\nexport const TOGGLE_TRACKS = da(\"TOGGLE_TRACKS\");\nexport const TOGGLE_PADS = da(\"TOGGLE_PADS\");\nexport const SHOW_HELP = da(\"SHOW_HELP\");\nexport const HIDE_HELP = da(\"HIDE_HELP\");\nexport const SHOW_FULLSCREEN = da(\"SHOW_FULLSCREEN\");\nexport const SET_FULLSCREEN = da(\"SET_FULLSCREEN\");\nexport const SET_WINDOW_SIZE = da(\"SET_WINDOW_SIZE\");\n\nexport const setSize = (width, height) => ({\n  type: SET_WINDOW_SIZE,\n  size: { width, height }\n});\nexport const toggleSession = () => ({ type: TOGGLE_SESSION });\nexport const toggleTracks = () => ({ type: TOGGLE_TRACKS });\nexport const togglePads = () => ({ type: TOGGLE_PADS });\nexport const showHelp = () => ({ type: SHOW_HELP });\nexport const hideHelp = () => ({ type: HIDE_HELP });\nexport const showFullscreen = () => ({ type: SHOW_FULLSCREEN });\nexport const setFullscreen = isFullscreen => ({\n  type: SET_FULLSCREEN,\n  isFullscreen\n});\n\nfunction display(state = initialDesktopState, action) {\n  switch (action.type) {\n    case SET_WINDOW_SIZE:\n      return { ...state, type: action.size.width < 700 ? \"mobile\" : \"desktop\" };\n    case SYNC_PLAYBACK:\n    case TOGGLE_SESSION:\n      return { ...state, session: !state.session };\n    case SHOW_HELP:\n      return { ...state, help: true };\n    case HIDE_HELP:\n      return { ...state, help: false };\n    case TOGGLE_PADS:\n      return { ...state, pads: !state.pads };\n    case TOGGLE_TRACKS:\n      return { ...state, tracks: !state.tracks };\n    case SET_FULLSCREEN:\n      return { ...state, fullscreen: action.isFullscreen };\n    default:\n      return state;\n  }\n}\n\nexport default combineReducers({ playback, session, display, sync });\n","import React from \"react\";\nimport Joyride from \"react-joyride\";\n\nconst steps = [\n  {\n    target: \"#Connection\",\n    content:\n      \"Has creado una sesión. Puedes cambiarla o conectar con otros dispositivos aquí\",\n    placement: \"bottom\",\n    disableBeacon: true\n  },\n  {\n    target: \"#Keyboard\",\n    content:\n      \"Usa el teclado para lanzar los sonidos. También puedes usar MIDI o un MakeyMakey!\",\n    placement: \"top\",\n    disableBeacon: true\n  },\n  {\n    target: \"#Transport\",\n    content: \"Ponlo en pantalla completa o abre los controles\",\n    disableBeacon: true\n  }\n];\n\nconst locale = {\n  back: \"Anterior\",\n  close: \"Cerrar\",\n  last: \"Ok, lo he pillado\",\n  next: \"Siguiente\",\n  skip: \"Salir\"\n};\n\nconst options = {\n  arrowColor: \"#111\",\n  backgroundColor: \"#111\",\n  beaconSize: 70,\n  overlayColor: \"rgba(255, 255, 255, 0.5)\",\n  primaryColor: \"#000\",\n  spotlightShadow: \"0 0 15px rgba(0, 0, 0, 0.5)\",\n  textColor: \"white\",\n  width: undefined,\n  zIndex: 100\n};\n\nconst styles = {\n  options,\n  tooltip: { fontSize: 14, fontFamily: \"system\" },\n  buttonSkip: { fontSize: 12 }\n};\n\nexport default ({ run, onStop }) => (\n  <Joyride\n    callback={state => state.action === \"reset\" && onStop()}\n    run={run}\n    locale={locale}\n    styles={styles}\n    showProgress={false}\n    showSkipButton={true}\n    continuous={true}\n    steps={steps}\n  />\n);\n","const CACHE = [];\n\nfunction save(key, value) {\n  if (key.startsWith(\"audioset://\")) console.log(\"save\", key, value);\n  CACHE[key] = value;\n  return value;\n}\nfunction get(key) {\n  return CACHE[key];\n}\nfunction has(key) {\n  return CACHE[key] !== undefined;\n}\n\n/**\n * Memoize for audiosets\n * @param {*} key\n * @param {*} create\n */\nexport function memo(audioset, key, create) {\n  const ns = `audioset://${audioset.id}/${key}`;\n  return has(ns) ? get(ns) : save(ns, create());\n}\n\nexport function cachedFetch(url, decode) {\n  if (has(url)) return Promise.resolve(get(url));\n  // console.log(\"Fetch\", url);\n  return fetch(url)\n    .then(decode)\n    .then(data => save(url, data));\n}\n","import { memo } from \"./cache\";\nimport { pressPad, releasePad } from \"../playback/actions\";\n\nexport function init(dispatch, getState) {\n  const pressed = {};\n\n  window.onkeydown = function(e) {\n    const key = e.key;\n    if (pressed[key]) return;\n\n    pressed[key] = true;\n    const audioset = getState().playback.audioset;\n    if (!audioset) return;\n\n    const keyMap = getKeyboardMap(audioset);\n    const clip = keyMap[key];\n    if (clip) dispatch(pressPad(clip.clipId));\n  };\n\n  window.onkeyup = function(e) {\n    const key = e.key;\n    pressed[key] = false;\n\n    const audioset = getState().playback.audioset;\n    if (!audioset) return;\n\n    const keyMap = getKeyboardMap(audioset);\n    const clip = keyMap[key];\n    if (clip) dispatch(releasePad(clip.clipId));\n  };\n}\n\nexport function getKeyboardMap(audioset) {\n  return memo(audioset, \"keyboardMap\", () => buildKeymap(audioset.keyboard));\n}\n\nfunction buildKeymap(keyboard) {\n  if (!keyboard) return {};\n  const { defaults, keyMap } = keyboard;\n  return Object.keys(keyMap).reduce((map, key) => {\n    const value = { ...defaults, ...keyMap[key] };\n    value.key = key;\n    map[key] = value;\n    map[key.toUpperCase()] = value;\n    map[value.clipId] = value;\n    return map;\n  }, {});\n}\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\n\nconst Base = ({ onPress, onRelease, className, children }) => (\n  <button className={className} onMouseDown={onPress} onMouseUp={onRelease}>\n    {children}\n  </button>\n);\nBase.propTypes = {\n  pressed: PropTypes.bool,\n  onPress: PropTypes.func,\n  onRelease: PropTypes.func\n};\n\nconst Trigger = cxs(Base)(props => ({\n  border: `2px solid ${props.color}`,\n  color: props.color,\n  backgroundColor: props.pressed ? props.color : \"black\",\n  marginRight: \"0.5em\",\n  padding: \"1px 3px\",\n  \"&:hover\": {\n    backgroundColor: props.color,\n    color: \"black\"\n  }\n}));\n\nTrigger.propTypes = {\n  color: PropTypes.string\n};\n\nexport default Trigger;\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport { getKeyboardMap } from \"../../audioset/inputs\";\nimport Trigger from \"../shared/Trigger\";\n\nconst Key = cxs(Trigger)(props => ({\n  marginRight: \"0.5em\",\n  padding: \"1px 3px\"\n}));\n\nconst Keyboard = ({ audioset, status, className, onPress, onRelease }) => {\n  const keyMap = getKeyboardMap(audioset);\n  return (\n    <div className={className} id=\"Keyboard\">\n      {audioset.tracks.map(track =>\n        track.clipIds.map(name => (\n          <Key\n            key={name}\n            pressed={status[name] && status[name].isPlaying}\n            color={track.color}\n            onPress={() => onPress(name)}\n            onRelease={() => onRelease(name)}\n          >\n            {keyMap[name] ? keyMap[name].key.toUpperCase() : \"-\"}\n          </Key>\n        ))\n      )}\n    </div>\n  );\n};\nKeyboard.propTypes = {\n  onKeyPressed: PropTypes.func\n};\nexport default cxs(Keyboard)({\n  backgroundColor: \"black\",\n  textAlign: \"center\",\n  padding: \"2px 10px 4px 10px\"\n});\n","import { connect } from \"react-redux\";\nimport Keyboard from \"./Keyboard\";\nimport { pressPad, releasePad } from \"../../playback/actions\";\n\nconst mapStateToProps = state => ({\n  audioset: state.playback.audioset,\n  status: state.playback.audio.status\n});\n\nconst mapDispatchToProps = dispatch => ({\n  onPress: pad => dispatch(pressPad(pad)),\n  onRelease: pad => dispatch(releasePad(pad))\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Keyboard);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport cxs from \"cxs/component\";\nexport { default as Icon } from \"./Icon\";\n\nexport const Json = ({ obj }) => <pre>{JSON.stringify(obj)}</pre>;\nJson.propTypes = {\n  obj: PropTypes.object\n};\n\nexport const Button = cxs(\"button\")({\n  color: \"black\",\n  display: \"block\",\n  background: \"white\",\n  font: \"inherit\",\n  padding: \"0 1em\",\n  \":hover\": {\n    textDecoration: \"underline\"\n  }\n});\n\nexport const Link = cxs(\"button\")({\n  color: \"white\",\n  cursor: \"pointer\",\n  display: \"block\",\n  background: \"none\",\n  font: \"inherit\",\n  border: 0,\n  \":hover\": {\n    textDecoration: \"underline\"\n  }\n});\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Link } from \"../shared\";\n\nconst NoSession = ({ audiosetIndex, rooms, onOpenAudioset, onJoinRoom }) => (\n  <div>\n    <h2>Empieza una nueva remezcla</h2>\n    {audiosetIndex.map(set => (\n      <Link key={set.id} onClick={() => onOpenAudioset(set.id)}>\n        {set.meta.title}: {set.meta.description}\n      </Link>\n    ))}\n    <h2>Conéctate a una en marcha</h2>\n    {rooms.length\n      ? rooms.map(room => (\n          <Link key={room.id} onClick={() => onJoinRoom(room)}>\n            {room.name}\n          </Link>\n        ))\n      : \"No hay otras sesiones activas en este momento.\"}\n  </div>\n);\nNoSession.propTypes = {\n  audiosetIndex: PropTypes.array,\n  onOpenAudioset: PropTypes.func\n};\n\nexport default NoSession;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Button } from \"../shared\";\n\nconst HasSession = ({ audioset, onCloseAudioset, room, onRequestRoom }) => (\n  <div className=\"Session\">\n    <h1>{audioset.meta.title}</h1>\n    <p>{audioset.meta.description}</p>\n    {room ? (\n      <h2>Room: {room.name}</h2>\n    ) : (\n      <Button onClick={onRequestRoom}>Request room</Button>\n    )}\n    <Button onClick={onCloseAudioset}>Cerrar audioset</Button>\n  </div>\n);\nHasSession.propTypes = {\n  onCloseAudioset: PropTypes.func\n};\n\nexport default HasSession;\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { setAudioset } from \"../../playback/actions\";\nimport { loadAudioset, createRoom, joinRoom } from \"../../store/model\";\nimport NoSession from \"./NoSession\";\nimport HasSession from \"./HasSession\";\nimport Panel from \"../shared/Panel\";\n\nconst Session = ({\n  audioset,\n  audiosetIndex,\n  openAudioset,\n  closeAudioset,\n  room,\n  rooms,\n  requestRoom,\n  joinRoom\n}) => {\n  return (\n    <Panel id=\"Session\">\n      <Panel.Header>\n        <h1>Bienvenidx a Antropoloops</h1>\n      </Panel.Header>\n      <Panel.Content>\n        {audiosetIndex && !audioset && (\n          <NoSession\n            audiosetIndex={audiosetIndex}\n            onOpenAudioset={openAudioset}\n            rooms={rooms}\n            onJoinRoom={joinRoom}\n          />\n        )}\n\n        {audioset && (\n          <HasSession\n            audioset={audioset}\n            room={room}\n            onRequestRoom={requestRoom}\n            onCloseAudioset={closeAudioset}\n          />\n        )}\n      </Panel.Content>\n    </Panel>\n  );\n};\n\nconst mapStateToProps = state => ({\n  audioset: state.playback.audioset,\n  audiosetIndex: state.session.audiosetIndex,\n  room: state.sync.room,\n  rooms: state.sync.roomList\n});\nconst mapDispatchToProps = dispatch => ({\n  openAudioset: audiosetId => dispatch(loadAudioset(audiosetId)),\n  closeAudioset: () => dispatch(setAudioset(null)),\n  requestRoom: () => dispatch(createRoom()),\n  joinRoom: room => dispatch(joinRoom(room))\n});\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Session);\n","import React from \"react\";\nimport Modal from \"./Modal\";\nimport { bindActionCreators } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { toggleSession, hideHelp } from \"../../store/model\";\nimport Help from \"./Help\";\nimport Panel from \"../shared/Panel\";\nimport Keyboard from \"../Keyboard\";\nimport Session from \"../Session\";\nimport cxs from \"cxs/component\";\n\nconst App = cxs(Panel.Layout)({\n  height: \"100vh\"\n});\n\nconst Player = ({ audioset, display, toggleSession, hideHelp }) => {\n  const notFull = !display.fullscreen;\n\n  return (\n    <>\n      {audioset && (\n        <App className=\"App\">\n          {notFull && <Panel.Section>{audioset.id}</Panel.Section>}\n          <Panel.Content />\n          {notFull && <Keyboard />}\n        </App>\n      )}\n      <Help run={display.help} onStop={hideHelp} />\n      <Modal\n        isOpen={!audioset || display.session}\n        onRequestClose={toggleSession}\n      >\n        <Session />\n      </Modal>\n    </>\n  );\n};\n\nconst actions = {\n  toggleSession,\n  hideHelp\n};\n\nconst mapStateToProps = state => ({\n  audioset: state.playback.audioset,\n  display: state.display\n});\n\nconst mapDispatchToProps = dispatch => bindActionCreators(actions, dispatch);\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Player);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport Control from \"./Control\";\nimport Player from \"./Player\";\n\nconst App = ({ isMobile }) => (isMobile ? <Control /> : <Player />);\nApp.propTypes = {\n  className: PropTypes.string\n};\nexport default App;\n","const STORAGE_KEY = \"atpls/session\";\n\nexport function loadState() {\n  try {\n    const serializedState = localStorage.getItem(STORAGE_KEY);\n    if (serializedState === null) return undefined;\n    return JSON.parse(serializedState);\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport const saveState = state => {\n  try {\n    const serializedState = JSON.stringify(state);\n    localStorage.setItem(STORAGE_KEY, serializedState);\n  } catch (e) {\n    console.log(\"Error saving state\", e);\n  }\n};\n\nif (typeof window !== undefined) {\n  // to clear the storage manually\n  window.resetLocalStorage = () => saveState({});\n}\n","import { cachedFetch, memo } from \"./cache\";\nimport context from \"audio-context\";\n\nconst ENV = process.env.NODE_ENV;\n\nfunction getSources(audioset) {\n  const resources = audioset.resources || {};\n  return Object.assign({}, resources.default, resources[ENV]);\n}\nconst url = source => name => source && source.replace(\"{{filename}}\", name);\nconst resourceUrl = (audioset, type) => url(getSources(audioset)[type] || \"\");\n\nexport default { getCachedResources, loadResources, getResourceUrls };\n\nexport function getResourceUrls(audioset, type) {\n  const names = Object.keys(audioset.clips);\n  const toUrl = resourceUrl(audioset, type);\n  return names.reduce((urls, name) => {\n    urls[name] = toUrl(name);\n    return urls;\n  }, {});\n}\n\nconst identity = x => x;\nconst DECODERS = {\n  audio: decodeAudio\n};\n\nexport function loadResources(audioset, type, clipIds) {\n  clipIds = clipIds || Object.keys(audioset.clips);\n  const toUrl = resourceUrl(audioset, type);\n  const decoder = DECODERS[type] || identity;\n  return clipIds.map(clipId => cachedFetch(toUrl(clipId), decoder));\n}\n\nexport function getCachedResources(audioset, type) {\n  return memo(audioset, type, () => {\n    const cached = {};\n    const clipIds = Object.keys(audioset.clips);\n    Promise.all(\n      loadResources(audioset, type, clipIds).map((promise, i) =>\n        promise.then(resource => {\n          cached[clipIds[i]] = resource;\n          return resource;\n        })\n      )\n    );\n    return cached;\n  });\n}\n\nfunction decodeAudio(response) {\n  const ctx = context();\n  return response.arrayBuffer().then(buffer => ctx.decodeAudioData(buffer));\n}\n","import context from \"audio-context\";\n\nconst ctx = context();\n\nexport default ctx;\n","const BEATS = 1;\n\nexport default function nextBeat(now, startedAt, bpm) {\n  return now + nextBeatOffset(now, startedAt, bpm);\n}\n\n/**\n * Calculate the time remaining until the next beat\n *\n * @param {*} now\n * @param {*} startedAt\n * @param {*} bpm\n * @param {*} beats\n */\nexport function nextBeatOffset(now, startedAt, bpm, beats = BEATS) {\n  if (!startedAt) return 0;\n  const factor = bpm / (60 * beats);\n  const absolute = now - startedAt;\n  if (absolute === 0) return 0;\n  const inBeats = absolute * factor;\n  const mod = inBeats % 1;\n  const offsetTime = (1 - mod) / factor;\n  return offsetTime;\n}\n","import ctx from \"./context\";\nimport nextBeat from \"./nextBeat\";\n\nconst noop = () => undefined;\nexport const EVENTS = {\n  audioClipStarted: noop\n};\n\nexport default class Sampler {\n  constructor(audioset, events) {\n    this.bpm = audioset.audio.bpm || 120;\n    this.playing = 0;\n    this.startedAt = null;\n    this.audioset = audioset;\n    this.buffers = {};\n    this.sources = {};\n    this.events = events;\n    this.output = createMasterOutput(0.2);\n  }\n\n  play(clipId, time) {\n    time = time || nextBeat(ctx.currentTime, this.startedAt, this.bpm);\n    const buffer = this.buffers[clipId];\n    if (!buffer) console.warn(\"No buffer\", clipId);\n\n    this.stopTrack(clipId, time);\n    const source = (this.sources[clipId] = ctx.createBufferSource());\n    source.buffer = buffer;\n    source.loop = true;\n    source.connect(this.output);\n    source.start(time);\n    this.started(clipId, time);\n  }\n  stop(clipId, time) {\n    const source = this.sources[clipId];\n    if (!source) return;\n    time = time || ctx.currentTime;\n    source.stop(time);\n    this.sources[clipId] = null;\n    this.stopped(clipId, time);\n  }\n\n  // stops the clips in the same track\n  stopTrack(clipId, time) {\n    const clip = this.audioset.clips[clipId];\n    const track = this.audioset.tracks.find(track => track.id === clip.trackId);\n    track.clipIds.forEach(clipId => this.stop(clipId, time));\n  }\n\n  stopAll() {\n    const now = ctx.currentTime;\n    Object.keys(this.sources).forEach(clipId => this.stop(clipId, now));\n  }\n\n  started(clipId, time) {\n    if (this.playing === 0) {\n      this.startedAt = time;\n      this.events.audioStarted(time);\n    }\n    this.playing++;\n    const { trackId } = this.audioset.clips[clipId];\n    this.events.audioClipStarted(clipId, trackId, ctx.currentTime);\n  }\n\n  stopped(clipId, time) {\n    const { trackId } = this.audioset.clips[clipId];\n    this.events.audioClipStopeed(clipId, trackId, ctx.currentTime);\n    this.playing--;\n    if (this.playing === 0) {\n      this.startedAt = null;\n      this.events.audioStopped(false, time);\n    }\n  }\n}\n\nfunction createMasterOutput(gain) {\n  const output = ctx.createGain();\n  output.gain.value = gain;\n  output.connect(ctx.destination);\n  return output;\n}\n","import Resources from \"../audioset/resources\";\nimport Sampler from \"./Sampler\";\nimport {\n  startAudioClip,\n  setAudioStarted,\n  stopAudioClip,\n  setAudioStopped\n} from \"../playback/actions\";\n\nconst mapDispatchToEvents = dispatch => ({\n  audioStarted: time => dispatch(setAudioStarted(time)),\n  audioStopped: time => dispatch(setAudioStopped(false, time)),\n  audioClipStarted: (clipId, trackId, time) =>\n    dispatch(startAudioClip(clipId, trackId, time)),\n  audioClipStopeed: (clipId, trackId, time) =>\n    dispatch(stopAudioClip(clipId, trackId, time))\n});\n\nexport default class AudioEngine {\n  constructor(dispatch) {\n    this.events = mapDispatchToEvents(dispatch);\n    this.currentSampler = null;\n    this.samplers = {};\n  }\n\n  restoreState(playback) {\n    const { audioset } = playback;\n    if (audioset) {\n      changeSampler(this, audioset);\n      // Eventually, we have to do it better\n      this.currentSampler.stopAll();\n    }\n  }\n\n  playSample(clipId) {\n    if (!this.currentSampler) return console.warn(\"NO sampler!\");\n    this.currentSampler.play(clipId);\n  }\n\n  stopSample(id, events) {\n    if (!this.currentSampler) return console.warn(\"NO sampler!\");\n    this.currentSampler.stop(id);\n  }\n\n  stopAll() {\n    if (this.currentSampler) this.currentSampler.stopAll();\n  }\n}\n\n// PRIVATE //\n\nfunction getSampler(engine, audioset) {\n  const { id } = audioset;\n  if (engine.samplers[id]) return engine.samplers[id];\n  engine.samplers[id] = new Sampler(audioset, engine.events);\n  return engine.samplers[id];\n}\n\nfunction changeSampler(engine, audioset) {\n  if (audioset) {\n    const sampler = getSampler(engine, audioset);\n    sampler.buffers = Resources.getCachedResources(audioset, \"audio\");\n    engine.currentSampler = sampler;\n  } else {\n    engine.currentSampler = null;\n  }\n}\n","import {\n  SYNC_PLAYBACK,\n  PRESS_PAD,\n  RELEASE_PAD,\n  AUDIO_STOP_ALL\n} from \"../../playback/actions\";\nimport { INIT_SIDE_EFFECTS, TOGGLE_IS_CONTROL } from \"../model\";\n\n// it will change with code-split\nimport Audio from \"../../audio\";\nlet audio = null;\n\nexport default function effects(action, { getState, dispatch }) {\n  const state = getState();\n  const enabled = !state.session.isControl;\n\n  switch (action.type) {\n    case INIT_SIDE_EFFECTS:\n      audio = new Audio(dispatch, enabled);\n      enabled && audio.restoreState(state.playback);\n      break;\n\n    case TOGGLE_IS_CONTROL:\n      audio.setEnabled(enabled);\n      break;\n\n    case SYNC_PLAYBACK:\n      enabled && audio.restoreState(action.playback);\n      break;\n\n    case PRESS_PAD:\n      return enabled && audio.playSample(action.clipId);\n\n    case RELEASE_PAD:\n      return enabled && audio.stopSample(action.clipId);\n\n    case AUDIO_STOP_ALL:\n      return enabled && audio.stopAll();\n\n    default:\n  }\n}\n","import { memo, cachedFetch } from \"./cache\";\nimport { getResourceUrls } from \"./resources\";\n\nconst BASE_URL = (process.env.PUBLIC_URL || \"\") + \"/audiosets\";\nconst json = response => response.json();\n\nexport function getClipCoverImageUrl(audioset, clipId) {\n  const coverUrls = memo(audioset, \"coverUrls\", () =>\n    getResourceUrls(audioset, \"covers\")\n  );\n  return coverUrls[clipId];\n}\n\nexport function fetchIndex(baseUrl = BASE_URL) {\n  const url = `${baseUrl}/audioset.index.json`;\n  return cachedFetch(url, json);\n}\n\nexport function fetchAudioset(audiosetId, baseUrl = BASE_URL) {\n  const url = `${baseUrl}/${audiosetId}.audioset.json`;\n  return cachedFetch(url, json);\n}\n","import { throttle } from \"lodash\";\nimport * as screen from \"screenfull\";\nimport {\n  SHOW_FULLSCREEN,\n  INIT_SIDE_EFFECTS,\n  setFullscreen,\n  setSize\n} from \"../model\";\n\nfunction init(dispatch) {\n  if (screen.enabled) {\n    screen.on(\"change\", () => dispatch(setFullscreen(screen.isFullscreen)));\n  }\n\n  const resize = throttle(\n    () => dispatch(setSize(window.innerWidth, window.innerHeight)),\n    1000\n  );\n  window.addEventListener(\"resize\", resize);\n  resize();\n}\n\nexport default function(action, { dispatch }) {\n  switch (action.type) {\n    case SHOW_FULLSCREEN:\n      screen.enabled && screen.request();\n      break;\n\n    case INIT_SIDE_EFFECTS:\n      init(dispatch);\n      break;\n\n    default:\n      break;\n  }\n}\n","import {\n  CREATE_ROOM_REQUEST,\n  INIT_SIDE_EFFECTS,\n  setRoom,\n  setRoomList,\n  setLoggedIn,\n  REQUEST_ROOM,\n  SET_CURRENT_ROOM\n} from \"../model\";\nimport { syncPlayback, PLAYBACK_PREFIX } from \"../../playback/actions\";\n\nconst send = (ws, msg) => ws.send(JSON.stringify(msg));\n\nfunction init({ dispatch, getState }) {\n  const ws = new WebSocket(\"ws://localhost:8080\");\n\n  ws.onopen = () => {\n    const state = getState();\n    const { user } = state.sync;\n    send(ws, { action: \"login\", payload: user && user.id });\n  };\n\n  ws.onmessage = event => {\n    const data = JSON.parse(event.data);\n    console.log(\"RECEIVED\", data);\n    switch (data.event) {\n      case \"@sync/loggedIn\":\n        return dispatch(setLoggedIn(data.payload));\n      case \"@sync/roomList\":\n        return dispatch(setRoomList(data.payload));\n      case \"@sync/requestJoin\":\n        send(ws, { action: \"acceptJoin\", payload: data.payload.id });\n        const action = syncPlayback(getState().playback);\n        send(ws, { action: \"broadcastAction\", payload: action });\n        return;\n      case \"@sync/joined\":\n        return dispatch(setRoom(data.payload));\n      case \"@sync/action\":\n        // FIXME: filter actions!\n        return dispatch(Object.assign(data.payload, { clientId: data.from }));\n      default:\n        return;\n    }\n  };\n  return ws;\n}\n\nfunction broadcastAction(ws, action, store) {\n  const isInternalAction = !action.clientId;\n  const isPlayback = action.type.startsWith(PLAYBACK_PREFIX);\n  const isWebSocketOpen = ws.readyState === WebSocket.OPEN;\n\n  if (isInternalAction && isPlayback && isWebSocketOpen) {\n    send(ws, { action: \"broadcastAction\", payload: action });\n  }\n}\n\nexport default function(url) {\n  let ws;\n  let isRoom = false;\n  return function(action, store) {\n    isRoom && broadcastAction(ws, action, store);\n    switch (action.type) {\n      case INIT_SIDE_EFFECTS:\n        ws = init(store);\n        break;\n      case CREATE_ROOM_REQUEST:\n        ws.send(JSON.stringify({ action: \"createRoom\" }));\n        break;\n      case REQUEST_ROOM:\n        ws.send(\n          JSON.stringify({ action: \"requestJoin\", payload: action.room.id })\n        );\n        break;\n      case SET_CURRENT_ROOM:\n        isRoom = true;\n        break;\n\n      default:\n        break;\n    }\n  };\n}\n","import * as d3geo from \"d3-geo-projection\";\n\nconst albumsCount = 8;\nexport const DOT_RADIUS = 2;\n\nexport function getHorizontalPadding(screenWidth) {\n  return screenWidth / 300;\n}\n\nexport function getVerticalPadding(screenWidth) {\n  return screenWidth / 450;\n}\n\nexport function getInfoHeight(screenWidth) {\n  return screenWidth / 50;\n}\n\nexport function getCoverSize(screenWidth) {\n  return screenWidth / albumsCount;\n}\n\nexport function getAlbumHeight(screenWidth) {\n  const verticalPadding = getVerticalPadding(screenWidth);\n  const infoHeight = getInfoHeight(screenWidth);\n  return getCoverSize(screenWidth) + verticalPadding + infoHeight * 2;\n}\n\nexport function getDotOffsetX(screenWidth, trackNumber) {\n  return trackNumber * getCoverSize(screenWidth) + DOT_RADIUS;\n}\n\nexport const RATIOS = {\n  sixteenNinths: 16 / 9,\n  sixteenTenths: 16 / 10\n};\n\nexport function createProjection(width, height, scale, verticalShift, lambda) {\n  return d3geo\n    .geoRobinson()\n    .scale(scale)\n    .translate([width / 2, height / 2 + height / verticalShift])\n    .rotate([lambda, 0, 0]);\n}\n","import * as d3 from \"d3\";\n\n// Number of slices in a circle\nconst circleNumSlices = 36;\n\n// Scale. Get the degrees for a specific slice\nconst degreesFromSlice = d3\n  .scaleLinear()\n  .range([0, 360]) // working in degrees\n  .domain([0, circleNumSlices]);\n\nexport default function drawCircle(parent, screenWidth, cx, cy, params) {\n  const { duration, trackVolume, trackColor } = params;\n  const circlesGroup = parent\n    .append(\"g\")\n    .attr(\"class\", \"circleGroup\")\n    .attr(\"transform\", `translate(${cx}, ${cy})`);\n\n  // We need to group again, so that the circle turns in its location\n  const circle = circlesGroup.append(\"g\").attr(\"class\", \"circle\");\n\n  // Arc generator\n  const arc = d3.arc();\n\n  // Create outerArcs data\n  const outerArcs = createOuterArcs(circleNumSlices, screenWidth, trackVolume);\n\n  // Draw outerArcs\n  circle\n    .selectAll(\".outerArcs\")\n    .data(outerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"outerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return (0.3 / circleNumSlices) * i;\n    });\n\n  // Create innerArcs data\n  const innerArcs = createInnerArcs(circleNumSlices, screenWidth, trackVolume);\n\n  // Draw innerArcs\n  circle\n    .selectAll(\".innerArcs\")\n    .data(innerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"innerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return (1 / circleNumSlices) * i;\n    });\n\n  circle\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", 0)\n    .attr(\"x2\", 0)\n    .attr(\"y2\", -((screenWidth / 30) * trackVolume + screenWidth / 350))\n    .style(\"stroke\", trackColor)\n    .style(\"stroke-width\", 1.5);\n\n  // Add animation to make the circle turn\n  const turnTimer = d3.timer(turn);\n  function turn(elapsed) {\n    const elapsedSeconds = (elapsed / 1000) % duration;\n    const turnScale = d3\n      .scaleLinear()\n      .range([1, 0])\n      .domain([0, duration]);\n    circle.style(\"transform\", `rotate(${-turnScale(elapsedSeconds)}turn)`);\n    if (d3.select(\".circle\").empty()) {\n      turnTimer.stop();\n    }\n  }\n\n  return circlesGroup;\n}\n\nfunction createInnerArcs(circleNumSlices, screenWidth, trackVolume) {\n  return d3.range(circleNumSlices).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle:\n        i === circleNumSlices - 1\n          ? deg2rad(degreesFromSlice(d + 1))\n          : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: (screenWidth / 30) * trackVolume\n    };\n  });\n}\n\nfunction createOuterArcs(circleNumSlices, screenWidth, trackVolume) {\n  return d3.range(circleNumSlices).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle:\n        i === circleNumSlices - 1\n          ? deg2rad(degreesFromSlice(d + 1))\n          : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: (screenWidth / 30) * trackVolume * 2\n    };\n  });\n}\n\n// Transform degrees into radians\nfunction deg2rad(degrees) {\n  return degrees * (Math.PI / 180);\n}\n","import { getClipCoverImageUrl } from \"../audioset\";\n\n/**\n * Get URL of a resource, given it's name and source\n * @param {*} name\n * @param {*} source\n */\nexport function resourceUrl(name, source) {\n  if (!source || !source.length) return name;\n  const url = source[source.length - 1].replace(\"{{filename}}\", name);\n  return url;\n}\n\nexport default function getAlbumInfo(audioset, name) {\n  const clip = audioset.clips[name];\n  if (!clip) return;\n\n  const imageUrl = getClipCoverImageUrl(audioset, clip.name);\n  const bpm = audioset.meta.bpm || 120;\n\n  return {\n    lnglat: clip.lnglat,\n    year: clip.year,\n    country: clip.country,\n    title: clip.title,\n    artist: clip.artist,\n    album: clip.album,\n    trackNumber: clip.trackNum,\n    loopend: 1,\n    trackVolume: clip.audio.trackVolume || 0.7,\n    duration: (60 * clip.audio.beats) / bpm, // clip duration in seconds\n    imageUrl,\n    trackColor: clip.display.color\n  };\n}\n","import * as d3 from \"d3\";\nimport * as topojson from \"topojson\";\n\nimport { RATIOS, createProjection, getAlbumHeight } from \"./dimensions\";\n\nimport drawCircle from \"./drawCircle\";\nimport drawAlbum from \"./drawAlbum\";\nimport drawRefLine from \"./drawRefLine\";\nimport drawWave from \"./drawWave\";\nimport { createLastSampleInfo } from \"./lastSampleInfo\";\nimport { createImprint } from \"./imprint\";\nimport getAlbumInfo from \"./getAlbumInfo\";\n\nconst CONFIG = {\n  geoMapUrl: \"https://unpkg.com/world-atlas@1.1.4/world/110m.json\",\n  imprint: false,\n  focus: {\n    lambda: -10,\n    verticalShift: 15,\n    scaleFactor: 1\n  }\n};\n\nconst remove = (name, group) => {\n  const value = group[name];\n  if (value) {\n    value.remove();\n    group[name] = null;\n  }\n};\n\n/**\n * It stores the state required to render visualizations\n */\nexport default class Display {\n  constructor(set, display) {\n    this.config = Object.assign({}, CONFIG, set.visuals);\n    this.set = set;\n    this.display = display;\n    this.circles = {};\n    this.albums = {};\n    this.refLines = {};\n    this.infos = {};\n    this.fixedAspectRatio = RATIOS.sixteenTenths;\n    this.render = this.render.bind(this);\n  }\n\n  setGeodata(geodata) {\n    this.geodata = geodata;\n    this.countries = topojson.feature(\n      geodata,\n      geodata.objects.countries\n    ).features;\n    this.render();\n  }\n\n  show(name) {\n    const info = getAlbumInfo(this.set, name);\n    if (!info) return;\n\n    const { width, height } = this.display.dimensions;\n    let [cx, cy] = this.projection(info.lnglat);\n\n    const circle = drawCircle(this.circlesContainer, width, cx, cy, info);\n    this.circles[name] = circle;\n\n    const album = drawAlbum(this.albumsContainer, width, info);\n    this.albums[name] = album;\n\n    const refLine = drawRefLine(\n      this.refLinesContainer,\n      width,\n      cx,\n      cy,\n      info.trackNumber,\n      info.trackColor\n    );\n    this.refLines[name] = refLine;\n\n    drawWave(\n      this.wavesContainer,\n      width,\n      cx,\n      cy,\n      info.trackColor,\n      info.trackVolume\n    );\n\n    const lastSampleInfo = createLastSampleInfo(\n      this.lastSampleInfoContainer,\n      width,\n      height,\n      info\n    );\n    this.infos[name] = lastSampleInfo;\n\n    if (this.config.imprint) createImprint(info.lnglat, info.trackColor);\n  }\n\n  hide(name) {\n    remove(name, this.circles);\n    remove(name, this.albums);\n    remove(name, this.refLines);\n    remove(name, this.infos);\n  }\n\n  render() {\n    this.display.clear();\n    const { width, height, scale } = this.display.dimensions;\n    const focusedScale = scale * this.config.focus.scaleFactor;\n    const lambda = this.config.focus.lambda;\n    const verticalShift = this.config.focus.verticalShift;\n    const albumsHeight = getAlbumHeight(width);\n\n    const svg = this.display.svg;\n\n    this.mapContainer = svg\n      .append(\"g\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`)\n      .append(\"g\")\n      .attr(\"id\", \"map\");\n\n    this.albumsContainer = svg.append(\"g\").attr(\"id\", \"albums\");\n    this.refLinesContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"refLines\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n    this.circlesContainer = svg\n      .append(\"g\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`)\n      .append(\"g\")\n      .attr(\"id\", \"circles\");\n    this.wavesContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"waves\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n    this.lastSampleInfoContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"lastSampleInfo\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n\n    // Draw map\n    if (this.geodata) {\n      this.projection = createProjection(\n        width,\n        height - albumsHeight,\n        focusedScale,\n        verticalShift,\n        lambda\n      );\n      const path = d3.geoPath().projection(this.projection);\n      this.mapContainer\n        .selectAll(\".countries\")\n        .data(this.countries)\n        .enter()\n        .append(\"path\")\n        .attr(\"id\", d => `country${d.id}`)\n        .attr(\"class\", \"countries\")\n        .attr(\"d\", path)\n        .style(\"stroke\", \"#2c2c2c\")\n        .style(\"stroke-width\", 0.5)\n        .style(\"fill\", d => (d.id === \"010\" ? \"none\" : \"#888888\")); // 010 Antartica\n    }\n  }\n}\n","import {\n  getCoverSize,\n  getHorizontalPadding,\n  getVerticalPadding,\n  getInfoHeight,\n  getDotOffsetX,\n  DOT_RADIUS\n} from \"./dimensions\";\n\nexport default function drawAlbum(el, width, params) {\n  const { trackNumber, imageUrl, year, country, trackColor } = params;\n  const album = el.append(\"g\");\n  const coverSize = getCoverSize(width);\n  const horizontalPadding = getHorizontalPadding(width);\n  const verticalPadding = getVerticalPadding(width);\n  const dotOffsetX = getDotOffsetX(width, trackNumber);\n  const infoHeight = getInfoHeight(width);\n  const fontSize = \"1.1vw\";\n\n  album\n    .append(\"svg:image\")\n    .attr(\"width\", coverSize)\n    .attr(\"height\", coverSize)\n    .attr(\"x\", trackNumber * coverSize)\n    .attr(\"y\", 0)\n    .style(\"stroke\", \"white\")\n    .attr(\"xlink:href\", imageUrl);\n\n  // Draw country rectangle\n  album\n    .append(\"rect\")\n    .attr(\"width\", coverSize)\n    .attr(\"height\", infoHeight)\n    .attr(\"x\", trackNumber * coverSize)\n    .attr(\"y\", coverSize + verticalPadding)\n    .style(\"fill\", trackColor);\n\n  // Draw country text\n  const countryText = album\n    .append(\"text\")\n    .attr(\"id\", \"countryText\" + trackNumber)\n    .attr(\"x\", trackNumber * coverSize + horizontalPadding)\n    .attr(\"y\", coverSize + verticalPadding + infoHeight / 2)\n    .attr(\"dy\", \"0.35em\")\n    .style(\"font-size\", fontSize)\n    .text(country);\n\n  // Trucate text larger than coverSize\n  const countryTextId = \"countryText\" + trackNumber;\n  function wrap(textElement, textId) {\n    let textLength = document.getElementById(textId).getBBox().width;\n    let text = textElement.text();\n\n    while (textLength > coverSize - horizontalPadding * 2 && text.length > 0) {\n      text = text.slice(0, -1);\n      textElement.text(text + \"...\");\n      textLength = document.getElementById(textId).getBBox().width;\n    }\n  }\n  wrap(countryText, countryTextId);\n\n  // Draw date point\n  album\n    .append(\"circle\")\n    .attr(\"cx\", dotOffsetX)\n    .attr(\"cy\", coverSize + verticalPadding + infoHeight * 2)\n    .attr(\"r\", DOT_RADIUS)\n    .style(\"fill\", trackColor);\n\n  // Draw date text\n  album\n    .append(\"text\")\n    .attr(\"x\", trackNumber * coverSize + horizontalPadding)\n    .attr(\"y\", coverSize + verticalPadding + infoHeight * 1.5)\n    .attr(\"dy\", \"0.35em\")\n    .style(\"font-size\", fontSize)\n    .style(\"fill\", trackColor)\n    .text(year);\n\n  return album;\n}\n","import * as d3 from \"d3\";\nimport { getDotOffsetX } from \"./dimensions\";\n\nexport default function createRefLine(\n  parent,\n  windowWidth,\n  cx,\n  cy,\n  trackNumber,\n  trackColor\n) {\n  const x1 = getDotOffsetX(windowWidth, trackNumber);\n  const y1 = 0;\n  const x2 = cx;\n  const y2 = cy;\n  const h = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n  const a = h / 10;\n  const alfa = Math.acos((y2 - y1) / h);\n  const curveCoords = [\n    {\n      x: x1,\n      y: y1\n    },\n    {\n      x: x1 + (x2 - x1) / 2 + a * Math.cos(Math.PI - alfa),\n      y: y1 + (y2 - y1) / 2 + a * Math.sin(Math.PI - alfa)\n    },\n    { x: x2, y: y2 }\n  ];\n\n  const line = d3\n    .line()\n    .x(d => d.x)\n    .y(d => d.y)\n    .curve(d3.curveBasis);\n\n  const refLine = parent\n    .append(\"path\")\n    .datum(curveCoords)\n    .attr(\"d\", line)\n    .style(\"stroke\", trackColor)\n    .style(\"stroke-dasharray\", \"2, 3\")\n    .style(\"fill\", \"none\")\n    .style(\"stroke-width\", 2);\n\n  return refLine;\n}\n","import * as d3 from \"d3\";\n\nexport default function createWave(\n  parent,\n  screenWidth,\n  cx,\n  cy,\n  trackColor,\n  trackVolume\n) {\n  const firstRadius = Math.floor((screenWidth / 30) * trackVolume);\n  const lastRadius = 150;\n  const radius = d3.range(firstRadius, lastRadius);\n  const duration = 20;\n\n  const wave = parent\n    .append(\"circle\")\n    .attr(\"cx\", cx)\n    .attr(\"cy\", cy)\n    .attr(\"r\", 0)\n    .style(\"fill\", \"none\")\n    .style(\"stroke\", trackColor);\n\n  radius.forEach((r, i) => {\n    const initialWidth = 2;\n    const strokeWidth = initialWidth - (initialWidth * r) / lastRadius;\n    wave\n      .transition()\n      .duration(duration)\n      .delay(i * duration)\n      .attr(\"r\", r)\n      .style(\"stroke-width\", strokeWidth)\n      .on(\"end\", (d, i, nodes) => {\n        if (r === lastRadius - 1) nodes[i].remove();\n      });\n  });\n\n  return wave;\n}\n","import * as d3 from \"d3\";\nimport * as chroma from \"chroma-js\";\n\nexport function createImprint(point, color) {\n  d3.selectAll(\".countries\").each(polygon => {\n    const inside = d3.geoContains(polygon, point);\n    if (inside) {\n      const base = d3.select(`#country${polygon.id}`).style(\"fill\");\n      d3.select(`#country${polygon.id}`)\n        // .style(\"fill\", chroma.blend(base, color, \"lighten\").hex()); // applies trackColor\n        .style(\"fill\", chroma(base).brighten(0.2)); // gray to white. Step: 0.2\n    }\n  });\n}\n","import { getAlbumHeight } from \"./dimensions\";\n\nexport function createLastSampleInfo(\n  parent,\n  screenWidth,\n  screenHeight,\n  { title, artist, album, trackColor }\n) {\n  // Clear\n  parent.select(\"#lastSampleInfoGroup\").remove();\n  const lastSampleInfo = parent.append(\"g\").attr(\"id\", \"lastSampleInfoGroup\");\n  const rectSize = screenWidth / 20;\n  const albumsHeight = getAlbumHeight(screenWidth);\n  const horizontalPadding = screenWidth / 190;\n  const verticalPadding = rectSize / 3;\n  const x = screenWidth - rectSize;\n  const y = screenHeight - albumsHeight - rectSize;\n  const dy = \"-0.35em\";\n  const fontSize = \"1.1vw\";\n\n  lastSampleInfo\n    .append(\"rect\")\n    .attr(\"width\", rectSize)\n    .attr(\"height\", rectSize)\n    .attr(\"x\", x)\n    .attr(\"y\", y)\n    .style(\"fill\", trackColor);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 1)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"title\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 1)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(title);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 2)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"artist\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 2)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(artist);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 3)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"album\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 3)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(album);\n\n  return lastSampleInfo;\n}\n","import { select } from \"d3\";\n\nexport const RATIOS = {\n  sixteenNinths: 16 / 9,\n  sixteenTenths: 16 / 10\n};\nconst RATIO = RATIOS.sixteenTenths;\n\n/**\n * A display encapsulates drawing mechanics\n *\n * @param {*} el\n */\n\nexport default class Display {\n  constructor(el) {\n    this.el = el;\n    this.clear();\n  }\n\n  setVisible(isVisible) {\n    this.el.style.display = isVisible ? \"block\" : \"none\";\n  }\n\n  clear() {\n    const d3 = select(this.el);\n    d3.selectAll(\"*\").remove();\n\n    this.dimensions = calculateDimensions(this.el);\n    this.svg = d3\n      .append(\"svg\")\n      .attr(\"width\", this.dimensions.width)\n      .attr(\"height\", this.dimensions.height);\n    return this.svg;\n  }\n}\n\nfunction calculateDimensions(el) {\n  const w = el.offsetWidth;\n  const h = el.offsetHeight;\n  const realAspectRatio = w / h;\n\n  const width = realAspectRatio < RATIO ? w : h * RATIO;\n  const height = realAspectRatio < RATIO ? w / RATIO : h;\n  const scale = RATIO === RATIOS.sixteenTenths ? width / 5.9 : width / 6.5;\n  return { width, height, scale };\n}\n\nexport function getWindowSize(ratio) {\n  return getFixedSize(window.innerWidth, window.innerHeight, ratio);\n}\n\nfunction getFixedSize(width, height, ratio) {\n  const realAspectRatio = width / height;\n\n  const screenWidth = realAspectRatio < ratio ? width : height * ratio;\n  const screenHeight = realAspectRatio < ratio ? width / ratio : height;\n\n  return { screenWidth, screenHeight };\n}\n","import Visuals from \"./visuals\";\nimport Display from \"./display\";\nimport Resources from \"../audioset/resources\";\n\nexport default { init };\n\n// TODO: move all this into effects\nexport function init(el) {\n  if (!el) el = createElement();\n  const display = new Display(el);\n  display.setVisible(false);\n  let current;\n\n  return {\n    setAudioset(audioset) {\n      if (audioset) current = createVisuals(audioset, display);\n      else current = removeVisuals(current, display);\n    },\n    startClip(clipId) {\n      current.show(clipId);\n    },\n    stopClip(clipId) {\n      current.hide(clipId);\n    },\n    setVisible(isVisible) {\n      display.setVisible(isVisible);\n      if (isVisible && current) current.render();\n    }\n  };\n}\n\nfunction createElement() {\n  const el = document.createElement(\"div\");\n  el.setAttribute(\"class\", \"visuals\");\n  document.body.appendChild(el);\n  return el;\n}\n\nfunction removeVisuals(visuals, display) {\n  display.setVisible(false);\n  display.clear();\n  return null;\n}\n\nfunction createVisuals(audioset, display) {\n  Resources.loadResources(audioset, \"covers\");\n  const visuals = new Visuals(audioset, display);\n  visuals.render();\n  fetch(audioset.visuals.geoMapUrl)\n    .then(response => response.json())\n    .then(data => visuals.setGeodata(data));\n\n  return visuals;\n}\n","import {\n  SYNC_PLAYBACK,\n  START_AUDIO_CLIP,\n  STOP_AUDIO_CLIP\n} from \"../../playback/actions\";\nimport { INIT_SIDE_EFFECTS, SET_WINDOW_SIZE } from \"../model\";\n\nimport Visuals from \"../../visuals\";\n\nlet visuals;\n\nconst isVisible = state => state.display.type === \"desktop\";\n\nexport default function effects(action, { getState }) {\n  switch (action.type) {\n    case INIT_SIDE_EFFECTS:\n      visuals = Visuals.init();\n      break;\n\n    case SET_WINDOW_SIZE:\n      visuals.setVisible(isVisible(getState()));\n      break;\n\n    case SYNC_PLAYBACK:\n      visuals.setAudioset(action.playback.audioset);\n      visuals.setVisible(isVisible(getState()));\n      break;\n\n    case START_AUDIO_CLIP:\n      visuals.startClip(action.clipId);\n      break;\n\n    case STOP_AUDIO_CLIP:\n      visuals.stopClip(action.clipId);\n      break;\n\n    default:\n      break;\n  }\n}\n","import audio from \"./audio.effects\";\nimport audioset from \"./audioset.effects\";\nimport fullscreen from \"./fullscreen.effects\";\nimport keyboard from \"./keyboard.effects\";\nimport room from \"./room.effects\";\nimport visuals from \"./visuals.effects\";\n\nexport default [room, audio, visuals, audioset, fullscreen, keyboard];\n","import { setAudioset } from \"../../playback/actions\";\nimport { LOAD_AUDIOSET, setAudiosetIndex, INIT_SIDE_EFFECTS } from \"../model\";\nimport { fetchAudioset, fetchIndex } from \"../../audioset\";\n\nexport default function effects(action, { dispatch }) {\n  switch (action.type) {\n    case INIT_SIDE_EFFECTS:\n      fetchIndex().then(index => dispatch(setAudiosetIndex(index)));\n      break;\n    case LOAD_AUDIOSET:\n      fetchAudioset(action.id).then(audioset =>\n        dispatch(setAudioset(audioset))\n      );\n      break;\n    default:\n      break;\n  }\n}\n","import { init } from \"../../audioset/inputs\";\n\nexport default function(action, { dispatch, getState }) {\n  switch (action.type) {\n    case \"INIT_SIDE_EFFECTS\":\n      init(dispatch, getState);\n      break;\n    default:\n      return;\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { setAudioset } from \"./playback/actions\";\nimport App from \"./ui/App\";\nimport Modal from \"react-modal\";\nimport createStore from \"./store/createStore\";\n\n// const ENV = process.env.NODE_ENV;\n// const WEBSOCKETS_URL = \"http://localhost:4000\";\nconst store = createStore();\n\n// trigger the current audioset action\nconst state = store.getState();\nconst { audioset } = state.playback;\nif (state.playback.audioset) {\n  store.dispatch(setAudioset(audioset));\n}\n\nconst element = document.getElementById(\"app\");\nModal.setAppElement(element);\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  element\n);\n","import { createStore, compose, applyMiddleware } from \"redux\";\n// import thunk from \"redux-thunk\";\nimport { throttle } from \"lodash\";\nimport { loadState, saveState } from \"../browser/localStorage\";\n\nimport reducer, { INIT_SIDE_EFFECTS } from \"./model\";\nimport effects from \"./effects\";\n\n/**\n * Create an store\n */\nexport default function() {\n  const initialState = loadState();\n\n  const fxLen = effects.length;\n  const effectsMiddleware = store => next => action => {\n    // state is updated first!\n    next(action);\n    for (let i = 0; i < fxLen; i++) effects[i](action, store);\n  };\n\n  const devTools = window.__REDUX_DEVTOOLS_EXTENSION__\n    ? window.__REDUX_DEVTOOLS_EXTENSION__()\n    : f => f;\n  const enhancer = compose(\n    applyMiddleware(effectsMiddleware),\n    devTools\n  );\n\n  const store = createStore(reducer, initialState, enhancer);\n  store.dispatch({ type: INIT_SIDE_EFFECTS });\n\n  store.subscribe(\n    throttle(() => saveState(getStateToSave(store.getState())), 1000)\n  );\n  return store;\n}\n\nfunction getStateToSave({ playback, sync }) {\n  return { playback, sync };\n}\n"],"sourceRoot":""}
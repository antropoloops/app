{"version":3,"sources":["session/actions.js","session/effects.js","rooms/index.js","audioset/cache.js","audioset/resources.js","audioset/index.js","audio/context.js","audio/nextBeat.js","audio/Sampler.js","audio/index.js","visuals/dimensions.js","visuals/drawCircle.js","visuals/getAlbumInfo.js","visuals/visuals.js","visuals/drawAlbum.js","visuals/drawRefLine.js","visuals/drawWave.js","visuals/imprint.js","visuals/lastSampleInfo.js","visuals/display.js","visuals/index.js","ui/shared/Icon.jsx","ui/shared/index.jsx","ui/Desktop/Toolbar.jsx","ui/Welcome/Welcome.jsx","ui/Welcome/index.jsx","ui/Desktop/Visuals.jsx","ui/Pads/Pad.jsx","ui/Pads/Pads.jsx","ui/Pads/index.js","ui/shared/Trigger.jsx","ui/Tracks/Tracks.jsx","ui/Tracks/index.js","audioset/inputs.js","ui/Keyboard/Keyboard.jsx","ui/Keyboard/index.js","browser/fullscreen.js","ui/Desktop/Help.jsx","ui/Desktop/Desktop.jsx","ui/Desktop/index.js","ui/App.jsx","browser/localStorage.js","session/reducers/audioset.js","session/reducers/audio.js","session/reducers/tracks.js","session/index.js","index.js","createStore.js"],"names":["SET_AUDIOSET","setAudioset","audioset","type","PRESS_PAD","pressPad","clipId","RELEASE_PAD","releasePad","SET_AUDIO_CLIP_STATUS","SET_AUDIO_STATUS","setAudioStatus","isPlaying","time","status","AUDIO_STOP_ALL","stopAudio","CHANGE_TRACK_VOLUME","attachVisuals","el","detachVisuals","all","addEffects","effects","push","_ref","dispatch","getState","next","action","i","length","NO_SOCKET","on","console","warn","emit","event","Client","url","Object","classCallCheck","this","handleAction","log","socket","connected","audiosets","rooms","events","Nanobus","connect","_this","io","data","audiosetId","roomId","cb","CACHE","save","key","value","startsWith","get","has","undefined","memo","create","ns","concat","id","cachedFetch","decode","Promise","resolve","fetch","then","ENV","process","resourceUrl","source","resources","assign","default","getSources","name","replace","getCachedResources","cached","clipIds","keys","clips","loadResources","map","promise","resource","getResourceUrls","names","toUrl","reduce","urls","identity","x","DECODERS","audio","response","ctx","context","arrayBuffer","buffer","decodeAudioData","decoder","BASE_URL","json","fetchAudioset","baseUrl","arguments","BEATS","nextBeat","now","startedAt","bpm","beats","factor","absolute","nextBeatOffset","Sampler","playing","buffers","sources","output","gain","createGain","destination","createMasterOutput","currentTime","stopTrack","createBufferSource","loop","start","started","stop","stopped","clip","tracks","find","track","trackId","forEach","_this2","startAudioClip","stopAudioClip","src_audio","getSession","addEffect","session","changeSampler","restoreState","currentSampler","play","playSample","stopSample","stopAll","samplers","getSampler","Resources","albumsCount","DOT_RADIUS","getVerticalPadding","screenWidth","getInfoHeight","getCoverSize","getAlbumHeight","verticalPadding","infoHeight","getDotOffsetX","trackNumber","RATIOS","sixteenNinths","sixteenTenths","circleNumSlices","degreesFromSlice","d3","range","domain","drawCircle","parent","cx","cy","params","duration","trackVolume","trackColor","circlesGroup","append","attr","circle","arc","outerArcs","d","startAngle","deg2rad","endAngle","innerRadius","outerRadius","createOuterArcs","selectAll","enter","style","innerArcs","createInnerArcs","turnTimer","elapsed","elapsedSeconds","turnScale","empty","degrees","Math","PI","getAlbumInfo","imageUrl","getClipCoverImageUrl","meta","lnglat","year","country","title","artist","album","trackNum","loopend","display","color","CONFIG","geoMapUrl","imprint","focus","lambda","verticalShift","scaleFactor","remove","group","Display","set","config","visuals","circles","albums","refLines","infos","fixedAspectRatio","render","bind","geodata","countries","topojson","objects","features","info","_this$display$dimensi","dimensions","width","height","_this$projection","projection","_this$projection2","slicedToArray","circlesContainer","coverSize","horizontalPadding","dotOffsetX","textElement","textId","textLength","document","getElementById","getBBox","text","slice","wrap","drawAlbum","albumsContainer","refLine","windowWidth","x1","x2","y2","h","sqrt","pow","a","alfa","acos","curveCoords","y","cos","sin","line","curve","datum","drawRefLine","refLinesContainer","firstRadius","floor","radius","wave","r","strokeWidth","transition","delay","nodes","lastRadius","drawWave","wavesContainer","point","lastSampleInfo","screenHeight","select","rectSize","dy","createLastSampleInfo","lastSampleInfoContainer","each","polygon","base","chroma","brighten","clear","_this$display$dimensi2","focusedScale","scale","albumsHeight","svg","mapContainer","d3geo","translate","rotate","createProjection","path","RATIO","isVisible","w","offsetWidth","offsetHeight","realAspectRatio","calculateDimensions","src_visuals","init","createElement","setAttribute","body","appendChild","current","setVisible","resize","throttle","window","addEventListener","Visuals","setGeodata","createVisuals","removeVisuals","show","hide","ICONS","fly","mute","cinema","controls","stop2","fullscreen","keyboard","volumeUp","volumeDown","volumeOff","Icon","icon","onClick","react_default","fill","viewBox","xmlns","Button","cxs","background","font","padding",":hover","textDecoration","Link","border","Transport","Connection","marginTop","flexGrow","textAlign","className","onCloseAudioset","onStopAll","onHelp","onToggleTracks","onTogglePads","onFullscreen","shared_Icon","description","flexDirection","backgroundColor","margin","lineHeight","fontSize","& h1, & h2","fontWeight","Welcome","audiosetIndex","onChangeAudioset","Fragment","state","onClose","_useState","useState","_useState2","setIsLoading","_useState3","_useState4","index","setIndex","useEffect","mounted","fetchIndex","ui_Welcome_Welcome","Pad","props","possibleConstructorReturn","getPrototypeOf","call","touched","isTouch","pressed","_this$props","touch","image","borderColor","onTouchStart","handlePress","onMouseDown","src","alt","React","Component","TrackPads","onPadPressed","onPadReleased","ui_Pads_Pad","onPress","onRelease","_ref2","Pads_TrackPads","minHeight","pad","Pads","Trigger","children","onMouseUp","marginRight","&:hover","propTypes","PropTypes","string","Track","component","borderTop","active","> h2","marginBottom","Tracks","volumes","onVolumeChanged","shared_Trigger","min","max","onChange","e","target","volume","getKeyboardMap","defaults","keyMap","objectSpread","toUpperCase","buildKeymap","inputs","onkeydown","onkeyup","Key","Keyboard","changeFullscreen","isFullscreen","screen","callback","steps","content","placement","disableBeacon","locale","back","close","last","skip","styles","options","arrowColor","beaconSize","overlayColor","primaryColor","spotlightShadow","textColor","zIndex","tooltip","fontFamily","buttonSkip","Help","run","onStop","react_joyride_es","showProgress","showSkipButton","continuous","setHelpVisible","setWelcomeVisible","reducer","welcomeVisible","help","padsVisible","tracksVisible","ModalStyles","overlay","position","maxHeight","top","left","transform","borderRadius","Main","Content","overflow","Center","App","_useReducer","useReducer","initialState","_useReducer2","disp","hideWelcome","Fullscreen","setFullscreen","notFull","Desktop_Toolbar","ui_Pads","ui_Tracks","ui_Keyboard","react_modal_lib_default","isOpen","shouldCloseOnOverlayClick","onRequestClose","ui_Welcome","bindActionCreators","Desktop","ui_Desktop","STORAGE_KEY","saveState","serializedState","JSON","stringify","localStorage","setItem","resetLocalStorage","valueByTrack","obj","t","combineReducers","defineProperty","dir","store","getItem","parse","loadState","enhancer","compose","applyMiddleware","__REDUX_DEVTOOLS_EXTENSION__","f","createStore","subscribe","getAudioset","loadCurrentAudioset","Rooms","onStatus","createRoom","Inputs","Audio","element","Modal","setAppElement","ReactDOM","es","ui_App"],"mappings":"uLACaA,EAAe,yBACfC,EAAc,SAAAC,GAAQ,MAAK,CACtCC,KAAMH,EACNE,aAIWE,EAAY,sBACZC,EAAW,SAAAC,GAAM,MAAK,CAAEH,KAAMC,EAAWE,WACzCC,EAAc,wBACdC,EAAa,SAAAF,GAAM,MAAK,CAAEH,KAAMI,EAAaD,WAG7CG,EAAwB,kCAcxBC,EAAmB,6BACnBC,EAAiB,SAACC,EAAWC,GAAZ,MAAsB,CAClDV,KAAMO,EACNI,OAAQ,CAAEF,YAAWC,UAGVE,EAAiB,2BACjBC,EAAY,iBAAO,CAC9Bb,KAAMY,IAIKE,EAAsB,gCAYtBC,EAAgB,SAAChB,EAAUiB,GAAX,MAAmB,CAC9ChB,KAF4B,iBAG5BD,WACAiB,OAGWC,EAAgB,iBAAO,CAAEjB,KADR,mBChDxBkB,EAAM,GAECC,EAAa,SAAAC,GACpBA,GAASF,EAAIG,KAAKD,IAcTA,EARC,SAAAE,GAAA,IAAGC,EAAHD,EAAGC,SAAUC,EAAbF,EAAaE,SAAb,OAA4B,SAAAC,GAAI,OAAI,SAAAC,GAElDD,EAAKC,GACL,IAAK,IAAIC,EAAI,EAAGA,EAAIT,EAAIU,OAAQD,IAC9BT,EAAIS,GAAGD,EAAQH,EAAUC,wDCnBvBK,EAAY,CAChBC,GADgB,SACb9B,GACD+B,QAAQC,KAAK,4BAA6BhC,IAE5CiC,KAJgB,SAIXjC,EAAMkC,GACTH,QAAQC,KAAK,0BAA2BhC,EAAMkC,KAoDnCC,aA/Cb,SAAAA,EAAYC,GAAMC,OAAAC,EAAA,EAAAD,CAAAE,KAAAJ,GAChBI,KAAKC,aAAe,SAAAd,GAAM,OAAIK,QAAQU,IAAI,mBAAoBf,IAC9Da,KAAKG,OAASb,EACdU,KAAKI,WAAY,EACjBJ,KAAK5B,OAAS,CAAEiC,UAAW,GAAIC,MAAO,IACtCN,KAAKO,OAASC,MACVX,GAAKG,KAAKS,QAAQZ,uDAGhBA,GAAK,IAAAa,EAAAV,KACXA,KAAKG,OAASQ,IAAGF,QAAQZ,GACzBG,KAAKG,OAAOZ,GAAG,UAAW,WACxBmB,EAAKN,WAAY,IAEnBJ,KAAKG,OAAOZ,GAAG,cAAe,SAAAqB,GAC5BF,EAAKH,OAAOb,KAAK,OAAQkB,KAE3BZ,KAAKG,OAAOZ,GAAG,gBAAiB,SAAAqB,GAC9BF,EAAKH,OAAOb,KAAK,SAAUkB,KAE7BZ,KAAKG,OAAOZ,GAAG,gBAAiB,SAAAJ,GAC9BuB,EAAKT,aAAad,sCAIbA,GACPa,KAAKC,aAAad,GAClBa,KAAKG,OAAOT,KAAK,gBAAiBP,oCAG3Bc,GACPD,KAAKC,aAAeA,qCAGXY,GACTb,KAAKG,OAAOT,KAAK,gBAAiBmB,oCAG3BC,GACPd,KAAKG,OAAOT,KAAK,cAAeoB,8BAG/BnB,EAAOoB,GACRf,KAAKO,OAAOhB,GAAGI,EAAOoB,YCxDpBC,EAAQ,GAEd,SAASC,EAAKC,EAAKC,GAGjB,OAFID,EAAIE,WAAW,gBAAgB5B,QAAQU,IAAI,OAAQgB,EAAKC,GAC5DH,EAAME,GAAOC,EACNA,EAET,SAASE,EAAIH,GACX,OAAOF,EAAME,GAEf,SAASI,EAAIJ,GACX,YAAsBK,IAAfP,EAAME,GAQR,SAASM,EAAKhE,EAAU0D,EAAKO,GAClC,IAAMC,EAAE,cAAAC,OAAiBnE,EAASoE,GAA1B,KAAAD,OAAgCT,GACxC,OAAOI,EAAII,GAAML,EAAIK,GAAMT,EAAKS,EAAID,KAG/B,SAASI,EAAYhC,EAAKiC,GAC/B,OAAIR,EAAIzB,GAAakC,QAAQC,QAAQX,EAAIxB,KACzCL,QAAQU,IAAI,QAASL,GACdoC,MAAMpC,GACVqC,KAAKJ,GACLI,KAAK,SAAAtB,GAAI,OAAIK,EAAKpB,EAAKe,2BC1BtBuB,EAAMC,aAMZ,IACMC,EAAc,SAAC7E,EAAUC,GAAX,OADR6E,EAJZ,SAAoB9E,GAClB,IAAM+E,EAAY/E,EAAS+E,WAAa,GACxC,OAAOzC,OAAO0C,OAAO,GAAID,EAAUE,QAASF,EAAUJ,IAGZO,CAAWlF,GAAUC,IAAS,GADpD,SAAAkF,GAAI,OAAIL,GAAUA,EAAOM,QAAQ,eAAgBD,IAA3D,IAAAL,GAGZC,EAAA,CAAiBM,mBAuBV,SAA4BrF,EAAUC,GAC3C,OAAO+D,EAAKhE,EAAUC,EAAM,WAC1B,IAAMqF,EAAS,GACTC,EAAUjD,OAAOkD,KAAKxF,EAASyF,OASrC,OARAlB,QAAQpD,IACNuE,EAAc1F,EAAUC,EAAMsF,GAASI,IAAI,SAACC,EAAShE,GAAV,OACzCgE,EAAQlB,KAAK,SAAAmB,GAEX,OADAP,EAAOC,EAAQ3D,IAAMiE,EACdA,OAINP,KAnC0BI,gBAAeI,mBAE7C,SAASA,EAAgB9F,EAAUC,GACxC,IAAM8F,EAAQzD,OAAOkD,KAAKxF,EAASyF,OAC7BO,EAAQnB,EAAY7E,EAAUC,GACpC,OAAO8F,EAAME,OAAO,SAACC,EAAMf,GAEzB,OADAe,EAAKf,GAAQa,EAAMb,GACZe,GACN,IAGL,IAAMC,EAAW,SAAAC,GAAC,OAAIA,GAChBC,EAAW,CACfC,MA0BF,SAAqBC,GACnB,IAAMC,EAAMC,MACZ,OAAOF,EAASG,cAAchC,KAAK,SAAAiC,GAAM,OAAIH,EAAII,gBAAgBD,OAzB5D,SAASjB,EAAc1F,EAAUC,EAAMsF,GAC5CA,EAAUA,GAAWjD,OAAOkD,KAAKxF,EAASyF,OAC1C,IAAMO,EAAQnB,EAAY7E,EAAUC,GAC9B4G,EAAUR,EAASpG,IAASkG,EAClC,OAAOZ,EAAQI,IAAI,SAAAvF,GAAM,OAAIiE,EAAY2B,EAAM5F,GAASyG,KC7B1D,IAAMC,EAAW,iBACXC,EAAO,SAAAR,GAAQ,OAAIA,EAASQ,QAc3B,SAASC,EAAc3D,GAAgC,IAApB4D,EAAoBC,UAAArF,OAAA,QAAAkC,IAAAmD,UAAA,GAAAA,UAAA,GAAVJ,EAElD,OAAOzC,EADE,GAAAF,OAAM8C,EAAN,KAAA9C,OAAiBd,EAAjB,kBACe0D,GClB1B,IAEeP,EAFHC,MCFNU,EAAQ,EAEC,SAASC,EAASC,EAAKC,EAAWC,GAC/C,OAAOF,EAWF,SAAwBA,EAAKC,EAAWC,GAAoB,IAAfC,EAAeN,UAAArF,OAAA,QAAAkC,IAAAmD,UAAA,GAAAA,UAAA,GAAPC,EAC1D,IAAKG,EAAW,OAAO,EACvB,IAAMG,EAASF,GAAO,GAAKC,GACrBE,EAAWL,EAAMC,EACvB,OAAiB,IAAbI,EAAuB,GAGP,EAFJA,EAAWD,EACL,GACSA,EAlBlBE,CAAeN,EAAKC,EAAWC,OCKzBK,cACnB,SAAAA,EAAY5H,EAAUwB,GAAWc,OAAAC,EAAA,EAAAD,CAAAE,KAAAoF,GAC/BpF,KAAK+E,IAAMvH,EAASsG,MAAMiB,KAAO,IACjC/E,KAAKqF,QAAU,EACfrF,KAAK8E,UAAY,KACjB9E,KAAKxC,SAAWA,EAChBwC,KAAKsF,QAAU,GACftF,KAAKuF,QAAU,GACfvF,KAAKhB,SAAWA,EAChBgB,KAAKwF,OA0DT,SAA4BC,GAC1B,IAAMD,EAASxB,EAAI0B,aAGnB,OAFAF,EAAOC,KAAKtE,MAAQsE,EACpBD,EAAO/E,QAAQuD,EAAI2B,aACZH,EA9DSI,CAAmB,qDAG9BhI,EAAQO,GACXA,EAAOA,GAAQyG,EAASZ,EAAI6B,YAAa7F,KAAK8E,UAAW9E,KAAK+E,KAC9D,IAAMZ,EAASnE,KAAKsF,QAAQ1H,GACvBuG,GAAQ3E,QAAQC,KAAK,YAAa7B,GAEvCoC,KAAK8F,UAAUlI,EAAQO,GACvB,IAAMmE,EAAUtC,KAAKuF,QAAQ3H,GAAUoG,EAAI+B,qBAC3CzD,EAAO6B,OAASA,EAChB7B,EAAO0D,MAAO,EACd1D,EAAO7B,QAAQT,KAAKwF,QACpBlD,EAAO2D,MAAM9H,GACb6B,KAAKkG,QAAQtI,EAAQO,gCAElBP,EAAQO,GACX,IAAMmE,EAAStC,KAAKuF,QAAQ3H,GACvB0E,IACLnE,EAAOA,GAAQ6F,EAAI6B,YACnBvD,EAAO6D,KAAKhI,GACZ6B,KAAKuF,QAAQ3H,GAAU,KACvBoC,KAAKoG,QAAQxI,EAAQO,sCAIbP,EAAQO,GAAM,IAAAuC,EAAAV,KAChBqG,EAAOrG,KAAKxC,SAASyF,MAAMrF,GACnBoC,KAAKxC,SAAS8I,OAAOC,KAAK,SAAAC,GAAK,OAAIA,EAAM5E,KAAOyE,EAAKI,UAC7D1D,QAAQ2D,QAAQ,SAAA9I,GAAM,OAAI8C,EAAKyF,KAAKvI,EAAQO,uCAG1C,IAAAwI,EAAA3G,KACF6E,EAAMb,EAAI6B,YAChB/F,OAAOkD,KAAKhD,KAAKuF,SAASmB,QAAQ,SAAA9I,GAAM,OAAI+I,EAAKR,KAAKvI,EAAQiH,qCAGxDjH,EAAQO,GACO,IAAjB6B,KAAKqF,UACPrF,KAAK8E,UAAY3G,EACjB6B,KAAKhB,SAASf,GAAe,EAAME,KAErC6B,KAAKqF,UALe,IAMZoB,EAAYzG,KAAKxC,SAASyF,MAAMrF,GAAhC6I,QACRzG,KAAKhB,SR9CqB,SAACpB,EAAQ6I,EAAStI,GAAlB,MAA4B,CACxDV,KAAMM,EACNH,SACA6I,UACArI,OAAQ,CAAEF,WAAW,EAAMC,SQ0CXyI,CAAehJ,EAAQ6I,EAASzC,EAAI6B,8CAG5CjI,EAAQO,GAAM,IACZsI,EAAYzG,KAAKxC,SAASyF,MAAMrF,GAAhC6I,QACRzG,KAAKhB,SR7CoB,SAACpB,EAAQ6I,EAAStI,GAAlB,MAA4B,CACvDV,KAAMM,EACNH,SACA6I,UACArI,OAAQ,CAAEF,WAAW,EAAOC,SQyCZ0I,CAAcjJ,EAAQ6I,EAASzC,EAAI6B,cACjD7F,KAAKqF,UACgB,IAAjBrF,KAAKqF,UACPrF,KAAK8E,UAAY,KACjB9E,KAAKhB,SAASf,GAAe,EAAOE,cC3D3B,IAAA2I,GAAA,CAAEjI,QAiBV,SAAAE,GAAsD,IAAnCgI,EAAmChI,EAAnCgI,WAAY/H,EAAuBD,EAAvBC,SAAuBD,EAAbiI,UAG9C,OATF,SAAsBC,EAASjI,GACzBiI,EAAQzJ,UAAU0J,GAAcD,EAAQzJ,SAAUwB,GAEtDA,EAASV,KAKT6I,CADgBJ,IACM/H,GACf,SAAAG,GACL,OAAQA,EAAO1B,MACb,KAAKH,EACH,OAAO4J,GAAc/H,EAAO3B,SAAUwB,GACxC,KAAKtB,EACH,OAmBR,SAAoBkE,EAAIrB,GACtB,IAAK6G,GAAgB,OAAO5H,QAAQC,KAAK,eACzC2H,GAAeC,KAAKzF,GArBP0F,CAAWnI,EAAOvB,QAC3B,KAAKC,EACH,OAqBR,SAAoB+D,EAAIrB,GACtB,IAAK6G,GAAgB,OAAO5H,QAAQC,KAAK,eACzC2H,GAAejB,KAAKvE,GAvBP2F,CAAWpI,EAAOvB,QAC3B,KAAKS,EACH,OAAO+I,GAAeI,cA3BxBC,GAAW,GACXC,GAAa,SAAClK,EAAUwB,GAAa,IACjC4C,EAAOpE,EAAPoE,GACR,OAAI6F,GAAS7F,GAAY6F,GAAS7F,IAClC6F,GAAS7F,GAAM,IAAIwD,GAAQ5H,EAAUwB,GAC9ByI,GAAS7F,KAEdwF,GAAiB,KA0BrB,SAASF,GAAc1J,EAAUwB,GAC3BxB,GACF4J,GAAiBM,GAAWlK,EAAUwB,IACvBsG,QAAUqC,EAAU9E,mBAAmBrF,EAAU,SAEhE4J,GAAiB,qDCjDfQ,GAAc,EACPC,GAAa,EAMnB,SAASC,GAAmBC,GACjC,OAAOA,EAAc,IAGhB,SAASC,GAAcD,GAC5B,OAAOA,EAAc,GAGhB,SAASE,GAAaF,GAC3B,OAAOA,EAAcH,GAGhB,SAASM,GAAeH,GAC7B,IAAMI,EAAkBL,GAAmBC,GACrCK,EAAaJ,GAAcD,GACjC,OAAOE,GAAaF,GAAeI,EAA+B,EAAbC,EAGhD,SAASC,GAAcN,EAAaO,GACzC,OAAOA,EAAcL,GAAaF,GAAeF,GAG5C,IAAMU,GAAS,CACpBC,cAAe,GAAK,EACpBC,cAAe,KC9BjB,IAAMC,GAAkB,GAGlBC,GAAmBC,OAEtBC,MAAM,CAAC,EAAG,MACVC,OAAO,CAAC,EAAGJ,KAEC,SAASK,GAAWC,EAAQjB,EAAakB,EAAIC,EAAIC,GAAQ,IAC9DC,EAAsCD,EAAtCC,SAAUC,EAA4BF,EAA5BE,YAAaC,EAAeH,EAAfG,WACzBC,EAAeP,EAClBQ,OAAO,KACPC,KAAK,QAAS,eACdA,KAAK,YAHa,aAAA9H,OAGasH,EAHb,MAAAtH,OAGoBuH,EAHpB,MAMfQ,EAASH,EAAaC,OAAO,KAAKC,KAAK,QAAS,UAGhDE,EAAMf,OAGNgB,EAuER,SAAyBlB,EAAiBX,EAAasB,GACrD,OAAOT,KAASF,GAAiBvF,IAAI,SAAC0G,EAAGzK,GACvC,MAAO,CACL0K,WAAYC,GAAQpB,GAAiBkB,IACrCG,SAEMD,GAAQpB,GADZvJ,IAAMsJ,EAAkB,EACKmB,EAAI,EACJA,EAAI,IACnCI,YAAa,EACbC,YAAcnC,EAAc,GAAMsB,EAAc,KAhFlCc,CAAgBzB,GAAiBX,EAAasB,GAGhEK,EACGU,UAAU,cACVxJ,KAAKgJ,GACLS,QACAb,OAAO,QACPC,KAAK,QAAS,aACdA,KAAK,IAAKE,GACVW,MAAM,OAAQhB,GACdgB,MAAM,UAAW,SAACT,EAAGzK,GACpB,MAAQ,GAAMsJ,GAAmBtJ,IAIrC,IAAMmL,EAyCR,SAAyB7B,EAAiBX,EAAasB,GACrD,OAAOT,KAASF,GAAiBvF,IAAI,SAAC0G,EAAGzK,GACvC,MAAO,CACL0K,WAAYC,GAAQpB,GAAiBkB,IACrCG,SAEMD,GAAQpB,GADZvJ,IAAMsJ,EAAkB,EACKmB,EAAI,EACJA,EAAI,IACnCI,YAAa,EACbC,YAAcnC,EAAc,GAAMsB,KAlDpBmB,CAAgB9B,GAAiBX,EAAasB,GAGhEK,EACGU,UAAU,cACVxJ,KAAK2J,GACLF,QACAb,OAAO,QACPC,KAAK,QAAS,aACdA,KAAK,IAAKE,GACVW,MAAM,OAAQhB,GACdgB,MAAM,UAAW,SAACT,EAAGzK,GACpB,OAAQ,EAAIsJ,GAAmBtJ,IAGnCsK,EACGF,OAAO,QACPC,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,KAAM,GACXA,KAAK,OAAS1B,EAAc,GAAMsB,EAActB,EAAc,MAC9DuC,MAAM,SAAUhB,GAChBgB,MAAM,eAAgB,KAGzB,IAAMG,EAAY7B,KAClB,SAAc8B,GACZ,IAAMC,EAAkBD,EAAU,IAAQtB,EACpCwB,EAAYhC,OAEfC,MAAM,CAAC,EAAG,IACVC,OAAO,CAAC,EAAGM,IACdM,EAAOY,MAAM,YAAb,UAAA3I,QAAqCiJ,EAAUD,GAA/C,UACI/B,KAAU,WAAWiC,SACvBJ,EAAUtE,SAId,OAAOoD,EAgCT,SAASQ,GAAQe,GACf,OAAOA,GAAWC,KAAKC,GAAK,kBCnGf,SAASC,GAAazN,EAAUmF,GAC7C,IAAM0D,EAAO7I,EAASyF,MAAMN,GAC5B,GAAK0D,EAAL,CAEA,IAAM6E,EPXD,SAA8B1N,EAAUI,GAI7C,OAHkB4D,EAAKhE,EAAU,YAAa,kBAC5C8F,EAAgB9F,EAAU,YAEXI,GOOAuN,CAAqB3N,EAAU6I,EAAK1D,MAC/CoC,EAAMvH,EAAS4N,KAAKrG,KAAO,IAEjC,MAAO,CACLsG,OAAQhF,EAAKgF,OACbC,KAAMjF,EAAKiF,KACXC,QAASlF,EAAKkF,QACdC,MAAOnF,EAAKmF,MACZC,OAAQpF,EAAKoF,OACbC,MAAOrF,EAAKqF,MACZpD,YAAajC,EAAKsF,SAClBC,QAAS,EACTvC,YAAahD,EAAKvC,MAAMuF,aAAe,GACvCD,SAAW,GAAK/C,EAAKvC,MAAMkB,MAASD,EACpCmG,WACA5B,WAAYjD,EAAKwF,QAAQC,QCnB7B,IAAMC,GAAS,CACbC,UAAW,sDACXC,SAAS,EACTC,MAAO,CACLC,QAAS,GACTC,cAAe,GACfC,YAAa,IAIXC,GAAS,SAAC3J,EAAM4J,GACpB,IAAMpL,EAAQoL,EAAM5J,GAChBxB,IACFA,EAAMmL,SACNC,EAAM5J,GAAQ,OAOG6J,cACnB,SAAAA,EAAYC,EAAKZ,GAAU/L,OAAAC,EAAA,EAAAD,CAAAE,KAAAwM,GACzBxM,KAAK0M,OAAS5M,OAAO0C,OAAO,GAAIuJ,GAAQU,EAAIE,SAC5C3M,KAAKyM,IAAMA,EACXzM,KAAK6L,QAAUA,EACf7L,KAAK4M,QAAU,GACf5M,KAAK6M,OAAS,GACd7M,KAAK8M,SAAW,GAChB9M,KAAK+M,MAAQ,GACb/M,KAAKgN,iBAAmBzE,GAAOE,cAC/BzI,KAAKiN,OAASjN,KAAKiN,OAAOC,KAAKlN,6DAGtBmN,GACTnN,KAAKmN,QAAUA,EACfnN,KAAKoN,UAAYC,KACfF,EACAA,EAAQG,QAAQF,WAChBG,SACFvN,KAAKiN,sCAGFtK,GACH,IAAM6K,EAAOvC,GAAajL,KAAKyM,IAAK9J,GACpC,GAAK6K,EAAL,CAFS,IAAAC,EAIiBzN,KAAK6L,QAAQ6B,WAA/BC,EAJCF,EAIDE,MAAOC,EAJNH,EAIMG,OAJNC,EAKM7N,KAAK8N,WAAWN,EAAKnC,QAL3B0C,EAAAjO,OAAAkO,GAAA,EAAAlO,CAAA+N,EAAA,GAKJ5E,EALI8E,EAAA,GAKA7E,EALA6E,EAAA,GAOHrE,EAASX,GAAW/I,KAAKiO,iBAAkBN,EAAO1E,EAAIC,EAAIsE,GAChExN,KAAK4M,QAAQjK,GAAQ+G,EAErB,IAAMgC,ECzDK,SAAmBjN,EAAIkP,EAAOxE,GAAQ,IAC3Cb,EAAqDa,EAArDb,YAAa4C,EAAwC/B,EAAxC+B,SAAUI,EAA8BnC,EAA9BmC,KAAMC,EAAwBpC,EAAxBoC,QAASjC,EAAeH,EAAfG,WACxCoC,EAAQjN,EAAG+K,OAAO,KAClB0E,EAAYjG,GAAa0F,GACzBQ,EAAyCR,EJP1B,IIQfxF,EAAkBL,GAAmB6F,GACrCS,EAAa/F,GAAcsF,EAAOrF,GAClCF,EAAaJ,GAAc2F,GA+DjC,OA5DAjC,EACGlC,OAAO,aACPC,KAAK,QAASyE,GACdzE,KAAK,SAAUyE,GACfzE,KAAK,IAAKnB,EAAc4F,GACxBzE,KAAK,IAAK,GACVa,MAAM,SAAU,SAChBb,KAAK,aAAcyB,GAGtBQ,EACGlC,OAAO,QACPC,KAAK,QAASyE,GACdzE,KAAK,SAAUrB,GACfqB,KAAK,IAAKnB,EAAc4F,GACxBzE,KAAK,IAAKyE,EAAY/F,GACtBmC,MAAM,OAAQhB,GAcjB,SAAc+E,EAAaC,GAIzB,IAHA,IAAIC,EAAaC,SAASC,eAAeH,GAAQI,UAAUf,MACvDgB,EAAON,EAAYM,OAEhBJ,EAAaL,EAAgC,EAApBC,GAAyBQ,EAAKtP,OAAS,GACrEsP,EAAOA,EAAKC,MAAM,GAAI,GACtBP,EAAYM,KAAKA,EAAO,OACxBJ,EAAaC,SAASC,eAAeH,GAAQI,UAAUf,MAG3DkB,CArBoBnD,EACjBlC,OAAO,QACPC,KAAK,KAAM,cAAgBnB,GAC3BmB,KAAK,IAAKnB,EAAc4F,EAAYC,GACpC1E,KAAK,IAAKyE,EAAY/F,EAAkBC,EAAa,GACrDqB,KAAK,KAAM,UACXa,MAAM,YA3BQ,SA4BdqE,KAAKpD,GAGc,cAAgBjD,GActCoD,EACGlC,OAAO,UACPC,KAAK,KAAM2E,GACX3E,KAAK,KAAMyE,EAAY/F,EAA+B,EAAbC,GACzCqB,KAAK,IAAK5B,IACVyC,MAAM,OAAQhB,GAGjBoC,EACGlC,OAAO,QACPC,KAAK,IAAKnB,EAAc4F,EAAYC,GACpC1E,KAAK,IAAKyE,EAAY/F,EAA+B,IAAbC,GACxCqB,KAAK,KAAM,UACXa,MAAM,YA1DQ,SA2DdA,MAAM,OAAQhB,GACdqF,KAAKrD,GAEDI,EDbSoD,CAAU9O,KAAK+O,gBAAiBpB,EAAOH,GACrDxN,KAAK6M,OAAOlK,GAAQ+I,EAEpB,IAAMsD,EElEK,SACbhG,EACAiG,EACAhG,EACAC,EACAZ,EACAgB,GAEA,IAAM4F,EAAK7G,GAAc4G,EAAa3G,GAEhC6G,EAAKlG,EACLmG,EAAKlG,EACLmG,EAAItE,KAAKuE,KAAKvE,KAAKwE,IAAIJ,EAAKD,EAAI,GAAKnE,KAAKwE,IAAIH,EAHzC,EAGkD,IACvDI,EAAIH,EAAI,GACRI,EAAO1E,KAAK2E,MAAMN,EALb,GAKwBC,GAC7BM,EAAc,CAClB,CACE/L,EAAGsL,EACHU,EATO,GAWT,CACEhM,EAAGsL,GAAMC,EAAKD,GAAM,EAAIM,EAAIzE,KAAK8E,IAAI9E,KAAKC,GAAKyE,GAC/CG,EAbO,GAaER,EAbF,GAaa,EAAII,EAAIzE,KAAK+E,IAAI/E,KAAKC,GAAKyE,IAEjD,CAAE7L,EAAGuL,EAAIS,EAAGR,IAGRW,EAAOnH,OAEVhF,EAAE,SAAAiG,GAAC,OAAIA,EAAEjG,IACTgM,EAAE,SAAA/F,GAAC,OAAIA,EAAE+F,IACTI,MAAMpH,MAWT,OATgBI,EACbQ,OAAO,QACPyG,MAAMN,GACNlG,KAAK,IAAKsG,GACVzF,MAAM,SAAUhB,GAChBgB,MAAM,mBAAoB,QAC1BA,MAAM,OAAQ,QACdA,MAAM,eAAgB,GF0BP4F,CACdlQ,KAAKmQ,kBACLxC,EACA1E,EACAC,EACAsE,EAAKlF,YACLkF,EAAKlE,YAEPtJ,KAAK8M,SAASnK,GAAQqM,EG3EX,SACbhG,EACAjB,EACAkB,EACAC,EACAI,EACAD,GAEA,IAAM+G,EAAcrF,KAAKsF,MAAOtI,EAAc,GAAMsB,GAE9CiH,EAAS1H,KAASwH,EADL,KAIbG,EAAOvH,EACVQ,OAAO,UACPC,KAAK,KAAMR,GACXQ,KAAK,KAAMP,GACXO,KAAK,IAAK,GACVa,MAAM,OAAQ,QACdA,MAAM,SAAUhB,GAEnBgH,EAAO5J,QAAQ,SAAC8J,EAAGpR,GACjB,IACMqR,EADe,IAC8BD,EAdlC,IAejBD,EACGG,aACAtH,SAfY,IAgBZuH,MAhBY,GAgBNvR,GACNqK,KAAK,IAAK+G,GACVlG,MAAM,eAAgBmG,GACtBlR,GAAG,MAAO,SAACsK,EAAGzK,EAAGwR,GACNC,MAANL,GAAsBI,EAAMxR,GAAGkN,aH8CvCwE,CACE9Q,KAAK+Q,eACLpD,EACA1E,EACAC,EACAsE,EAAKlE,WACLkE,EAAKnE,aAGP,IIrF0B2H,EJqFpBC,EKtFH,SACLjI,EACAjB,EACAmJ,EAHKnS,GAKL,IADEyM,EACFzM,EADEyM,MAAOC,EACT1M,EADS0M,OAAQC,EACjB3M,EADiB2M,MAAOpC,EACxBvK,EADwBuK,WAGxBN,EAAOmI,OAAO,wBAAwB7E,SACtC,IAAM2E,EAAiBjI,EAAOQ,OAAO,KAAKC,KAAK,KAAM,uBAC/C2H,EAAWrJ,EAAc,GAEzBoG,EAAoBpG,EAAc,IAClCI,EAAkBiJ,EAAW,EAC7BxN,EAAImE,EAAcqJ,EAClBxB,EAAIsB,EAJWhJ,GAAeH,GAIIqJ,EAClCC,EAAK,UAiEX,OA9DAJ,EACGzH,OAAO,QACPC,KAAK,QAAS2H,GACd3H,KAAK,SAAU2H,GACf3H,KAAK,IAAK7F,GACV6F,KAAK,IAAKmG,GACVtF,MAAM,OAAQhB,GAEjB2H,EACGzH,OAAO,QACPC,KAAK,IAAK7F,EAAIuK,GACd1E,KAAK,IAAKmG,EAAsB,EAAlBzH,GACdsB,KAAK,KAAM4H,GACX5H,KAAK,YAfS,SAgBdkF,KAAK,SAERsC,EACGzH,OAAO,QACPC,KAAK,IAAK7F,EAAIuK,GACd1E,KAAK,IAAKmG,EAAsB,EAAlBzH,GACdsB,KAAK,KAAM4H,GACX5H,KAAK,YAvBS,SAwBda,MAAM,cAAe,OACrBA,MAAM,OAAQ,WACdqE,KAAKnD,GAERyF,EACGzH,OAAO,QACPC,KAAK,IAAK7F,EAAIuK,GACd1E,KAAK,IAAKmG,EAAsB,EAAlBzH,GACdsB,KAAK,KAAM4H,GACX5H,KAAK,YAjCS,SAkCdkF,KAAK,UAERsC,EACGzH,OAAO,QACPC,KAAK,IAAK7F,EAAIuK,GACd1E,KAAK,IAAKmG,EAAsB,EAAlBzH,GACdsB,KAAK,KAAM4H,GACX5H,KAAK,YAzCS,SA0Cda,MAAM,cAAe,OACrBA,MAAM,OAAQ,WACdqE,KAAKlD,GAERwF,EACGzH,OAAO,QACPC,KAAK,IAAK7F,EAAIuK,GACd1E,KAAK,IAAKmG,EAAsB,EAAlBzH,GACdsB,KAAK,KAAM4H,GACX5H,KAAK,YAnDS,SAoDdkF,KAAK,SAERsC,EACGzH,OAAO,QACPC,KAAK,IAAK7F,EAAIuK,GACd1E,KAAK,IAAKmG,EAAsB,EAAlBzH,GACdsB,KAAK,KAAM4H,GACX5H,KAAK,YA3DS,SA4Dda,MAAM,cAAe,OACrBA,MAAM,OAAQ,WACdqE,KAAKjD,GAEDuF,ELMkBK,CACrBtR,KAAKuR,wBACL5D,EACAC,EACAJ,GAEFxN,KAAK+M,MAAMpK,GAAQsO,EAEfjR,KAAK0M,OAAOT,UI7FU+E,EJ6FaxD,EAAKnC,OAAQmC,EAAKlE,WI5F3DV,KAAa,cAAc4I,KAAK,SAAAC,GAE9B,GADe7I,KAAe6I,EAAST,GAC3B,CACV,IAAMU,EAAO9I,KAAA,WAAAjH,OAAqB8P,EAAQ7P,KAAM0I,MAAM,QACtD1B,KAAA,WAAAjH,OAAqB8P,EAAQ7P,KAE1B0I,MAAM,OAAQqH,GAAOD,GAAME,SAAS,uCJyFtCjP,GACH2J,GAAO3J,EAAM3C,KAAK4M,SAClBN,GAAO3J,EAAM3C,KAAK6M,QAClBP,GAAO3J,EAAM3C,KAAK8M,UAClBR,GAAO3J,EAAM3C,KAAK+M,wCAIlB/M,KAAK6L,QAAQgG,QADN,IAAAC,EAE0B9R,KAAK6L,QAAQ6B,WAAtCC,EAFDmE,EAECnE,MAAOC,EAFRkE,EAEQlE,OACTmE,EAHCD,EAEgBE,MACMhS,KAAK0M,OAAOR,MAAMG,YACzCF,EAASnM,KAAK0M,OAAOR,MAAMC,OAC3BC,EAAgBpM,KAAK0M,OAAOR,MAAME,cAClC6F,EAAe/J,GAAeyF,GAE9BuE,EAAMlS,KAAK6L,QAAQqG,IA4BzB,GA1BAlS,KAAKmS,aAAeD,EACjB1I,OAAO,KACPC,KAAK,YAFY,gBAAA9H,OAEiBsQ,EAFjB,MAGjBzI,OAAO,KACPC,KAAK,KAAM,OAEdzJ,KAAK+O,gBAAkBmD,EAAI1I,OAAO,KAAKC,KAAK,KAAM,UAClDzJ,KAAKmQ,kBAAoB+B,EACtB1I,OAAO,KACPC,KAAK,KAAM,YACXA,KAAK,YAHiB,gBAAA9H,OAGYsQ,EAHZ,MAIzBjS,KAAKiO,iBAAmBiE,EACrB1I,OAAO,KACPC,KAAK,YAFgB,gBAAA9H,OAEasQ,EAFb,MAGrBzI,OAAO,KACPC,KAAK,KAAM,WACdzJ,KAAK+Q,eAAiBmB,EACnB1I,OAAO,KACPC,KAAK,KAAM,SACXA,KAAK,YAHc,gBAAA9H,OAGesQ,EAHf,MAItBjS,KAAKuR,wBAA0BW,EAC5B1I,OAAO,KACPC,KAAK,KAAM,kBACXA,KAAK,YAHuB,gBAAA9H,OAGMsQ,EAHN,MAM3BjS,KAAKmN,QAAS,CAChBnN,KAAK8N,WH3GJ,SAA0BH,EAAOC,EAAQoE,EAAO5F,EAAeD,GACpE,OAAOiG,OAEJJ,MAAMA,GACNK,UAAU,CAAC1E,EAAQ,EAAGC,EAAS,EAAIA,EAASxB,IAC5CkG,OAAO,CAACnG,EAAQ,EAAG,IGsGAoG,CAChB5E,EACAC,EAASqE,EACTF,EACA3F,EACAD,GAEF,IAAMqG,EAAO5J,OAAakF,WAAW9N,KAAK8N,YAC1C9N,KAAKmS,aACF/H,UAAU,cACVxJ,KAAKZ,KAAKoN,WACV/C,QACAb,OAAO,QACPC,KAAK,KAAM,SAAAI,GAAC,gBAAAlI,OAAckI,EAAEjI,MAC5B6H,KAAK,QAAS,aACdA,KAAK,IAAK+I,GACVlI,MAAM,SAAU,WAChBA,MAAM,eAAgB,IACtBA,MAAM,OAAQ,SAAAT,GAAC,MAAc,QAATA,EAAEjI,GAAe,OAAS,sBM/J1C2G,GAAS,CACpBC,cAAe,GAAK,EACpBC,cAAe,KAEXgK,GAAQlK,GAAOE,cAQA+D,cACnB,SAAAA,EAAY/N,GAAKqB,OAAAC,EAAA,EAAAD,CAAAE,KAAAwM,GACfxM,KAAKvB,GAAKA,EACVuB,KAAK6R,+DAGIa,GACT1S,KAAKvB,GAAG6L,MAAMuB,QAAU6G,EAAY,QAAU,uCAI9C,IAAM9J,EAAKuI,aAAOnR,KAAKvB,IAQvB,OAPAmK,EAAGwB,UAAU,KAAKkC,SAElBtM,KAAK0N,WAST,SAA6BjP,GAC3B,IAAMkU,EAAIlU,EAAGmU,YACPvD,EAAI5Q,EAAGoU,aACPC,EAAkBH,EAAItD,EAEtB1B,EAAQmF,EAAkBL,GAAQE,EAAItD,EAAIoD,GAC1C7E,EAASkF,EAAkBL,GAAQE,EAAIF,GAAQpD,EAC/C2C,EAAQS,KAAUlK,GAAOE,cAAgBkF,EAAQ,IAAMA,EAAQ,IACrE,MAAO,CAAEA,QAAOC,SAAQoE,SAjBJe,CAAoB/S,KAAKvB,IAC3CuB,KAAKkS,IAAMtJ,EACRY,OAAO,OACPC,KAAK,QAASzJ,KAAK0N,WAAWC,OAC9BlE,KAAK,SAAUzJ,KAAK0N,WAAWE,QAC3B5N,KAAKkS,aCtBD,IAAAc,GAAA,CAAEC,KAEV,SAAcxU,GACdA,IAAIA,EAwCX,WACE,IAAMA,EAAK+P,SAAS0E,cAAc,OAGlC,OAFAzU,EAAG0U,aAAa,QAAS,WACzB3E,SAAS4E,KAAKC,YAAY5U,GACnBA,EA5COyU,IACd,IAEII,EAFEzH,EAAU,IAAIW,GAAQ/N,GAC5BoN,EAAQ0H,YAAW,GAEnB,IAAMC,EAASC,oBAAS,WAClBH,GAASA,EAAQrG,UACpB,KAGH,OAFAyG,OAAOC,iBAAiB,SAAUH,GAE3B,SAAiBrU,GACtB,OAAQA,EAAO1B,MACb,KAAKH,EACkBgW,EAAjBnU,EAAO3B,SAwCnB,SAAuBA,EAAUqO,GAC/BA,EAAQ0H,YAAW,GACnB,IAAM5G,EAAU,IAAIiH,GAAQpW,EAAUqO,GAMtC,OALAc,EAAQM,SACRhL,MAAMzE,EAASmP,QAAQX,WACpB9J,KAAK,SAAA6B,GAAQ,OAAIA,EAASQ,SAC1BrC,KAAK,SAAAtB,GAAI,OAAI+L,EAAQkH,WAAWjT,KAE5B+L,EAhD8BmH,CAAc3U,EAAO3B,SAAUqO,GAmCtE,SAAuBc,EAASd,GAE9B,OADAA,EAAQ0H,YAAW,GACZ,KApCcQ,CAAcT,EAASzH,GACtC,MAcF,KAAK9N,EAAL,IACUH,EAAmBuB,EAAnBvB,OAAmBuB,EAAXf,OACLF,UAAWoV,EAAQU,KAAKpW,GAC9B0V,EAAQW,KAAKrW,+CCzCpBsW,GAAQ,CACZ/N,KAAM,gBACNgO,IACE,kRACFC,KACE,o0BACFC,OACE,shBACFC,SACE,uhDACFC,MACE,0NACFC,WACE,iFACFC,SACE,mPACFC,SACE,8LACFC,WACE,2FACFC,UACE,mWAsBWC,GAnBF,SAAA9V,GAAA,IAAG+V,EAAH/V,EAAG+V,KAAMhJ,EAAT/M,EAAS+M,MAAOiJ,EAAhBhW,EAAgBgW,QAAhB,OACXC,EAAAxF,EAAA0D,cAAA,OACE+B,KAAMnJ,GAAS,OACfiJ,QAASA,EACTnH,OAAO,KACPsH,QAAQ,YACRvH,MAAM,KACNwH,MAAM,8BAENH,EAAAxF,EAAA0D,cAAA,QAAMrJ,EAAGqK,GAAMY,IAASA,MC3BfM,GAASC,KAAI,SAAJA,CAAc,CAClCvJ,MAAO,QACPD,QAAS,QACTyJ,WAAY,QACZC,KAAM,UACNC,QAAS,QACTC,SAAU,CACRC,eAAgB,eAIPC,GAAON,KAAI,SAAJA,CAAc,CAChCvJ,MAAO,QACPD,QAAS,QACTyJ,WAAY,OACZC,KAAM,UACNK,OAAQ,ICUJC,GAAYR,KAAI,MAAJA,CAAW,IACvBS,GAAaT,KAAI,MAAJA,CAAW,CAC5BU,UAAW,MACXC,SAAU,EACVC,UAAW,WAGEZ,QAtCC,SAAAtW,GAAA,IACdmX,EADcnX,EACdmX,UACA1Y,EAFcuB,EAEdvB,SACAsG,EAHc/E,EAGd+E,MACAqS,EAJcpX,EAIdoX,gBACAC,EALcrX,EAKdqX,UACAC,EANctX,EAMdsX,OACAC,EAPcvX,EAOduX,eACAC,EARcxX,EAQdwX,aACAC,EATczX,EASdyX,aATc,OAWdxB,EAAAxF,EAAA0D,cAAA,UAAQgD,UAAWA,GACjBlB,EAAAxF,EAAA0D,cAAA,WACE8B,EAAAxF,EAAA0D,cAACuD,GAAD,CAAM3B,KAAK,MAAMC,QAASsB,KAE5BrB,EAAAxF,EAAA0D,cAAC4C,GAAD,CAAYlU,GAAG,aAAamT,QAASoB,GAClC3Y,EAAS4N,KAAKI,MADjB,KAC0BhO,EAAS4N,KAAKsL,aAExC1B,EAAAxF,EAAA0D,cAAC2C,GAAD,CAAWjU,GAAG,aACXkC,EAAM5F,UAAY8W,EAAAxF,EAAA0D,cAACuD,GAAD,CAAM3B,KAAK,OAAOC,QAASqB,IAAgB,GAC9DpB,EAAAxF,EAAA0D,cAACuD,GAAD,CAAM3B,KAAK,UAEbE,EAAAxF,EAAA0D,cAACuD,GAAD,CAAM3B,KAAK,WAAWC,QAASwB,IAC/BvB,EAAAxF,EAAA0D,cAACuD,GAAD,CAAM3B,KAAK,WAAWC,QAASuB,IAC/BtB,EAAAxF,EAAA0D,cAACuD,GAAD,CAAM3B,KAAK,SAASC,QAASyB,MAclBnB,CAAa,CAC1BxJ,QAAS,OACT8K,cAAe,MACfC,gBAAiB,QACjBpB,QAAS,iCC1CLU,GAAYb,KAAI,CACpBwB,OAAQ,SACRC,WAAY,MACZC,SAAU,OACVH,gBAAiB,QACjBI,aAAc,CACZC,WAAY,IACZJ,OAAQ,WAmCGK,GA/BC,SAAAnY,GAAA,IACdvB,EADcuB,EACdvB,SACA2Z,EAFcpY,EAEdoY,cACAC,EAHcrY,EAGdqY,iBACAjB,EAJcpX,EAIdoX,gBAJc,OAMdnB,EAAAxF,EAAA0D,cAAA,OAAKgD,UAAWA,IACbiB,IAAkB3Z,GACjBwX,EAAAxF,EAAA0D,cAAA8B,EAAAxF,EAAA6H,SAAA,KACErC,EAAAxF,EAAA0D,cAAA,wCACCiE,EAAchU,IAAI,SAAAsJ,GAAG,OACpBuI,EAAAxF,EAAA0D,cAACyC,GAAD,CAAMzU,IAAKuL,EAAI7K,GAAImT,QAAS,kBAAMqC,EAAiB3K,KAChDA,EAAIrB,KAAKI,MADZ,KACqBiB,EAAIrB,KAAKsL,gBAMnClZ,GACCwX,EAAAxF,EAAA0D,cAAA8B,EAAAxF,EAAA6H,SAAA,KACErC,EAAAxF,EAAA0D,cAAA,UAAK1V,EAAS4N,KAAKI,OACnBwJ,EAAAxF,EAAA0D,cAAA,SAAI1V,EAAS4N,KAAKsL,aAClB1B,EAAAxF,EAAA0D,cAACkC,GAAD,CAAQL,QAASoB,GAAjB,sBCGO1V,eAJS,SAAA6W,GAAK,OAAIA,GACN,SAAAtY,GAAQ,MAAK,CACtCoY,iBAAkB,SAAA5Z,GAAQ,OAAIwB,EAASzB,EAAYC,OAEtCiD,CAnCM,SAAA1B,GAA6C,IAA1CvB,EAA0CuB,EAA1CvB,SAAU+Z,EAAgCxY,EAAhCwY,QAASH,EAAuBrY,EAAvBqY,iBAAuBI,EAC9BC,oBAAS,GADqBC,EAAA5X,OAAAkO,GAAA,EAAAlO,CAAA0X,EAAA,GAC9CG,GAD8CD,EAAA,GAAAA,EAAA,IAAAE,EAEtCH,mBAAS,MAF6BI,EAAA/X,OAAAkO,GAAA,EAAAlO,CAAA8X,EAAA,GAEzDE,EAFyDD,EAAA,GAElDE,EAFkDF,EAAA,GAGhEG,oBACE,WACE,IAAIC,GAAU,EAEd,OpBAC,WAAwC,IAApBxT,EAAoBC,UAAArF,OAAA,QAAAkC,IAAAmD,UAAA,GAAAA,UAAA,GAAVJ,EAEnC,OAAOzC,EADE,GAAAF,OAAM8C,EAAN,wBACeF,GoBHpB2T,GAAahW,KAAK,SAAA4V,GAAK,OAAIG,GAAWF,EAASD,KACxC,kBAAOG,GAAU,IAE1B,CAACza,IAYH,OACEwX,EAAAxF,EAAA0D,cAACiF,GAAD,CACE3a,SAAUA,EACV2Z,cAAeW,EACfV,iBAbmB,SAAA5Z,GACrBma,GAAa,GACbnT,EAAchH,EAASoE,IACpBM,KAAKkV,GACLlV,KAAKqV,IAUNpB,gBAPkB,kBAAMiB,EAAiB,eCH7B/B,KAAI,CACpBuB,gBAAiB,OACjBhJ,OAAQ,kCC6BKwK,uBAhDb,SAAAA,EAAYC,GAAO,IAAA3X,EAAA,OAAAZ,OAAAC,EAAA,EAAAD,CAAAE,KAAAoY,IACjB1X,EAAAZ,OAAAwY,GAAA,EAAAxY,CAAAE,KAAAF,OAAAyY,GAAA,EAAAzY,CAAAsY,GAAAI,KAAAxY,KAAMqY,KACDI,SAAU,EAFE/X,4EAKPgY,GAEV,GAAIA,EACF1Y,KAAKyY,SAAU,OACV,IAAqB,IAAjBzY,KAAKyY,QAEd,YADAzY,KAAKyY,SAAU,GAGjB,IAAME,GAAW3Y,KAAKqY,MAAMM,QAC5B3Y,KAAKqY,MAAMM,EAAU,UAAY,aAAa3Y,KAAKqY,MAAM1V,uCAGlD,IAAAgE,EAAA3G,KAAA4Y,EACwC5Y,KAAKqY,MAA5CvM,EADD8M,EACC9M,MAAO6M,EADRC,EACQD,QAASE,EADjBD,EACiBC,MAAOC,EADxBF,EACwBE,MAAOnW,EAD/BiW,EAC+BjW,KACtC,OACEqS,EAAAxF,EAAA0D,cAAA,UACEgD,UAAS,OAAAvU,OAASgX,EAAU,UAAY,IACxCrO,MAAO,CACLyO,YAAajN,GAEfkN,aAAcH,EAAQ,kBAAMlS,EAAKsS,aAAY,SAAQ1X,EACrD2X,YAAa,kBAAMvS,EAAKsS,aAAY,KAEnCH,EAAQ9D,EAAAxF,EAAA0D,cAAA,OAAKiG,IAAKL,EAAOM,IAAKzW,IAAW,WA7BhC0W,IAAMC,YCClBC,GAAY,SAAAxa,GAAA,IAAGyH,EAAHzH,EAAGyH,MAAOpI,EAAVW,EAAUX,OAAQob,EAAlBza,EAAkBya,aAAcC,EAAhC1a,EAAgC0a,cAAhC,OAChBzE,EAAAxF,EAAA0D,cAAA,WACG1M,EAAMzD,QAAQI,IAAI,SAAAR,GAAI,OACrBqS,EAAAxF,EAAA0D,cAACwG,GAAD,CACExY,IAAKyB,EACLA,KAAMA,EACNgW,QAASva,EAAOuE,IAASvE,EAAOuE,GAAMzE,UACtC4N,MAAOtF,EAAMsF,MACb6N,QAASH,EACTI,UAAWH,QAwBJpE,QAlBF,SAAAwE,GAAkE,IAA/Drc,EAA+Dqc,EAA/Drc,SAAUY,EAAqDyb,EAArDzb,OAAQ8X,EAA6C2D,EAA7C3D,UAAWsD,EAAkCK,EAAlCL,aAAcC,EAAoBI,EAApBJ,cACzD,OACEzE,EAAAxF,EAAA0D,cAAA,OAAKgD,UAAWA,GACb1Y,EAAS8I,OAAOnD,IAAI,SAAAqD,GAAK,OACxBwO,EAAAxF,EAAA0D,cAAC4G,GAAD,CACE5Y,IAAKsF,EAAM7D,KACX6D,MAAOA,EACPpI,OAAQA,EACRob,aAAcA,EACdC,cAAeA,QASVpE,CAAU,CACvBuB,gBAAiB,QACjBpB,QAAS,gBACTuE,UAAW,SC3BEtZ,eAVS,SAAAwG,GAAO,MAAK,CAClCzJ,SAAUyJ,EAAQzJ,SAClBY,OAAQ6I,EAAQnD,MAAM1F,SAGG,SAAAY,GAAQ,MAAK,CACtCwa,aAAc,SAAAQ,GAAG,OAAIhb,EAASrB,EAASqc,KACvCP,cAAe,SAAAO,GAAG,OAAIhb,EAASlB,EAAWkc,OAG7BvZ,CAGbwZ,uBCFIC,GAAU7E,KAXH,SAAAtW,GAAA,IAAG4a,EAAH5a,EAAG4a,QAASC,EAAZ7a,EAAY6a,UAAW1D,EAAvBnX,EAAuBmX,UAAWiE,EAAlCpb,EAAkCob,SAAlC,OACXnF,EAAAxF,EAAA0D,cAAA,UAAQgD,UAAWA,EAAWgD,YAAaS,EAASS,UAAWR,GAC5DO,IASW9E,CAAU,SAAAgD,GAAK,MAAK,CAClCzC,OAAM,aAAAjU,OAAe0W,EAAMvM,OAC3BA,MAAOuM,EAAMvM,MACb8K,gBAAiByB,EAAMM,QAAUN,EAAMvM,MAAQ,QAC/CuO,YAAa,QACb7E,QAAS,UACT8E,UAAW,CACT1D,gBAAiByB,EAAMvM,MACvBA,MAAO,YAIXoO,GAAQK,UAAY,CAClBzO,MAAO0O,KAAUC,QAGJP,UCzBTQ,GAAQC,KAAU,MAAVA,CAAiB,SAAAtC,GAAK,MAAK,CACvCvM,MAAOuM,EAAMvM,MACb8O,UAAS,aAAAjZ,OAAe0W,EAAMwC,OAASxC,EAAMvM,MAAQ,SACrDgP,OAAQ,CACN/E,UAAW,OAEbgF,aAAc,SAGV7E,GAAYb,KAAI,CAAEG,QAAS,MAAOoB,gBAAiB,UA6C1CoE,GA3CA,SAAAjc,GAAA,IACbvB,EADauB,EACbvB,SACAyd,EAFalc,EAEbkc,QACA5V,EAHatG,EAGbsG,QACAjH,EAJaW,EAIbX,OACA8c,EALanc,EAKbmc,gBACAvB,EANa5a,EAMb4a,QACAC,EAPa7a,EAOb6a,UAPa,OASb5E,EAAAxF,EAAA0D,cAAA,OAAKgD,UAAWA,IACdlB,EAAAxF,EAAA0D,cAAA,oBACC1V,EAAS8I,OAAOnD,IAAI,SAAAqD,GAAK,OACxBwO,EAAAxF,EAAA0D,cAACwH,GAAD,CAAOxZ,IAAKsF,EAAM5E,GAAIiZ,OAAQxV,EAAQmB,EAAM5E,IAAKkK,MAAOtF,EAAMsF,OAC5DkJ,EAAAxF,EAAA0D,cAAA,UAAK1M,EAAM5E,IACXoT,EAAAxF,EAAA0D,cAAA,WACG1M,EAAMzD,QAAQI,IAAI,SAAAvF,GAAM,OACvBoX,EAAAxF,EAAA0D,cAACiI,GAAD,CACEja,IAAKtD,EACL+a,QAASva,EAAOR,IAAWQ,EAAOR,GAAQM,UAC1Cyb,QAAS,kBAAMA,EAAQ/b,IACvBgc,UAAW,kBAAMA,EAAUhc,IAC3BkO,MAAOtO,EAASyF,MAAMrF,GAAQiO,QAAQC,OAErClO,MAIPoX,EAAAxF,EAAA0D,cAAA,SACEzV,KAAK,QACL2d,IAAI,IACJC,IAAI,MACJla,MAAO8Z,EAAQzU,EAAM5E,IACrB0Z,SAAU,SAAAC,GAAC,OAAIL,EAAgB1U,EAAM5E,GAAI2Z,EAAEC,OAAOra,eChC7CV,eAbS,SAAAwG,GAAO,MAAK,CAClCzJ,SAAUyJ,EAAQzJ,SAClBY,OAAQ6I,EAAQnD,MAAM1F,OACtB6c,QAAShU,EAAQX,OAAO2U,QACxB5V,QAAS4B,EAAQX,OAAOjB,UAGC,SAAArG,GAAQ,MAAK,CACtCkc,gBAAiB,SAAC1U,EAAOrF,GAAR,OAAkBnC,EhC6BkB,CACrDvB,KAAMc,EACNkI,QgC/B8DD,EhCgC9DiV,OgChCqEta,KACrEwY,QAAS,SAAAK,GAAG,OAAIhb,EAASrB,EAASqc,KAClCJ,UAAW,SAAAI,GAAG,OAAIhb,EAASlB,EAAWkc,OAGzBvZ,CAGbua,ICYK,SAASU,GAAele,GAC7B,OAAOgE,EAAKhE,EAAU,cAAe,kBAGvC,SAAqBiX,GACnB,IAAKA,EAAU,MAAO,GADO,IAErBkH,EAAqBlH,EAArBkH,SAAUC,EAAWnH,EAAXmH,OAClB,OAAO9b,OAAOkD,KAAK4Y,GAAQnY,OAAO,SAACN,EAAKjC,GACtC,IAAMC,EAAKrB,OAAA+b,GAAA,EAAA/b,CAAA,GAAQ6b,EAAaC,EAAO1a,IAKvC,OAJAC,EAAMD,IAAMA,EACZiC,EAAIjC,GAAOC,EACXgC,EAAIjC,EAAI4a,eAAiB3a,EACzBgC,EAAIhC,EAAMvD,QAAUuD,EACbgC,GACN,IAbwC4Y,CAAYve,EAASiX,YAgBnD,IAAAuH,GAAA,CAAEnd,QA9CV,SAAAE,GAA2C,IAAxBgI,EAAwBhI,EAAxBgI,WAAY/H,EAAYD,EAAZC,SAC9B2Z,EAAU,GAEhBjF,OAAOuI,UAAY,SAASV,GAC1B,IAAMra,EAAMqa,EAAEra,IACd,IAAIyX,EAAQzX,GAAZ,CAEAyX,EAAQzX,IAAO,EACf,IAAM1D,EAAWuJ,IAAavJ,SAC9B,GAAKA,EAAL,CAEA,IACM6I,EADSqV,GAAele,GACV0D,GAChBmF,GAAMrH,EAASrB,EAAS0I,EAAKzI,YAGnC8V,OAAOwI,QAAU,SAASX,GACxB,IAAMra,EAAMqa,EAAEra,IACdyX,EAAQzX,IAAO,EAEf,IAAM1D,EAAWuJ,IAAavJ,SAC9B,GAAKA,EAAL,CAEA,IACM6I,EADSqV,GAAele,GACV0D,GAChBmF,GAAMrH,EAASlB,EAAWuI,EAAKzI,aCtBjCue,GAAM9G,KAAI6E,GAAJ7E,CAAa,SAAAgD,GAAK,MAAK,CACjCgC,YAAa,QACb7E,QAAS,aA0BIH,QAvBE,SAAAtW,GAAyD,IAAtDvB,EAAsDuB,EAAtDvB,SAAUY,EAA4CW,EAA5CX,OAAQ8X,EAAoCnX,EAApCmX,UAAWyD,EAAyB5a,EAAzB4a,QAASC,EAAgB7a,EAAhB6a,UAClDgC,EAASF,GAAele,GAC9B,OACEwX,EAAAxF,EAAA0D,cAAA,OAAKgD,UAAWA,EAAWtU,GAAG,YAC3BpE,EAAS8I,OAAOnD,IAAI,SAAAqD,GAAK,OACxBA,EAAMzD,QAAQI,IAAI,SAAAR,GAAI,OACpBqS,EAAAxF,EAAA0D,cAACiJ,GAAD,CACEjb,IAAKyB,EACLgW,QAASva,EAAOuE,IAASvE,EAAOuE,GAAMzE,UACtC4N,MAAOtF,EAAMsF,MACb6N,QAAS,kBAAMA,EAAQhX,IACvBiX,UAAW,kBAAMA,EAAUjX,KAE1BiZ,EAAOjZ,GAAQiZ,EAAOjZ,GAAMzB,IAAI4a,cAAgB,WAU9CzG,CAAc,CAC3BuB,gBAAiB,QACjBX,UAAW,SACXT,QAAS,sBCvBI/U,eAVS,SAAAwG,GAAO,MAAK,CAClCzJ,SAAUyJ,EAAQzJ,SAClBY,OAAQ6I,EAAQnD,MAAM1F,SAGG,SAAAY,GAAQ,MAAK,CACtC2a,QAAS,SAAAK,GAAG,OAAIhb,EAASrB,EAASqc,KAClCJ,UAAW,SAAAI,GAAG,OAAIhb,EAASlB,EAAWkc,OAGzBvZ,CAGb2b,iCCfF5H,GAAA,CAAiB6H,iBAEV,SAA0BC,GAC3BC,aACED,EAAcC,aACbA,YAL0BjB,SAS5B,SAAkBkB,GACnBD,YACFA,MAAU,SAAU,kBAAMC,EAASD,kCCVjCE,GAAQ,CACZ,CACEjB,OAAQ,cACRkB,QACE,uFACFC,UAAW,SACXC,eAAe,GAEjB,CACEpB,OAAQ,YACRkB,QACE,uFACFC,UAAW,MACXC,eAAe,GAEjB,CACEpB,OAAQ,aACRkB,QAAS,kDACTE,eAAe,IAIbC,GAAS,CACbC,KAAM,WACNC,MAAO,SACPC,KAAM,oBACN9d,KAAM,YACN+d,KAAM,SAeFC,GAAS,CACbC,QAbc,CACdC,WAAY,OACZxG,gBAAiB,OACjByG,WAAY,GACZC,aAAc,2BACdC,aAAc,OACdC,gBAAiB,8BACjBC,UAAW,QACX9P,WAAOpM,EACPmc,OAAQ,KAKRC,QAAS,CAAE5G,SAAU,GAAI6G,WAAY,UACrCC,WAAY,CAAE9G,SAAU,KAGX+G,GAAA,SAAA/e,GAAA,IAAGgf,EAAHhf,EAAGgf,IAAKC,EAARjf,EAAQif,OAAR,OACbhJ,EAAAxF,EAAA0D,cAAC+K,GAAA,EAAD,CACEzB,SAAU,SAAAlF,GAAK,MAAqB,UAAjBA,EAAMnY,QAAsB6e,KAC/CD,IAAKA,EACLlB,OAAQA,GACRK,OAAQA,GACRgB,cAAc,EACdC,gBAAgB,EAChBC,YAAY,EACZ3B,MAAOA,MCtCL4B,GAAiB,SAAA3L,GAAS,MAAK,CAAEjV,KAAM,OAAQiV,cAC/C4L,GAAoB,SAAA5L,GAAS,MAAK,CAAEjV,KAAM,UAAWiV,cAK3D,SAAS6L,GAAQjH,EAAOnY,GACtB,OAAQA,EAAO1B,MACb,IAAK,UACH,OAAOqC,OAAA+b,GAAA,EAAA/b,CAAA,GAAKwX,EAAZ,CAAmBkH,eAAgBrf,EAAOuT,YAC5C,IAAK,aACH,OAAO5S,OAAA+b,GAAA,EAAA/b,CAAA,GAAKwX,EAAZ,CAAmBgF,aAAcnd,EAAOmd,eAC1C,IAAK,OACH,OAAOxc,OAAA+b,GAAA,EAAA/b,CAAA,GAAKwX,EAAZ,CAAmBmH,KAAMtf,EAAOuT,YAClC,IAAK,OACH,OAAO5S,OAAA+b,GAAA,EAAA/b,CAAA,GAAKwX,EAAZ,CAAmBoH,YAAavf,EAAOuT,YACzC,IAAK,SACH,OAAO5S,OAAA+b,GAAA,EAAA/b,CAAA,GAAKwX,EAAZ,CAAmBqH,cAAexf,EAAOuT,YAC3C,QACE,OAAO4E,GAIb,IAmEMsH,GAAc,CAClBC,QAAS,CACPjI,gBAAiB,qBACjB8G,OAAQ,KAEVhB,QAAS,CAEPoC,SAAU,QACVC,UAAW,qBACXC,IAAK,MACLC,KAAM,MACNC,UAAW,wBAOXtJ,OAAQ,GACRN,WAAY,QACZ6J,aAAc,EACdzB,OAAQ,MAIN0B,GAAO/J,KAAI,MAAJA,CAAW,CACtBxJ,QAAS,OACT8K,cAAe,SACfoD,UAAW,UAGPsF,GAAUhK,KAAI,MAAJA,CAAW,CACzBxJ,QAAS,OACTmK,SAAU,EACVW,cAAe,MACf/I,OAAQ,OACRmM,UAAW,OACXgF,UAAW,OACXO,SAAU,WAGNC,GAASlK,KAAI,MAAJA,CAAW,CACxBW,SAAU,IAGGwJ,GAhHH,SAAAzgB,GAAgD,IAA7CvB,EAA6CuB,EAA7CvB,SAA6CiiB,GAAA1gB,EAAnCP,cAAmCO,EAApBL,cAChBghB,qBAAWnB,GAjCd,SAAA/gB,GAAQ,MAAK,CAChC8e,cAAc,EACdkC,gBAAiBhhB,EACjBkhB,aAAa,EACbC,eAAe,EACfF,MAAM,GA4BoCkB,CAAaniB,KADGoiB,EAAA9f,OAAAkO,GAAA,EAAAlO,CAAA2f,EAAA,GACnDnI,EADmDsI,EAAA,GAC5CC,EAD4CD,EAAA,GAOpDE,EAAc,kBAAMD,EAAKvB,IAAkB,KAKjDtG,oBACE,kBACE+H,GAAWzE,SAAS,SAAAgB,GAAY,OAAIuD,EAjCpB,SAAAvD,GAAY,MAAK,CAAE7e,KAAM,aAAc6e,gBAiCd0D,CAAc1D,OACzD,IAGF,IAAM2D,GAAW3I,EAAMgF,aAEvB,OACEtH,EAAAxF,EAAA0D,cAAA8B,EAAAxF,EAAA6H,SAAA,KACG7Z,GACCwX,EAAAxF,EAAA0D,cAACkM,GAAD,CAAMlJ,UAAU,OACdlB,EAAAxF,EAAA0D,cAAC4K,GAAD,CAAMC,IAAKzG,EAAMmH,KAAMT,OAdZ,kBAAM6B,EAAKxB,IAAe,OAepC4B,GACCjL,EAAAxF,EAAA0D,cAACgN,GAAD,CACE1iB,SAAUA,EACV6Y,OAnBG,kBAAMwJ,EAAKxB,IAAe,KAoB7Bva,MAAO,GACPqS,gBAtBQ,kBAAM0J,EAAKvB,IAAkB,KAuBrC/H,aA3BO,kBAAMsJ,EAzBU,CAAEpiB,KAAM,OAAQiV,WAyBL4E,EAAMoH,eA4BxCpI,eA3BS,kBAAMuJ,EAzBU,CAAEpiB,KAAM,SAAUiV,WAyBL4E,EAAMqH,iBA4B5CnI,aA3BW,kBAAMuJ,GAAW1D,kBAAkB/E,EAAMgF,iBA8BxDtH,EAAAxF,EAAA0D,cAACmM,GAAD,KACGY,GAAW3I,EAAMoH,aAAe1J,EAAAxF,EAAA0D,cAACiN,GAAD,MACjCnL,EAAAxF,EAAA0D,cAACqM,GAAD,MAOCU,GAAW3I,EAAMqH,eAAiB3J,EAAAxF,EAAA0D,cAACkN,GAAD,OAEpCH,GAAWjL,EAAAxF,EAAA0D,cAACmN,GAAD,OAGhBrL,EAAAxF,EAAA0D,cAACoN,GAAA9Q,EAAD,CACE+Q,QAAS/iB,GAAY8Z,EAAMkH,eAC3BgC,2BAA2B,EAC3BC,eAAgBX,EAChBxV,MAAOsU,IAEP5J,EAAAxF,EAAA0D,cAACwN,GAAD,CAASnJ,QAASuI,OCzFXrf,eAPS,SAAAwG,GAAO,MAAK,CAClCzJ,SAAUyJ,EAAQzJ,WAGO,SAAAwB,GAAQ,OACjC2hB,aAAmB,CAAEniB,gBAAeE,iBAAiBM,IAExCyB,CAGbmgB,ICPapB,GAJH,SAAAzgB,GAAgB,IAAbwB,EAAaxB,EAAbwB,OACb,OAAOyU,EAAAxF,EAAA0D,cAAC2N,GAAD,CAAStgB,OAAQA,KCHpBugB,GAAc,gBAYb,IAAMC,GAAYtN,oBAAS,SAAA6D,GAChC,IACE,IAAM0J,EAAkBC,KAAKC,UAAU5J,GACvC6J,aAAaC,QAAQN,GAAaE,GAClC,MAAOzF,GACP/b,QAAQU,IAAI,qBAAsBqb,KAEnC,UAEmBha,WAAXmS,SAETA,OAAO2N,kBAAoB,kBAAMN,GAAU,MCpB7C,IAAMpB,GAAe,kBCIfA,GAAe,CACnBzhB,WAAW,EACXE,OAAQ,ICLV,IAAMuhB,GAAe,CACnBta,QAAS,GACT4V,QAAS,IAGLqG,GAAe,SAAC9jB,EAAU2D,GAAX,OACnB3D,EACIA,EAAS8I,OAAO7C,OAAO,SAAC8d,EAAKC,GAE3B,OADAD,EAAIC,EAAE5f,IAAMT,EACLogB,GACN,IACH,ICTSE,oBAAgB,CAC7BjkB,SHFa,WAA8C,IAA9B8Z,EAA8B5S,UAAArF,OAAA,QAAAkC,IAAAmD,UAAA,GAAAA,UAAA,GAAtBib,GAAcxgB,EAAQuF,UAAArF,OAAA,EAAAqF,UAAA,QAAAnD,EAC3D,OAAIpC,EAAO1B,OAASH,EAAqB6B,EAAO3B,SACzC8Z,GGCPxT,MFIa,WAA8C,IAA9BwT,EAA8B5S,UAAArF,OAAA,QAAAkC,IAAAmD,UAAA,GAAAA,UAAA,GAAtBib,GAAcxgB,EAAQuF,UAAArF,OAAA,EAAAqF,UAAA,QAAAnD,EAC3D,OAAQpC,EAAO1B,MACb,KAAKO,EACH,OAAO8B,OAAA+b,GAAA,EAAA/b,CAAA,GACFwX,EADL,CAEEpZ,UAAWiB,EAAOf,OAAOF,UACzBC,KAAMgB,EAAOf,OAAOD,OAExB,KAAKJ,EACH,OAAO+B,OAAA+b,GAAA,EAAA/b,CAAA,GACFwX,EADL,CAEElZ,OAAO0B,OAAA+b,GAAA,EAAA/b,CAAA,GAAMwX,EAAMlZ,OAAb0B,OAAA4hB,GAAA,EAAA5hB,CAAA,GAAsBX,EAAOvB,OAASuB,EAAOf,WAEvD,KAAKC,EACH,OAAOyB,OAAA+b,GAAA,EAAA/b,CAAA,GAAKwX,EAAZ,CAAmBlZ,OAAQ,KAC7B,QACE,OAAOkZ,IEnBXhR,ODQa,WAA8C,IAA9BgR,EAA8B5S,UAAArF,OAAA,QAAAkC,IAAAmD,UAAA,GAAAA,UAAA,GAAtBib,GAAcxgB,EAAQuF,UAAArF,OAAA,EAAAqF,UAAA,QAAAnD,EAC3D,OAAQpC,EAAO1B,MACb,KAAKH,EACH,MAAO,CACL+H,QAASic,GAAaniB,EAAO3B,SAAU,GACvCyd,QAASqG,GAAaniB,EAAO3B,SAAU,KAE3C,KAAKO,EAAL,IACU0I,EAAYtH,EAAZsH,QACFkb,EAAMxiB,EAAOf,OAAOF,UAAY,GAAK,EAC3C,OAAO4B,OAAA+b,GAAA,EAAA/b,CAAA,GACFwX,EADL,CAEEjS,QAAQvF,OAAA+b,GAAA,EAAA/b,CAAA,GACHwX,EAAMjS,QADJvF,OAAA4hB,GAAA,EAAA5hB,CAAA,GAEJ2G,EAAU6Q,EAAMjS,QAAQoB,GAAWkb,MAG1C,KAAKpjB,EACH,OAAOuB,OAAA+b,GAAA,EAAA/b,CAAA,GACFwX,EADL,CAEE2D,QAAQnb,OAAA+b,GAAA,EAAA/b,CAAA,GAAMwX,EAAM2D,QAAbnb,OAAA4hB,GAAA,EAAA5hB,CAAA,GAAuBX,EAAOsH,QAAUtH,EAAOgC,UAE1D,QACE,OAAOmW,ME3BPnV,GAAMC,aAGNwf,GCPS,WACb,IAAMjC,ENRD,WACL,IACE,IAAMqB,EAAkBG,aAAaU,QAAQf,IAC7C,GAAwB,OAApBE,EAA0B,OAC9B,OAAOC,KAAKa,MAAMd,GAClB,MAAOzF,GACP,QMEmBwG,GACfC,EAAWC,aACfC,aAAgBrjB,GAChB6U,OAAOyO,6BACHzO,OAAOyO,+BACP,SAAAC,GAAC,OAAIA,IAGLR,EAAQS,aAAYpb,GAAS0Y,EAAcqC,GAGjD,OADAJ,EAAMU,UAAU,kBAAMvB,GAAUa,EAAM3iB,cAC/B2iB,EDLKS,GAERpb,GAAU,CACdF,WAAY6a,GAAM3iB,SAClBsjB,YAAa,kBAAMX,GAAM3iB,WAAWzB,UACpCwB,SAAU4iB,GAAM5iB,WAclB,SAA6BiI,GAAS,IAC5BzJ,EAAayJ,EAAQF,aAArBvJ,SACJA,IAEU,gBAAR2E,GACFqC,EAAchH,EAASoE,IAAIM,KAAK,SAAA1E,GAAQ,OACtCyJ,EAAQjI,SAASzB,EAAYC,MAEhB,gBAAR2E,IAAuB8E,EAAQjI,SAASzB,EAAYC,KApBjEglB,CAAoBvb,IAEpB,IAAM3G,GAAQ,IAAImiB,EAXK,yBAYvBniB,GAAMoiB,SAAW,SAAAtkB,GAAM,OAAIoB,QAAQU,IAAI,cAAe9B,IACtDkC,GAAMqiB,aAEN/jB,EAAWgkB,GAAO/jB,QAAQoI,KAG1BrI,EAAWikB,GAAMhkB,QAAQoI,KACzBrI,EAAWgV,GAAQX,QAcnB,IAAM6P,GAAUtU,SAASC,eAAe,OACxCsU,KAAMC,cAAcF,IACpBG,IAAShW,OACP+H,EAAAxF,EAAA0D,cAACgQ,EAAA,EAAD,CAAUtB,MAAOA,IACf5M,EAAAxF,EAAA0D,cAACiQ,GAAD,OAEFL","file":"static/js/main.c88dde1b.chunk.js","sourcesContent":["// Audioset\nexport const SET_AUDIOSET = \"[session] SET_AUDIOSET\";\nexport const setAudioset = audioset => ({\n  type: SET_AUDIOSET,\n  audioset\n});\n\n// Pads\nexport const PRESS_PAD = \"[session] PRESS_PAD\";\nexport const pressPad = clipId => ({ type: PRESS_PAD, clipId });\nexport const RELEASE_PAD = \"[session] RELEASE_PAD\";\nexport const releasePad = clipId => ({ type: RELEASE_PAD, clipId });\n\n// Audio\nexport const SET_AUDIO_CLIP_STATUS = \"[session] SET_AUDIO_CLIP_STATUS\";\nexport const startAudioClip = (clipId, trackId, time) => ({\n  type: SET_AUDIO_CLIP_STATUS,\n  clipId,\n  trackId,\n  status: { isPlaying: true, time }\n});\nexport const stopAudioClip = (clipId, trackId, time) => ({\n  type: SET_AUDIO_CLIP_STATUS,\n  clipId,\n  trackId,\n  status: { isPlaying: false, time }\n});\n\nexport const SET_AUDIO_STATUS = \"[session] SET_AUDIO_STATUS\";\nexport const setAudioStatus = (isPlaying, time) => ({\n  type: SET_AUDIO_STATUS,\n  status: { isPlaying, time }\n});\n\nexport const AUDIO_STOP_ALL = \"[session] AUDIO_STOP_ALL\";\nexport const stopAudio = () => ({\n  type: AUDIO_STOP_ALL\n});\n\n// Tracks\nexport const CHANGE_TRACK_VOLUME = \"[session] CHANGE_TRACK_VOLUME\";\nexport const changeTrackVolume = (trackId, volume) => ({\n  type: CHANGE_TRACK_VOLUME,\n  trackId,\n  volume\n});\n\n// Visuals\n// visuals require the element to be dispatched\n// the view can't talk directly to visuals, because\n// in some scenearios (mobile) visuals are not loaded\nexport const ATTACH_VISUALS = \"ATTACH_VISUALS\";\nexport const attachVisuals = (audioset, el) => ({\n  type: ATTACH_VISUALS,\n  audioset,\n  el\n});\nexport const DETACH_VISUALS = \"DETACH_VISUALS\";\nexport const detachVisuals = () => ({ type: DETACH_VISUALS });\n","/*\n * So, here's the deal: we need to _dinamically_ add (and maybe remove) effects\n * after the store has created (if not, thunk would be enough)\n *\n * The flow is like this:\n *\n * action => effects => store => state\n *\n */\nconst all = [];\n\nexport const addEffects = effects => {\n  if (effects) all.push(effects);\n};\n\n/**\n * The effects redux middleware\n */\nconst effects = ({ dispatch, getState }) => next => action => {\n  // UI is updated first (this may change)\n  next(action);\n  for (let i = 0; i < all.length; i++) {\n    all[i](action, dispatch, getState);\n  }\n};\n\nexport default effects;\n","import io from \"socket.io-client\";\nimport Nanobus from \"nanobus\";\n\nconst NO_SOCKET = {\n  on(type) {\n    console.warn(\"Add listener to no socket\", type);\n  },\n  emit(type, event) {\n    console.warn(\"Emit event to no socket\", type, event);\n  }\n};\n\nclass Client {\n  constructor(url) {\n    this.handleAction = action => console.log(\"unhandled action\", action);\n    this.socket = NO_SOCKET;\n    this.connected = false;\n    this.status = { audiosets: [], rooms: [] };\n    this.events = Nanobus();\n    if (url) this.connect(url);\n  }\n\n  connect(url) {\n    this.socket = io.connect(url);\n    this.socket.on(\"connect\", () => {\n      this.connected = true;\n    });\n    this.socket.on(\"@rooms/room\", data => {\n      this.events.emit(\"room\", data);\n    });\n    this.socket.on(\"@rooms/status\", data => {\n      this.events.emit(\"status\", data);\n    });\n    this.socket.on(\"@rooms/action\", action => {\n      this.handleAction(action);\n    });\n  }\n\n  dispatch(action) {\n    this.handleAction(action);\n    this.socket.emit(\"@rooms/action\", action);\n  }\n\n  onAction(handleAction) {\n    this.handleAction = handleAction;\n  }\n\n  createRoom(audiosetId) {\n    this.socket.emit(\"@rooms/create\", audiosetId);\n  }\n\n  joinRoom(roomId) {\n    this.socket.emit(\"@rooms/join\", roomId);\n  }\n\n  on(event, cb) {\n    this.events.on(event, cb);\n  }\n}\n\nexport default Client;\n","const CACHE = [];\n\nfunction save(key, value) {\n  if (key.startsWith(\"audioset://\")) console.log(\"save\", key, value);\n  CACHE[key] = value;\n  return value;\n}\nfunction get(key) {\n  return CACHE[key];\n}\nfunction has(key) {\n  return CACHE[key] !== undefined;\n}\n\n/**\n * Memoize for audiosets\n * @param {*} key\n * @param {*} create\n */\nexport function memo(audioset, key, create) {\n  const ns = `audioset://${audioset.id}/${key}`;\n  return has(ns) ? get(ns) : save(ns, create());\n}\n\nexport function cachedFetch(url, decode) {\n  if (has(url)) return Promise.resolve(get(url));\n  console.log(\"Fetch\", url);\n  return fetch(url)\n    .then(decode)\n    .then(data => save(url, data));\n}\n","import { cachedFetch, memo } from \"./cache\";\nimport context from \"audio-context\";\n\nconst ENV = process.env.NODE_ENV;\n\nfunction getSources(audioset) {\n  const resources = audioset.resources || {};\n  return Object.assign({}, resources.default, resources[ENV]);\n}\nconst url = source => name => source && source.replace(\"{{filename}}\", name);\nconst resourceUrl = (audioset, type) => url(getSources(audioset)[type] || \"\");\n\nexport default { getCachedResources, loadResources, getResourceUrls };\n\nexport function getResourceUrls(audioset, type) {\n  const names = Object.keys(audioset.clips);\n  const toUrl = resourceUrl(audioset, type);\n  return names.reduce((urls, name) => {\n    urls[name] = toUrl(name);\n    return urls;\n  }, {});\n}\n\nconst identity = x => x;\nconst DECODERS = {\n  audio: decodeAudio\n};\n\nexport function loadResources(audioset, type, clipIds) {\n  clipIds = clipIds || Object.keys(audioset.clips);\n  const toUrl = resourceUrl(audioset, type);\n  const decoder = DECODERS[type] || identity;\n  return clipIds.map(clipId => cachedFetch(toUrl(clipId), decoder));\n}\n\nexport function getCachedResources(audioset, type) {\n  return memo(audioset, type, () => {\n    const cached = {};\n    const clipIds = Object.keys(audioset.clips);\n    Promise.all(\n      loadResources(audioset, type, clipIds).map((promise, i) =>\n        promise.then(resource => {\n          cached[clipIds[i]] = resource;\n          return resource;\n        })\n      )\n    );\n    return cached;\n  });\n}\n\nfunction decodeAudio(response) {\n  const ctx = context();\n  return response.arrayBuffer().then(buffer => ctx.decodeAudioData(buffer));\n}\n","import { memo, cachedFetch } from \"./cache\";\nimport { getResourceUrls } from \"./resources\";\n\nconst BASE_URL = (process.env.PUBLIC_URL || \"\") + \"/audiosets\";\nconst json = response => response.json();\n\nexport function getClipCoverImageUrl(audioset, clipId) {\n  const coverUrls = memo(audioset, \"coverUrls\", () =>\n    getResourceUrls(audioset, \"covers\")\n  );\n  return coverUrls[clipId];\n}\n\nexport function fetchIndex(baseUrl = BASE_URL) {\n  const url = `${baseUrl}/audioset.index.json`;\n  return cachedFetch(url, json);\n}\n\nexport function fetchAudioset(audiosetId, baseUrl = BASE_URL) {\n  const url = `${baseUrl}/${audiosetId}.audioset.json`;\n  return cachedFetch(url, json);\n}\n","import context from \"audio-context\";\n\nconst ctx = context();\n\nexport default ctx;\n","const BEATS = 1;\n\nexport default function nextBeat(now, startedAt, bpm) {\n  return now + nextBeatOffset(now, startedAt, bpm);\n}\n\n/**\n * Calculate the time remaining until the next beat\n *\n * @param {*} now\n * @param {*} startedAt\n * @param {*} bpm\n * @param {*} beats\n */\nexport function nextBeatOffset(now, startedAt, bpm, beats = BEATS) {\n  if (!startedAt) return 0;\n  const factor = bpm / (60 * beats);\n  const absolute = now - startedAt;\n  if (absolute === 0) return 0;\n  const inBeats = absolute * factor;\n  const mod = inBeats % 1;\n  const offsetTime = (1 - mod) / factor;\n  return offsetTime;\n}\n","import ctx from \"./context\";\nimport {\n  stopAudioClip,\n  startAudioClip,\n  setAudioStatus\n} from \"../session/actions\";\nimport nextBeat from \"./nextBeat\";\n\nexport default class Sampler {\n  constructor(audioset, dispatch) {\n    this.bpm = audioset.audio.bpm || 120;\n    this.playing = 0;\n    this.startedAt = null;\n    this.audioset = audioset;\n    this.buffers = {};\n    this.sources = {};\n    this.dispatch = dispatch;\n    this.output = createMasterOutput(0.2);\n  }\n\n  play(clipId, time) {\n    time = time || nextBeat(ctx.currentTime, this.startedAt, this.bpm);\n    const buffer = this.buffers[clipId];\n    if (!buffer) console.warn(\"No buffer\", clipId);\n\n    this.stopTrack(clipId, time);\n    const source = (this.sources[clipId] = ctx.createBufferSource());\n    source.buffer = buffer;\n    source.loop = true;\n    source.connect(this.output);\n    source.start(time);\n    this.started(clipId, time);\n  }\n  stop(clipId, time) {\n    const source = this.sources[clipId];\n    if (!source) return;\n    time = time || ctx.currentTime;\n    source.stop(time);\n    this.sources[clipId] = null;\n    this.stopped(clipId, time);\n  }\n\n  // stops the clips in the same track\n  stopTrack(clipId, time) {\n    const clip = this.audioset.clips[clipId];\n    const track = this.audioset.tracks.find(track => track.id === clip.trackId);\n    track.clipIds.forEach(clipId => this.stop(clipId, time));\n  }\n\n  stopAll() {\n    const now = ctx.currentTime;\n    Object.keys(this.sources).forEach(clipId => this.stop(clipId, now));\n  }\n\n  started(clipId, time) {\n    if (this.playing === 0) {\n      this.startedAt = time;\n      this.dispatch(setAudioStatus(true, time));\n    }\n    this.playing++;\n    const { trackId } = this.audioset.clips[clipId];\n    this.dispatch(startAudioClip(clipId, trackId, ctx.currentTime));\n  }\n\n  stopped(clipId, time) {\n    const { trackId } = this.audioset.clips[clipId];\n    this.dispatch(stopAudioClip(clipId, trackId, ctx.currentTime));\n    this.playing--;\n    if (this.playing === 0) {\n      this.startedAt = null;\n      this.dispatch(setAudioStatus(false, time));\n    }\n  }\n}\n\nfunction createMasterOutput(gain) {\n  const output = ctx.createGain();\n  output.gain.value = gain;\n  output.connect(ctx.destination);\n  return output;\n}\n","import {\n  SET_AUDIOSET,\n  PRESS_PAD,\n  RELEASE_PAD,\n  AUDIO_STOP_ALL,\n  stopAudio\n} from \"../session/actions\";\nimport Resources from \"../audioset/resources\";\nimport Sampler from \"./Sampler\";\nimport { memo } from \"../audioset/cache\";\n\nexport default { effects };\n\nconst samplers = {};\nconst getSampler = (audioset, dispatch) => {\n  const { id } = audioset;\n  if (samplers[id]) return samplers[id];\n  samplers[id] = new Sampler(audioset, dispatch);\n  return samplers[id];\n};\nlet currentSampler = null;\n\nfunction restoreState(session, dispatch) {\n  if (session.audioset) changeSampler(session.audioset, dispatch);\n  // Eventually, we have to do it better\n  dispatch(stopAudio());\n}\n\nexport function effects({ getSession, dispatch, addEffect }) {\n  const session = getSession();\n  restoreState(session, dispatch);\n  return action => {\n    switch (action.type) {\n      case SET_AUDIOSET:\n        return changeSampler(action.audioset, dispatch);\n      case PRESS_PAD:\n        return playSample(action.clipId);\n      case RELEASE_PAD:\n        return stopSample(action.clipId);\n      case AUDIO_STOP_ALL:\n        return currentSampler.stopAll();\n      default:\n    }\n  };\n}\n\nfunction changeSampler(audioset, dispatch) {\n  if (audioset) {\n    currentSampler = getSampler(audioset, dispatch);\n    currentSampler.buffers = Resources.getCachedResources(audioset, \"audio\");\n  } else {\n    currentSampler = null;\n  }\n}\n\nfunction playSample(id, events) {\n  if (!currentSampler) return console.warn(\"NO sampler!\");\n  currentSampler.play(id);\n}\nfunction stopSample(id, events) {\n  if (!currentSampler) return console.warn(\"NO sampler!\");\n  currentSampler.stop(id);\n}\n","import * as d3geo from \"d3-geo-projection\";\n\nconst albumsCount = 8;\nexport const DOT_RADIUS = 2;\n\nexport function getHorizontalPadding(screenWidth) {\n  return screenWidth / 300;\n}\n\nexport function getVerticalPadding(screenWidth) {\n  return screenWidth / 450;\n}\n\nexport function getInfoHeight(screenWidth) {\n  return screenWidth / 50;\n}\n\nexport function getCoverSize(screenWidth) {\n  return screenWidth / albumsCount;\n}\n\nexport function getAlbumHeight(screenWidth) {\n  const verticalPadding = getVerticalPadding(screenWidth);\n  const infoHeight = getInfoHeight(screenWidth);\n  return getCoverSize(screenWidth) + verticalPadding + infoHeight * 2;\n}\n\nexport function getDotOffsetX(screenWidth, trackNumber) {\n  return trackNumber * getCoverSize(screenWidth) + DOT_RADIUS;\n}\n\nexport const RATIOS = {\n  sixteenNinths: 16 / 9,\n  sixteenTenths: 16 / 10\n};\n\nexport function createProjection(width, height, scale, verticalShift, lambda) {\n  return d3geo\n    .geoRobinson()\n    .scale(scale)\n    .translate([width / 2, height / 2 + height / verticalShift])\n    .rotate([lambda, 0, 0]);\n}\n","import * as d3 from \"d3\";\n\n// Number of slices in a circle\nconst circleNumSlices = 36;\n\n// Scale. Get the degrees for a specific slice\nconst degreesFromSlice = d3\n  .scaleLinear()\n  .range([0, 360]) // working in degrees\n  .domain([0, circleNumSlices]);\n\nexport default function drawCircle(parent, screenWidth, cx, cy, params) {\n  const { duration, trackVolume, trackColor } = params;\n  const circlesGroup = parent\n    .append(\"g\")\n    .attr(\"class\", \"circleGroup\")\n    .attr(\"transform\", `translate(${cx}, ${cy})`);\n\n  // We need to group again, so that the circle turns in its location\n  const circle = circlesGroup.append(\"g\").attr(\"class\", \"circle\");\n\n  // Arc generator\n  const arc = d3.arc();\n\n  // Create outerArcs data\n  const outerArcs = createOuterArcs(circleNumSlices, screenWidth, trackVolume);\n\n  // Draw outerArcs\n  circle\n    .selectAll(\".outerArcs\")\n    .data(outerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"outerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return (0.3 / circleNumSlices) * i;\n    });\n\n  // Create innerArcs data\n  const innerArcs = createInnerArcs(circleNumSlices, screenWidth, trackVolume);\n\n  // Draw innerArcs\n  circle\n    .selectAll(\".innerArcs\")\n    .data(innerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"innerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return (1 / circleNumSlices) * i;\n    });\n\n  circle\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", 0)\n    .attr(\"x2\", 0)\n    .attr(\"y2\", -((screenWidth / 30) * trackVolume + screenWidth / 350))\n    .style(\"stroke\", trackColor)\n    .style(\"stroke-width\", 1.5);\n\n  // Add animation to make the circle turn\n  const turnTimer = d3.timer(turn);\n  function turn(elapsed) {\n    const elapsedSeconds = (elapsed / 1000) % duration;\n    const turnScale = d3\n      .scaleLinear()\n      .range([1, 0])\n      .domain([0, duration]);\n    circle.style(\"transform\", `rotate(${-turnScale(elapsedSeconds)}turn)`);\n    if (d3.select(\".circle\").empty()) {\n      turnTimer.stop();\n    }\n  }\n\n  return circlesGroup;\n}\n\nfunction createInnerArcs(circleNumSlices, screenWidth, trackVolume) {\n  return d3.range(circleNumSlices).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle:\n        i === circleNumSlices - 1\n          ? deg2rad(degreesFromSlice(d + 1))\n          : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: (screenWidth / 30) * trackVolume\n    };\n  });\n}\n\nfunction createOuterArcs(circleNumSlices, screenWidth, trackVolume) {\n  return d3.range(circleNumSlices).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle:\n        i === circleNumSlices - 1\n          ? deg2rad(degreesFromSlice(d + 1))\n          : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: (screenWidth / 30) * trackVolume * 2\n    };\n  });\n}\n\n// Transform degrees into radians\nfunction deg2rad(degrees) {\n  return degrees * (Math.PI / 180);\n}\n","import { getClipCoverImageUrl } from \"../audioset\";\n\n/**\n * Get URL of a resource, given it's name and source\n * @param {*} name\n * @param {*} source\n */\nexport function resourceUrl(name, source) {\n  if (!source || !source.length) return name;\n  const url = source[source.length - 1].replace(\"{{filename}}\", name);\n  return url;\n}\n\nexport default function getAlbumInfo(audioset, name) {\n  const clip = audioset.clips[name];\n  if (!clip) return;\n\n  const imageUrl = getClipCoverImageUrl(audioset, clip.name);\n  const bpm = audioset.meta.bpm || 120;\n\n  return {\n    lnglat: clip.lnglat,\n    year: clip.year,\n    country: clip.country,\n    title: clip.title,\n    artist: clip.artist,\n    album: clip.album,\n    trackNumber: clip.trackNum,\n    loopend: 1,\n    trackVolume: clip.audio.trackVolume || 0.7,\n    duration: (60 * clip.audio.beats) / bpm, // clip duration in seconds\n    imageUrl,\n    trackColor: clip.display.color\n  };\n}\n","import * as d3 from \"d3\";\nimport * as topojson from \"topojson\";\n\nimport { RATIOS, createProjection, getAlbumHeight } from \"./dimensions\";\n\nimport drawCircle from \"./drawCircle\";\nimport drawAlbum from \"./drawAlbum\";\nimport drawRefLine from \"./drawRefLine\";\nimport drawWave from \"./drawWave\";\nimport { createLastSampleInfo } from \"./lastSampleInfo\";\nimport { createImprint } from \"./imprint\";\nimport getAlbumInfo from \"./getAlbumInfo\";\n\nconst CONFIG = {\n  geoMapUrl: \"https://unpkg.com/world-atlas@1.1.4/world/110m.json\",\n  imprint: false,\n  focus: {\n    lambda: -10,\n    verticalShift: 15,\n    scaleFactor: 1\n  }\n};\n\nconst remove = (name, group) => {\n  const value = group[name];\n  if (value) {\n    value.remove();\n    group[name] = null;\n  }\n};\n\n/**\n * It stores the state required to render visualizations\n */\nexport default class Display {\n  constructor(set, display) {\n    this.config = Object.assign({}, CONFIG, set.visuals);\n    this.set = set;\n    this.display = display;\n    this.circles = {};\n    this.albums = {};\n    this.refLines = {};\n    this.infos = {};\n    this.fixedAspectRatio = RATIOS.sixteenTenths;\n    this.render = this.render.bind(this);\n  }\n\n  setGeodata(geodata) {\n    this.geodata = geodata;\n    this.countries = topojson.feature(\n      geodata,\n      geodata.objects.countries\n    ).features;\n    this.render();\n  }\n\n  show(name) {\n    const info = getAlbumInfo(this.set, name);\n    if (!info) return;\n\n    const { width, height } = this.display.dimensions;\n    let [cx, cy] = this.projection(info.lnglat);\n\n    const circle = drawCircle(this.circlesContainer, width, cx, cy, info);\n    this.circles[name] = circle;\n\n    const album = drawAlbum(this.albumsContainer, width, info);\n    this.albums[name] = album;\n\n    const refLine = drawRefLine(\n      this.refLinesContainer,\n      width,\n      cx,\n      cy,\n      info.trackNumber,\n      info.trackColor\n    );\n    this.refLines[name] = refLine;\n\n    drawWave(\n      this.wavesContainer,\n      width,\n      cx,\n      cy,\n      info.trackColor,\n      info.trackVolume\n    );\n\n    const lastSampleInfo = createLastSampleInfo(\n      this.lastSampleInfoContainer,\n      width,\n      height,\n      info\n    );\n    this.infos[name] = lastSampleInfo;\n\n    if (this.config.imprint) createImprint(info.lnglat, info.trackColor);\n  }\n\n  hide(name) {\n    remove(name, this.circles);\n    remove(name, this.albums);\n    remove(name, this.refLines);\n    remove(name, this.infos);\n  }\n\n  render() {\n    this.display.clear();\n    const { width, height, scale } = this.display.dimensions;\n    const focusedScale = scale * this.config.focus.scaleFactor;\n    const lambda = this.config.focus.lambda;\n    const verticalShift = this.config.focus.verticalShift;\n    const albumsHeight = getAlbumHeight(width);\n\n    const svg = this.display.svg;\n\n    this.mapContainer = svg\n      .append(\"g\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`)\n      .append(\"g\")\n      .attr(\"id\", \"map\");\n\n    this.albumsContainer = svg.append(\"g\").attr(\"id\", \"albums\");\n    this.refLinesContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"refLines\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n    this.circlesContainer = svg\n      .append(\"g\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`)\n      .append(\"g\")\n      .attr(\"id\", \"circles\");\n    this.wavesContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"waves\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n    this.lastSampleInfoContainer = svg\n      .append(\"g\")\n      .attr(\"id\", \"lastSampleInfo\")\n      .attr(\"transform\", `translate(0, ${albumsHeight})`);\n\n    // Draw map\n    if (this.geodata) {\n      this.projection = createProjection(\n        width,\n        height - albumsHeight,\n        focusedScale,\n        verticalShift,\n        lambda\n      );\n      const path = d3.geoPath().projection(this.projection);\n      this.mapContainer\n        .selectAll(\".countries\")\n        .data(this.countries)\n        .enter()\n        .append(\"path\")\n        .attr(\"id\", d => `country${d.id}`)\n        .attr(\"class\", \"countries\")\n        .attr(\"d\", path)\n        .style(\"stroke\", \"#2c2c2c\")\n        .style(\"stroke-width\", 0.5)\n        .style(\"fill\", d => (d.id === \"010\" ? \"none\" : \"#888888\")); // 010 Antartica\n    }\n  }\n}\n","import {\n  getCoverSize,\n  getHorizontalPadding,\n  getVerticalPadding,\n  getInfoHeight,\n  getDotOffsetX,\n  DOT_RADIUS\n} from \"./dimensions\";\n\nexport default function drawAlbum(el, width, params) {\n  const { trackNumber, imageUrl, year, country, trackColor } = params;\n  const album = el.append(\"g\");\n  const coverSize = getCoverSize(width);\n  const horizontalPadding = getHorizontalPadding(width);\n  const verticalPadding = getVerticalPadding(width);\n  const dotOffsetX = getDotOffsetX(width, trackNumber);\n  const infoHeight = getInfoHeight(width);\n  const fontSize = \"1.1vw\";\n\n  album\n    .append(\"svg:image\")\n    .attr(\"width\", coverSize)\n    .attr(\"height\", coverSize)\n    .attr(\"x\", trackNumber * coverSize)\n    .attr(\"y\", 0)\n    .style(\"stroke\", \"white\")\n    .attr(\"xlink:href\", imageUrl);\n\n  // Draw country rectangle\n  album\n    .append(\"rect\")\n    .attr(\"width\", coverSize)\n    .attr(\"height\", infoHeight)\n    .attr(\"x\", trackNumber * coverSize)\n    .attr(\"y\", coverSize + verticalPadding)\n    .style(\"fill\", trackColor);\n\n  // Draw country text\n  const countryText = album\n    .append(\"text\")\n    .attr(\"id\", \"countryText\" + trackNumber)\n    .attr(\"x\", trackNumber * coverSize + horizontalPadding)\n    .attr(\"y\", coverSize + verticalPadding + infoHeight / 2)\n    .attr(\"dy\", \"0.35em\")\n    .style(\"font-size\", fontSize)\n    .text(country);\n\n  // Trucate text larger than coverSize\n  const countryTextId = \"countryText\" + trackNumber;\n  function wrap(textElement, textId) {\n    let textLength = document.getElementById(textId).getBBox().width;\n    let text = textElement.text();\n\n    while (textLength > coverSize - horizontalPadding * 2 && text.length > 0) {\n      text = text.slice(0, -1);\n      textElement.text(text + \"...\");\n      textLength = document.getElementById(textId).getBBox().width;\n    }\n  }\n  wrap(countryText, countryTextId);\n\n  // Draw date point\n  album\n    .append(\"circle\")\n    .attr(\"cx\", dotOffsetX)\n    .attr(\"cy\", coverSize + verticalPadding + infoHeight * 2)\n    .attr(\"r\", DOT_RADIUS)\n    .style(\"fill\", trackColor);\n\n  // Draw date text\n  album\n    .append(\"text\")\n    .attr(\"x\", trackNumber * coverSize + horizontalPadding)\n    .attr(\"y\", coverSize + verticalPadding + infoHeight * 1.5)\n    .attr(\"dy\", \"0.35em\")\n    .style(\"font-size\", fontSize)\n    .style(\"fill\", trackColor)\n    .text(year);\n\n  return album;\n}\n","import * as d3 from \"d3\";\nimport { getDotOffsetX } from \"./dimensions\";\n\nexport default function createRefLine(\n  parent,\n  windowWidth,\n  cx,\n  cy,\n  trackNumber,\n  trackColor\n) {\n  const x1 = getDotOffsetX(windowWidth, trackNumber);\n  const y1 = 0;\n  const x2 = cx;\n  const y2 = cy;\n  const h = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n  const a = h / 10;\n  const alfa = Math.acos((y2 - y1) / h);\n  const curveCoords = [\n    {\n      x: x1,\n      y: y1\n    },\n    {\n      x: x1 + (x2 - x1) / 2 + a * Math.cos(Math.PI - alfa),\n      y: y1 + (y2 - y1) / 2 + a * Math.sin(Math.PI - alfa)\n    },\n    { x: x2, y: y2 }\n  ];\n\n  const line = d3\n    .line()\n    .x(d => d.x)\n    .y(d => d.y)\n    .curve(d3.curveBasis);\n\n  const refLine = parent\n    .append(\"path\")\n    .datum(curveCoords)\n    .attr(\"d\", line)\n    .style(\"stroke\", trackColor)\n    .style(\"stroke-dasharray\", \"2, 3\")\n    .style(\"fill\", \"none\")\n    .style(\"stroke-width\", 2);\n\n  return refLine;\n}\n","import * as d3 from \"d3\";\n\nexport default function createWave(\n  parent,\n  screenWidth,\n  cx,\n  cy,\n  trackColor,\n  trackVolume\n) {\n  const firstRadius = Math.floor((screenWidth / 30) * trackVolume);\n  const lastRadius = 150;\n  const radius = d3.range(firstRadius, lastRadius);\n  const duration = 20;\n\n  const wave = parent\n    .append(\"circle\")\n    .attr(\"cx\", cx)\n    .attr(\"cy\", cy)\n    .attr(\"r\", 0)\n    .style(\"fill\", \"none\")\n    .style(\"stroke\", trackColor);\n\n  radius.forEach((r, i) => {\n    const initialWidth = 2;\n    const strokeWidth = initialWidth - (initialWidth * r) / lastRadius;\n    wave\n      .transition()\n      .duration(duration)\n      .delay(i * duration)\n      .attr(\"r\", r)\n      .style(\"stroke-width\", strokeWidth)\n      .on(\"end\", (d, i, nodes) => {\n        if (r === lastRadius - 1) nodes[i].remove();\n      });\n  });\n\n  return wave;\n}\n","import * as d3 from \"d3\";\nimport * as chroma from \"chroma-js\";\n\nexport function createImprint(point, color) {\n  d3.selectAll(\".countries\").each(polygon => {\n    const inside = d3.geoContains(polygon, point);\n    if (inside) {\n      const base = d3.select(`#country${polygon.id}`).style(\"fill\");\n      d3.select(`#country${polygon.id}`)\n        // .style(\"fill\", chroma.blend(base, color, \"lighten\").hex()); // applies trackColor\n        .style(\"fill\", chroma(base).brighten(0.2)); // gray to white. Step: 0.2\n    }\n  });\n}\n","import { getAlbumHeight } from \"./dimensions\";\n\nexport function createLastSampleInfo(\n  parent,\n  screenWidth,\n  screenHeight,\n  { title, artist, album, trackColor }\n) {\n  // Clear\n  parent.select(\"#lastSampleInfoGroup\").remove();\n  const lastSampleInfo = parent.append(\"g\").attr(\"id\", \"lastSampleInfoGroup\");\n  const rectSize = screenWidth / 20;\n  const albumsHeight = getAlbumHeight(screenWidth);\n  const horizontalPadding = screenWidth / 190;\n  const verticalPadding = rectSize / 3;\n  const x = screenWidth - rectSize;\n  const y = screenHeight - albumsHeight - rectSize;\n  const dy = \"-0.35em\";\n  const fontSize = \"1.1vw\";\n\n  lastSampleInfo\n    .append(\"rect\")\n    .attr(\"width\", rectSize)\n    .attr(\"height\", rectSize)\n    .attr(\"x\", x)\n    .attr(\"y\", y)\n    .style(\"fill\", trackColor);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 1)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"title\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 1)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(title);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 2)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"artist\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 2)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(artist);\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x + horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 3)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .text(\"album\");\n\n  lastSampleInfo\n    .append(\"text\")\n    .attr(\"x\", x - horizontalPadding)\n    .attr(\"y\", y + verticalPadding * 3)\n    .attr(\"dy\", dy)\n    .attr(\"font-size\", fontSize)\n    .style(\"text-anchor\", \"end\")\n    .style(\"fill\", \"#e6e6e6\")\n    .text(album);\n\n  return lastSampleInfo;\n}\n","import { select } from \"d3\";\n\nexport const RATIOS = {\n  sixteenNinths: 16 / 9,\n  sixteenTenths: 16 / 10\n};\nconst RATIO = RATIOS.sixteenTenths;\n\n/**\n * A display encapsulates drawing mechanics\n *\n * @param {*} el\n */\n\nexport default class Display {\n  constructor(el) {\n    this.el = el;\n    this.clear();\n  }\n\n  setVisible(isVisible) {\n    this.el.style.display = isVisible ? \"block\" : \"none\";\n  }\n\n  clear() {\n    const d3 = select(this.el);\n    d3.selectAll(\"*\").remove();\n\n    this.dimensions = calculateDimensions(this.el);\n    this.svg = d3\n      .append(\"svg\")\n      .attr(\"width\", this.dimensions.width)\n      .attr(\"height\", this.dimensions.height);\n    return this.svg;\n  }\n}\n\nfunction calculateDimensions(el) {\n  const w = el.offsetWidth;\n  const h = el.offsetHeight;\n  const realAspectRatio = w / h;\n\n  const width = realAspectRatio < RATIO ? w : h * RATIO;\n  const height = realAspectRatio < RATIO ? w / RATIO : h;\n  const scale = RATIO === RATIOS.sixteenTenths ? width / 5.9 : width / 6.5;\n  return { width, height, scale };\n}\n\nexport function getWindowSize(ratio) {\n  return getFixedSize(window.innerWidth, window.innerHeight, ratio);\n}\n\nfunction getFixedSize(width, height, ratio) {\n  const realAspectRatio = width / height;\n\n  const screenWidth = realAspectRatio < ratio ? width : height * ratio;\n  const screenHeight = realAspectRatio < ratio ? width / ratio : height;\n\n  return { screenWidth, screenHeight };\n}\n","import { throttle } from \"lodash\";\nimport Visuals from \"./visuals\";\nimport Display from \"./display\";\nimport {\n  SET_AUDIOSET,\n  SET_AUDIO_CLIP_STATUS,\n  ATTACH_VISUALS,\n  DETACH_VISUALS\n} from \"../session/actions\";\nimport Resources from \"../audioset/resources\";\n\nexport default { init };\n\nexport function init(el) {\n  if (!el) el = createElement();\n  const display = new Display(el);\n  display.setVisible(false);\n  let current;\n  const resize = throttle(() => {\n    if (current) current.render();\n  }, 1000);\n  window.addEventListener(\"resize\", resize);\n\n  return function effects(action) {\n    switch (action.type) {\n      case SET_AUDIOSET:\n        if (action.audioset) current = createVisuals(action.audioset, display);\n        else current = removeVisuals(current, display);\n        break;\n\n      // case ATTACH_VISUALS:\n      //   const { audioset } = action;\n      //   current = createVisuals(audioset, new Display(action.el));\n      //   Resources.loadResources(audioset, \"covers\");\n      //   window.addEventListener(\"resize\", current.render);\n      //   break;\n\n      // case DETACH_VISUALS:\n      //   window.removeEventListener(\"resize\", current.render);\n      //   current = null;\n      //   break;\n\n      case SET_AUDIO_CLIP_STATUS:\n        const { clipId, status } = action;\n        if (status.isPlaying) current.show(clipId);\n        else current.hide(clipId);\n        break;\n\n      default:\n        break;\n    }\n  };\n}\n\nfunction createElement() {\n  const el = document.createElement(\"div\");\n  el.setAttribute(\"class\", \"visuals\");\n  document.body.appendChild(el);\n  return el;\n}\n\nfunction removeVisuals(visuals, display) {\n  display.setVisible(false);\n  return null;\n}\n\nfunction createVisuals(audioset, display) {\n  display.setVisible(true);\n  const visuals = new Visuals(audioset, display);\n  visuals.render();\n  fetch(audioset.visuals.geoMapUrl)\n    .then(response => response.json())\n    .then(data => visuals.setGeodata(data));\n\n  return visuals;\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\n\n// http://svgicons.sparkk.fr/\nconst ICONS = {\n  stop: \"M6 6h12v12H6z\",\n  fly:\n    \"M17.218,2.268L2.477,8.388C2.13,8.535,2.164,9.05,2.542,9.134L9.33,10.67l1.535,6.787c0.083,0.377,0.602,0.415,0.745,0.065l6.123-14.74C17.866,2.46,17.539,2.134,17.218,2.268 M3.92,8.641l11.772-4.89L9.535,9.909L3.92,8.641z M11.358,16.078l-1.268-5.613l6.157-6.157L11.358,16.078z\",\n  mute:\n    \"M18.084,11.639c0.168,0.169,0.168,0.442,0,0.611c-0.084,0.084-0.195,0.127-0.306,0.127c-0.111,0-0.221-0.043-0.306-0.127l-1.639-1.639l-1.639,1.639c-0.084,0.084-0.195,0.127-0.306,0.127c-0.111,0-0.222-0.043-0.307-0.127c-0.168-0.169-0.168-0.442,0-0.611L15.223,10l-1.64-1.639c-0.168-0.168-0.168-0.442,0-0.61c0.17-0.169,0.442-0.169,0.612,0l1.639,1.639l1.639-1.639c0.169-0.169,0.442-0.169,0.611,0c0.168,0.168,0.168,0.442,0,0.61L16.445,10L18.084,11.639z M12.161,2.654v14.691c0,0.175-0.105,0.333-0.267,0.4c-0.054,0.021-0.109,0.032-0.166,0.032c-0.111,0-0.223-0.043-0.305-0.127l-3.979-3.979H2.222c-0.237,0-0.432-0.194-0.432-0.432V6.759c0-0.237,0.195-0.432,0.432-0.432h5.222l3.979-3.978c0.123-0.125,0.309-0.163,0.471-0.095C12.056,2.322,12.161,2.479,12.161,2.654 M7.192,7.192H2.654v5.617h4.538V7.192z M11.296,3.698l-3.24,3.241v6.123l3.24,3.24V3.698z\",\n  cinema:\n    \"M18.175,4.142H1.951C1.703,4.142,1.5,4.344,1.5,4.592v10.816c0,0.247,0.203,0.45,0.451,0.45h16.224c0.247,0,0.45-0.203,0.45-0.45V4.592C18.625,4.344,18.422,4.142,18.175,4.142 M4.655,14.957H2.401v-1.803h2.253V14.957zM4.655,12.254H2.401v-1.803h2.253V12.254z M4.655,9.549H2.401V7.747h2.253V9.549z M4.655,6.846H2.401V5.043h2.253V6.846zM14.569,14.957H5.556V5.043h9.013V14.957z M17.724,14.957h-2.253v-1.803h2.253V14.957z M17.724,12.254h-2.253v-1.803h2.253V12.254zM17.724,9.549h-2.253V7.747h2.253V9.549z M17.724,6.846h-2.253V5.043h2.253V6.846z\",\n  controls:\n    \"M6.176,7.241V6.78c0-0.221-0.181-0.402-0.402-0.402c-0.221,0-0.403,0.181-0.403,0.402v0.461C4.79,7.416,4.365,7.955,4.365,8.591c0,0.636,0.424,1.175,1.006,1.35v3.278c0,0.222,0.182,0.402,0.403,0.402c0.222,0,0.402-0.181,0.402-0.402V9.941c0.582-0.175,1.006-0.714,1.006-1.35C7.183,7.955,6.758,7.416,6.176,7.241 M5.774,9.195c-0.332,0-0.604-0.272-0.604-0.604c0-0.332,0.272-0.604,0.604-0.604c0.332,0,0.604,0.272,0.604,0.604C6.377,8.923,6.105,9.195,5.774,9.195 M10.402,10.058V6.78c0-0.221-0.181-0.402-0.402-0.402c-0.222,0-0.402,0.181-0.402,0.402v3.278c-0.582,0.175-1.006,0.714-1.006,1.35c0,0.637,0.424,1.175,1.006,1.351v0.461c0,0.222,0.181,0.402,0.402,0.402c0.221,0,0.402-0.181,0.402-0.402v-0.461c0.582-0.176,1.006-0.714,1.006-1.351C11.408,10.772,10.984,10.233,10.402,10.058M10,12.013c-0.333,0-0.604-0.272-0.604-0.604S9.667,10.805,10,10.805c0.332,0,0.604,0.271,0.604,0.604S10.332,12.013,10,12.013M14.629,8.448V6.78c0-0.221-0.182-0.402-0.403-0.402c-0.221,0-0.402,0.181-0.402,0.402v1.668c-0.581,0.175-1.006,0.714-1.006,1.35c0,0.636,0.425,1.176,1.006,1.351v2.07c0,0.222,0.182,0.402,0.402,0.402c0.222,0,0.403-0.181,0.403-0.402v-2.07c0.581-0.175,1.006-0.715,1.006-1.351C15.635,9.163,15.21,8.624,14.629,8.448 M14.226,10.402c-0.331,0-0.604-0.272-0.604-0.604c0-0.332,0.272-0.604,0.604-0.604c0.332,0,0.604,0.272,0.604,0.604C14.83,10.13,14.558,10.402,14.226,10.402 M17.647,3.962H2.353c-0.221,0-0.402,0.181-0.402,0.402v11.27c0,0.222,0.181,0.402,0.402,0.402h15.295c0.222,0,0.402-0.181,0.402-0.402V4.365C18.05,4.144,17.869,3.962,17.647,3.962 M17.245,15.232H2.755V4.768h14.49V15.232z\",\n  stop2:\n    \"M10 0c-5.523 0-10 4.477-10 10s4.477 10 10 10 10-4.477 10-10-4.477-10-10-10zM10 18.125c-4.487 0-8.125-3.638-8.125-8.125s3.638-8.125 8.125-8.125 8.125 3.638 8.125 8.125-3.638 8.125-8.125 8.125zM6.25 6.25h7.5v7.5h-7.5z\",\n  fullscreen:\n    \"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z\",\n  keyboard:\n    \"M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z\",\n  volumeUp:\n    \"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z\",\n  volumeDown:\n    \"M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z\",\n  volumeOff:\n    \"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z\"\n};\n\nconst Icon = ({ icon, color, onClick }) => (\n  <svg\n    fill={color || \"#CCC\"}\n    onClick={onClick}\n    height=\"20\"\n    viewBox=\"0 0 20 20\"\n    width=\"20\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path d={ICONS[icon] || icon} />\n  </svg>\n);\n\nIcon.propTypes = {\n  icon: PropTypes.string,\n  color: PropTypes.string,\n  onClick: PropTypes.func\n};\n\nexport default Icon;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport cxs from \"cxs/component\";\nexport { default as Icon } from \"./Icon\";\n\nexport const Json = ({ obj }) => <pre>{JSON.stringify(obj)}</pre>;\nJson.propTypes = {\n  obj: PropTypes.object\n};\n\nexport const Button = cxs(\"button\")({\n  color: \"black\",\n  display: \"block\",\n  background: \"white\",\n  font: \"inherit\",\n  padding: \"0 1em\",\n  \":hover\": {\n    textDecoration: \"underline\"\n  }\n});\n\nexport const Link = cxs(\"button\")({\n  color: \"white\",\n  display: \"block\",\n  background: \"none\",\n  font: \"inherit\",\n  border: 0\n});\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport { Icon, Link } from \"../shared\";\n\nconst Toolbar = ({\n  className,\n  audioset,\n  audio,\n  onCloseAudioset,\n  onStopAll,\n  onHelp,\n  onToggleTracks,\n  onTogglePads,\n  onFullscreen\n}) => (\n  <header className={className}>\n    <div>\n      <Icon icon=\"fly\" onClick={onHelp} />\n    </div>\n    <Connection id=\"Connection\" onClick={onCloseAudioset}>\n      {audioset.meta.title}: {audioset.meta.description}\n    </Connection>\n    <Transport id=\"Transport\">\n      {audio.isPlaying ? <Icon icon=\"stop\" onClick={onStopAll} /> : \"\"}\n      <Icon icon=\"mute\" />\n    </Transport>\n    <Icon icon=\"controls\" onClick={onTogglePads} />\n    <Icon icon=\"controls\" onClick={onToggleTracks} />\n    <Icon icon=\"cinema\" onClick={onFullscreen} />\n  </header>\n);\nToolbar.propTypes = {\n  audioset: PropTypes.object\n};\n\nconst Transport = cxs(\"div\")({});\nconst Connection = cxs(\"div\")({\n  marginTop: \"3px\",\n  flexGrow: 1,\n  textAlign: \"center\"\n});\n\nexport default cxs(Toolbar)({\n  display: \"flex\",\n  flexDirection: \"row\",\n  backgroundColor: \"black\",\n  padding: \"2px 10px\"\n});\n","import React from \"react\";\nimport cxs from \"cxs\";\nimport PropTypes from \"prop-types\";\nimport { Link, Button } from \"../shared\";\n\nconst className = cxs({\n  margin: \"0 auto\",\n  lineHeight: \"2em\",\n  fontSize: \"14px\",\n  backgroundColor: \"black\",\n  \"& h1, & h2\": {\n    fontWeight: 400,\n    margin: \"1em 0\"\n  }\n});\n\nconst Welcome = ({\n  audioset,\n  audiosetIndex,\n  onChangeAudioset,\n  onCloseAudioset\n}) => (\n  <div className={className}>\n    {audiosetIndex && !audioset && (\n      <>\n        <h2>Empieza una nueva remezcla</h2>\n        {audiosetIndex.map(set => (\n          <Link key={set.id} onClick={() => onChangeAudioset(set)}>\n            {set.meta.title}: {set.meta.description}\n          </Link>\n        ))}\n      </>\n    )}\n\n    {audioset && (\n      <>\n        <h1>{audioset.meta.title}</h1>\n        <p>{audioset.meta.description}</p>\n        <Button onClick={onCloseAudioset}>Cerrar audioset</Button>\n      </>\n    )}\n  </div>\n);\nWelcome.propTypes = {\n  onChangeAudioset: PropTypes.func\n};\n\nexport default Welcome;\n","import React, { useState, useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport Welcome from \"./Welcome\";\nimport { fetchIndex, fetchAudioset } from \"../../audioset\";\nimport { setAudioset } from \"../../session/actions\";\n\nconst WelcomeState = ({ audioset, onClose, onChangeAudioset }) => {\n  const [isLoading, setIsLoading] = useState(true);\n  const [index, setIndex] = useState(null);\n  useEffect(\n    () => {\n      let mounted = true;\n      fetchIndex().then(index => mounted && setIndex(index));\n      return () => (mounted = false);\n    },\n    [audioset]\n  );\n\n  const changeAudioset = audioset => {\n    setIsLoading(true);\n    fetchAudioset(audioset.id)\n      .then(onChangeAudioset)\n      .then(onClose);\n  };\n\n  const closeAudioset = () => onChangeAudioset(null);\n\n  return (\n    <Welcome\n      audioset={audioset}\n      audiosetIndex={index}\n      onChangeAudioset={changeAudioset}\n      onCloseAudioset={closeAudioset}\n    />\n  );\n};\n\nconst mapStateToProps = state => state;\nconst mapDispatchToProps = dispatch => ({\n  onChangeAudioset: audioset => dispatch(setAudioset(audioset))\n});\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(WelcomeState);\n","import React, { useRef, useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport cxs from \"cxs\";\n\nconst Visuals = ({ audioset, onStart, onStop }) => {\n  const el = useRef(null);\n  useEffect(\n    () => {\n      if (!audioset) return;\n      onStart(audioset, el.current);\n      return () => onStop();\n    },\n    [el.current]\n  );\n  return <div className={className} ref={el} />;\n};\n\nVisuals.propTypes = {\n  audioset: PropTypes.object,\n  events: PropTypes.object\n};\n\nconst className = cxs({\n  backgroundColor: \"gray\",\n  height: \"100%\"\n});\n\nexport default Visuals;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"./Pad.css\";\n\nclass Pad extends React.Component {\n  constructor(props) {\n    super(props);\n    this.touched = false;\n  }\n\n  handlePress(isTouch) {\n    // prevent double click on mobile (https://github.com/facebook/react/issues/9809)\n    if (isTouch) {\n      this.touched = true;\n    } else if (this.touched === true) {\n      this.touched = false;\n      return;\n    }\n    const pressed = !this.props.pressed;\n    this.props[pressed ? \"onPress\" : \"onRelease\"](this.props.name);\n  }\n\n  render() {\n    const { color, pressed, touch, image, name } = this.props;\n    return (\n      <button\n        className={`Pad ${pressed ? \"pressed\" : \"\"}`}\n        style={{\n          borderColor: color\n        }}\n        onTouchStart={touch ? () => this.handlePress(true) : undefined}\n        onMouseDown={() => this.handlePress(false)}\n      >\n        {image ? <img src={image} alt={name} /> : \"\"}\n      </button>\n    );\n  }\n}\n\nPad.propTypes = {\n  name: PropTypes.string,\n  color: PropTypes.string,\n  prtessed: PropTypes.bool,\n  touch: PropTypes.bool,\n  image: PropTypes.string\n};\n\nexport const EmptyPad = ({ name }) => (\n  <button className=\"Pad\" style={{ borderColor: \"transparent\" }}>\n    {name}\n  </button>\n);\n\nexport default Pad;\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport Pad from \"./Pad\";\n\nconst TrackPads = ({ track, status, onPadPressed, onPadReleased }) => (\n  <div>\n    {track.clipIds.map(name => (\n      <Pad\n        key={name}\n        name={name}\n        pressed={status[name] && status[name].isPlaying}\n        color={track.color}\n        onPress={onPadPressed}\n        onRelease={onPadReleased}\n      />\n    ))}\n  </div>\n);\n\nconst Pads = ({ audioset, status, className, onPadPressed, onPadReleased }) => {\n  return (\n    <div className={className}>\n      {audioset.tracks.map(track => (\n        <TrackPads\n          key={track.name}\n          track={track}\n          status={status}\n          onPadPressed={onPadPressed}\n          onPadReleased={onPadReleased}\n        />\n      ))}\n    </div>\n  );\n};\nPads.propTypes = {\n  onPadPressed: PropTypes.func\n};\nexport default cxs(Pads)({\n  backgroundColor: \"black\",\n  padding: \"0 0.5em 0 1em\",\n  minHeight: \"100%\"\n});\n","import { connect } from \"react-redux\";\nimport Pads from \"./Pads\";\nimport { pressPad, releasePad } from \"../../session/actions\";\n\nconst mapStateToProps = session => ({\n  audioset: session.audioset,\n  status: session.audio.status\n});\n\nconst mapDispatchToProps = dispatch => ({\n  onPadPressed: pad => dispatch(pressPad(pad)),\n  onPadReleased: pad => dispatch(releasePad(pad))\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Pads);\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\n\nconst Base = ({ onPress, onRelease, className, children }) => (\n  <button className={className} onMouseDown={onPress} onMouseUp={onRelease}>\n    {children}\n  </button>\n);\nBase.propTypes = {\n  pressed: PropTypes.bool,\n  onPress: PropTypes.func,\n  onRelease: PropTypes.func\n};\n\nconst Trigger = cxs(Base)(props => ({\n  border: `2px solid ${props.color}`,\n  color: props.color,\n  backgroundColor: props.pressed ? props.color : \"black\",\n  marginRight: \"0.5em\",\n  padding: \"1px 3px\",\n  \"&:hover\": {\n    backgroundColor: props.color,\n    color: \"black\"\n  }\n}));\n\nTrigger.propTypes = {\n  color: PropTypes.string\n};\n\nexport default Trigger;\n","import React from \"react\";\nimport cxs from \"cxs\";\nimport component from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport Trigger from \"../shared/Trigger\";\n\nconst Track = component(\"div\")(props => ({\n  color: props.color,\n  borderTop: `2px solid ${props.active ? props.color : \"black\"}`,\n  \"> h2\": {\n    marginTop: \"5px\"\n  },\n  marginBottom: \"1em\"\n}));\n\nconst className = cxs({ padding: \"1em\", backgroundColor: \"black\" });\n\nconst Tracks = ({\n  audioset,\n  volumes,\n  playing,\n  status,\n  onVolumeChanged,\n  onPress,\n  onRelease\n}) => (\n  <div className={className}>\n    <h2>Tracks</h2>\n    {audioset.tracks.map(track => (\n      <Track key={track.id} active={playing[track.id]} color={track.color}>\n        <h2>{track.id}</h2>\n        <div>\n          {track.clipIds.map(clipId => (\n            <Trigger\n              key={clipId}\n              pressed={status[clipId] && status[clipId].isPlaying}\n              onPress={() => onPress(clipId)}\n              onRelease={() => onRelease(clipId)}\n              color={audioset.clips[clipId].display.color}\n            >\n              {clipId}\n            </Trigger>\n          ))}\n        </div>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          value={volumes[track.id]}\n          onChange={e => onVolumeChanged(track.id, e.target.value)}\n        />\n      </Track>\n    ))}\n  </div>\n);\n\nTracks.propTypes = {\n  audio: PropTypes.object\n};\n\nexport default Tracks;\n","import { connect } from \"react-redux\";\nimport Tracks from \"./Tracks\";\nimport { changeTrackVolume, pressPad, releasePad } from \"../../session/actions\";\n\nconst mapStateToProps = session => ({\n  audioset: session.audioset,\n  status: session.audio.status,\n  volumes: session.tracks.volumes,\n  playing: session.tracks.playing\n});\n\nconst mapDispatchToProps = dispatch => ({\n  onVolumeChanged: (track, value) => dispatch(changeTrackVolume(track, value)),\n  onPress: pad => dispatch(pressPad(pad)),\n  onRelease: pad => dispatch(releasePad(pad))\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Tracks);\n","import { memo } from \"./cache\";\nimport { pressPad, releasePad } from \"../session/actions\";\n\nexport function effects({ getSession, dispatch }) {\n  const pressed = {};\n\n  window.onkeydown = function(e) {\n    const key = e.key;\n    if (pressed[key]) return;\n\n    pressed[key] = true;\n    const audioset = getSession().audioset;\n    if (!audioset) return;\n\n    const keyMap = getKeyboardMap(audioset);\n    const clip = keyMap[key];\n    if (clip) dispatch(pressPad(clip.clipId));\n  };\n\n  window.onkeyup = function(e) {\n    const key = e.key;\n    pressed[key] = false;\n\n    const audioset = getSession().audioset;\n    if (!audioset) return;\n\n    const keyMap = getKeyboardMap(audioset);\n    const clip = keyMap[key];\n    if (clip) dispatch(releasePad(clip.clipId));\n  };\n}\n\nexport function getKeyboardMap(audioset) {\n  return memo(audioset, \"keyboardMap\", () => buildKeymap(audioset.keyboard));\n}\n\nfunction buildKeymap(keyboard) {\n  if (!keyboard) return {};\n  const { defaults, keyMap } = keyboard;\n  return Object.keys(keyMap).reduce((map, key) => {\n    const value = { ...defaults, ...keyMap[key] };\n    value.key = key;\n    map[key] = value;\n    map[key.toUpperCase()] = value;\n    map[value.clipId] = value;\n    return map;\n  }, {});\n}\n\nexport default { effects };\n","import React from \"react\";\nimport cxs from \"cxs/component\";\nimport PropTypes from \"prop-types\";\nimport { getKeyboardMap } from \"../../audioset/inputs\";\nimport Trigger from \"../shared/Trigger\";\n\nconst Key = cxs(Trigger)(props => ({\n  marginRight: \"0.5em\",\n  padding: \"1px 3px\"\n}));\n\nconst Keyboard = ({ audioset, status, className, onPress, onRelease }) => {\n  const keyMap = getKeyboardMap(audioset);\n  return (\n    <div className={className} id=\"Keyboard\">\n      {audioset.tracks.map(track =>\n        track.clipIds.map(name => (\n          <Key\n            key={name}\n            pressed={status[name] && status[name].isPlaying}\n            color={track.color}\n            onPress={() => onPress(name)}\n            onRelease={() => onRelease(name)}\n          >\n            {keyMap[name] ? keyMap[name].key.toUpperCase() : \"-\"}\n          </Key>\n        ))\n      )}\n    </div>\n  );\n};\nKeyboard.propTypes = {\n  onKeyPressed: PropTypes.func\n};\nexport default cxs(Keyboard)({\n  backgroundColor: \"black\",\n  textAlign: \"center\",\n  padding: \"2px 10px 4px 10px\"\n});\n","import { connect } from \"react-redux\";\nimport Keyboard from \"./Keyboard\";\nimport { pressPad, releasePad } from \"../../session/actions\";\n\nconst mapStateToProps = session => ({\n  audioset: session.audioset,\n  status: session.audio.status\n});\n\nconst mapDispatchToProps = dispatch => ({\n  onPress: pad => dispatch(pressPad(pad)),\n  onRelease: pad => dispatch(releasePad(pad))\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Keyboard);\n","import * as screen from \"screenfull\";\n\nexport default { changeFullscreen, onChange };\n\nexport function changeFullscreen(isFullscreen) {\n  if (screen.enabled) {\n    if (isFullscreen) screen.request();\n    else screen.exit();\n  }\n}\n\nexport function onChange(callback) {\n  if (screen.enabled) {\n    screen.on(\"change\", () => callback(screen.isFullscreen));\n  }\n}\n","import React from \"react\";\nimport Joyride from \"react-joyride\";\n\nconst steps = [\n  {\n    target: \"#Connection\",\n    content:\n      \"Has creado una sesión. Puedes cambiarla o conectar con otros dispositivos aquí\",\n    placement: \"bottom\",\n    disableBeacon: true\n  },\n  {\n    target: \"#Keyboard\",\n    content:\n      \"Usa el teclado para lanzar los sonidos. También puedes usar MIDI o un MakeyMakey!\",\n    placement: \"top\",\n    disableBeacon: true\n  },\n  {\n    target: \"#Transport\",\n    content: \"Ponlo en pantalla completa o abre los controles\",\n    disableBeacon: true\n  }\n];\n\nconst locale = {\n  back: \"Anterior\",\n  close: \"Cerrar\",\n  last: \"Ok, lo he pillado\",\n  next: \"Siguiente\",\n  skip: \"Salir\"\n};\n\nconst options = {\n  arrowColor: \"#111\",\n  backgroundColor: \"#111\",\n  beaconSize: 70,\n  overlayColor: \"rgba(255, 255, 255, 0.5)\",\n  primaryColor: \"#000\",\n  spotlightShadow: \"0 0 15px rgba(0, 0, 0, 0.5)\",\n  textColor: \"white\",\n  width: undefined,\n  zIndex: 100\n};\n\nconst styles = {\n  options,\n  tooltip: { fontSize: 14, fontFamily: \"system\" },\n  buttonSkip: { fontSize: 12 }\n};\n\nexport default ({ run, onStop }) => (\n  <Joyride\n    callback={state => state.action === \"reset\" && onStop()}\n    run={run}\n    locale={locale}\n    styles={styles}\n    showProgress={false}\n    showSkipButton={true}\n    continuous={true}\n    steps={steps}\n  />\n);\n","import React, { useReducer, useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport cxs from \"cxs/component\";\nimport Toolbar from \"./Toolbar\";\nimport Welcome from \"../Welcome\";\nimport Visuals from \"./Visuals\";\nimport Pads from \"../Pads\";\nimport Tracks from \"../Tracks\";\nimport Keyboard from \"../Keyboard\";\nimport Modal from \"react-modal\";\nimport Fullscreen from \"../../browser/fullscreen\";\nimport Help from \"./Help\";\n\nconst initialState = audioset => ({\n  isFullscreen: false,\n  welcomeVisible: !audioset,\n  padsVisible: false,\n  tracksVisible: false,\n  help: false\n});\n\n// Actions\nconst setHelpVisible = isVisible => ({ type: \"help\", isVisible });\nconst setWelcomeVisible = isVisible => ({ type: \"welcome\", isVisible });\nconst setPadsVisible = isVisible => ({ type: \"pads\", isVisible });\nconst setTracksVisible = isVisible => ({ type: \"tracks\", isVisible });\nconst setFullscreen = isFullscreen => ({ type: \"fullscreen\", isFullscreen });\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case \"welcome\":\n      return { ...state, welcomeVisible: action.isVisible };\n    case \"fullscreen\":\n      return { ...state, isFullscreen: action.isFullscreen };\n    case \"help\":\n      return { ...state, help: action.isVisible };\n    case \"pads\":\n      return { ...state, padsVisible: action.isVisible };\n    case \"tracks\":\n      return { ...state, tracksVisible: action.isVisible };\n    default:\n      return state;\n  }\n}\n\nconst App = ({ audioset, attachVisuals, detachVisuals }) => {\n  const [state, disp] = useReducer(reducer, initialState(audioset));\n\n  // Handlers\n  const togglePads = () => disp(setPadsVisible(!state.padsVisible));\n  const toggleTracks = () => disp(setTracksVisible(!state.tracksVisible));\n  const showFullscreen = () => Fullscreen.changeFullscreen(!state.isFullscreen);\n  const hideWelcome = () => disp(setWelcomeVisible(false));\n  const showWelcome = () => disp(setWelcomeVisible(true));\n  const onHelp = () => disp(setHelpVisible(true));\n  const onHelpStop = () => disp(setHelpVisible(false));\n\n  useEffect(\n    () =>\n      Fullscreen.onChange(isFullscreen => disp(setFullscreen(isFullscreen))),\n    []\n  );\n\n  const notFull = !state.isFullscreen;\n\n  return (\n    <>\n      {audioset && (\n        <Main className=\"App\">\n          <Help run={state.help} onStop={onHelpStop} />\n          {notFull && (\n            <Toolbar\n              audioset={audioset}\n              onHelp={onHelp}\n              audio={{}}\n              onCloseAudioset={showWelcome}\n              onTogglePads={togglePads}\n              onToggleTracks={toggleTracks}\n              onFullscreen={showFullscreen}\n            />\n          )}\n          <Content>\n            {notFull && state.padsVisible && <Pads />}\n            <Center>\n              {/* <Visuals\n                audioset={audioset}\n                onStart={attachVisuals}\n                onStop={detachVisuals}\n              /> */}\n            </Center>\n            {notFull && state.tracksVisible && <Tracks />}\n          </Content>\n          {notFull && <Keyboard />}\n        </Main>\n      )}\n      <Modal\n        isOpen={!audioset || state.welcomeVisible}\n        shouldCloseOnOverlayClick={true}\n        onRequestClose={hideWelcome}\n        style={ModalStyles}\n      >\n        <Welcome onClose={hideWelcome} />\n      </Modal>\n    </>\n  );\n};\n\nApp.propTypes = {\n  audioset: PropTypes.object,\n  events: PropTypes.object\n};\n\nconst ModalStyles = {\n  overlay: {\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    zIndex: 900\n  },\n  content: {\n    // http://lynn.io/2014/02/22/modalin/\n    position: \"fixed\",\n    maxHeight: \"calc(100% - 100px)\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n\n    // position: \"absolute\",\n    // top: \"40px\",\n    // left: \"0px\",\n    // right: \"auto\",\n    // bottom: \"40px\",\n    border: \"\",\n    background: \"black\",\n    borderRadius: 0,\n    zIndex: 1000\n  }\n};\n\nconst Main = cxs(\"div\")({\n  display: \"flex\",\n  flexDirection: \"column\",\n  minHeight: \"100vh\"\n});\n\nconst Content = cxs(\"div\")({\n  display: \"flex\",\n  flexGrow: 1,\n  flexDirection: \"row\",\n  height: \"100%\",\n  minHeight: \"100%\",\n  maxHeight: \"100%\",\n  overflow: \"hidden\"\n});\n\nconst Center = cxs(\"div\")({\n  flexGrow: 1\n});\n\nexport default App;\n","import { bindActionCreators } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { attachVisuals, detachVisuals } from \"../../session/actions\";\nimport Desktop from \"./Desktop\";\n\nconst mapStateToProps = session => ({\n  audioset: session.audioset\n});\n\nconst mapDispatchToProps = dispatch =>\n  bindActionCreators({ attachVisuals, detachVisuals }, dispatch);\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Desktop);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport Desktop from \"./Desktop\";\n\nconst App = ({ events }) => {\n  return <Desktop events={events} />;\n};\nApp.propTypes = {};\nexport default App;\n","import { throttle } from \"lodash\";\n\nconst STORAGE_KEY = \"atpls/session\";\n\nexport function loadState() {\n  try {\n    const serializedState = localStorage.getItem(STORAGE_KEY);\n    if (serializedState === null) return undefined;\n    return JSON.parse(serializedState);\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport const saveState = throttle(state => {\n  try {\n    const serializedState = JSON.stringify(state);\n    localStorage.setItem(STORAGE_KEY, serializedState);\n  } catch (e) {\n    console.log(\"Error saving state\", e);\n  }\n}, 1000);\n\nif (typeof window !== undefined) {\n  // to clear the storage manually\n  window.resetLocalStorage = () => saveState({});\n}\n","import { SET_AUDIOSET } from \"../actions\";\n\n/**\n * Audioset session state\n */\nconst initialState = null;\n\nexport default function reduce(state = initialState, action) {\n  if (action.type === SET_AUDIOSET) return action.audioset;\n  return state;\n}\n","import {\n  SET_AUDIO_STATUS,\n  SET_AUDIO_CLIP_STATUS,\n  AUDIO_STOP_ALL\n} from \"../actions\";\n\n/**\n * Audioset session state\n */\nconst initialState = {\n  isPlaying: false,\n  status: {}\n};\n\nexport default function reduce(state = initialState, action) {\n  switch (action.type) {\n    case SET_AUDIO_STATUS:\n      return {\n        ...state,\n        isPlaying: action.status.isPlaying,\n        time: action.status.time\n      };\n    case SET_AUDIO_CLIP_STATUS:\n      return {\n        ...state,\n        status: { ...state.status, [action.clipId]: action.status }\n      };\n    case AUDIO_STOP_ALL:\n      return { ...state, status: {} };\n    default:\n      return state;\n  }\n}\n","import {\n  SET_AUDIOSET,\n  CHANGE_TRACK_VOLUME,\n  SET_AUDIO_CLIP_STATUS\n} from \"../actions\";\n\nconst initialState = {\n  playing: {},\n  volumes: {}\n};\n\nconst valueByTrack = (audioset, value) =>\n  audioset\n    ? audioset.tracks.reduce((obj, t) => {\n        obj[t.id] = value;\n        return obj;\n      }, {})\n    : {};\n\nexport default function reduce(state = initialState, action) {\n  switch (action.type) {\n    case SET_AUDIOSET:\n      return {\n        playing: valueByTrack(action.audioset, 0),\n        volumes: valueByTrack(action.audioset, 75)\n      };\n    case SET_AUDIO_CLIP_STATUS:\n      const { trackId } = action;\n      const dir = action.status.isPlaying ? 1 : -1;\n      return {\n        ...state,\n        playing: {\n          ...state.playing,\n          [trackId]: state.playing[trackId] + dir\n        }\n      };\n    case CHANGE_TRACK_VOLUME:\n      return {\n        ...state,\n        volumes: { ...state.volumes, [action.trackId]: action.value }\n      };\n    default:\n      return state;\n  }\n}\n","import { combineReducers } from \"redux\";\nimport audioset from \"./reducers/audioset\";\nimport audio from \"./reducers/audio\";\nimport tracks from \"./reducers/tracks\";\n\n/**\n * The session stores all state that can be shared between instances connected\n */\nexport default combineReducers({\n  audioset,\n  audio,\n  tracks\n});\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { setAudioset } from \"./session/actions\";\nimport { addEffects } from \"./session/effects\";\nimport Rooms from \"./rooms\";\nimport Audioset from \"./audioset\";\nimport Audio from \"./audio\";\nimport Visuals from \"./visuals\";\nimport App from \"./ui/App\";\nimport Modal from \"react-modal\";\nimport Inputs from \"./audioset/inputs\";\nimport { fetchAudioset } from \"./audioset\";\nimport createStore from \"./createStore\";\n\nconst ENV = process.env.NODE_ENV;\nconst WEBSOCKETS_URL = \"http://localhost:4000\";\n\nconst store = createStore();\n\nconst session = {\n  getSession: store.getState,\n  getAudioset: () => store.getState().audioset,\n  dispatch: store.dispatch\n};\nloadCurrentAudioset(session);\n\nconst rooms = new Rooms(WEBSOCKETS_URL);\nrooms.onStatus = status => console.log(\"room status\", status);\nrooms.createRoom();\n\naddEffects(Inputs.effects(session));\n\n// This two pieces will be moved eventually to code-spliting\naddEffects(Audio.effects(session));\naddEffects(Visuals.init());\n\nfunction loadCurrentAudioset(session) {\n  const { audioset } = session.getSession();\n  if (audioset) {\n    // reload the audioset on development\n    if (ENV === \"development\")\n      fetchAudioset(audioset.id).then(audioset =>\n        session.dispatch(setAudioset(audioset))\n      );\n    else if (ENV !== \"development\") session.dispatch(setAudioset(audioset));\n  }\n}\n\nconst element = document.getElementById(\"app\");\nModal.setAppElement(element);\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  element\n);\n","import { createStore, compose, applyMiddleware } from \"redux\";\n// import thunk from \"redux-thunk\";\nimport { loadState, saveState } from \"./browser/localStorage\";\n\n// the session effects middlewasre\nimport effects from \"./session/effects\";\nimport session from \"./session\";\n\n/**\n * Create an store\n */\nexport default function() {\n  const initialState = loadState();\n  const enhancer = compose(\n    applyMiddleware(effects),\n    window.__REDUX_DEVTOOLS_EXTENSION__\n      ? window.__REDUX_DEVTOOLS_EXTENSION__()\n      : f => f\n  );\n\n  const store = createStore(session, initialState, enhancer);\n\n  store.subscribe(() => saveState(store.getState()));\n  return store;\n}\n"],"sourceRoot":""}